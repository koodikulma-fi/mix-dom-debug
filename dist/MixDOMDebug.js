if(!window["exports"])window.exports={};!function(){var e;function callListeners(t,o){for(const n of t.slice()){const s=n[2]||0;if(s&e.OneShot){const e=n[4]||t,o=e.indexOf(n);-1!==o&&e.splice(o,1)}s&e.Deferred?setTimeout((()=>n[0](...n[1]&&o?[...o,...n[1]]:o||n[1]||[])),0):n[0](...n[1]&&o?[...o,...n[1]]:o||n[1]||[])}}Object.defineProperty(exports,'__esModule',{value:!0}),function(e){e[e.OneShot=1]='OneShot',e[e.Deferred=2]='Deferred',e[e.None=0]='None',e[e.All=3]='All'}(e||(e={}));class SignalBoy extends(mixinSignalBoy(Object)){}function mixinSignalBoy(t){return class SignalBoy extends t{constructor(){super(...arguments),this.signals={}}listenTo(t,o,n,s=e.None,i){var r,l;let a=this.signals[t];const d=[o,n||null,s||e.None,null!=i?i:null];a?a.some(((e,t)=>e[0]===o&&(a[t]=d)))||a.push(d):this.signals[t]=a=[d],d[2]&e.OneShot&&d.push(a),null===(l=(r=this.constructor).onListener)||void 0===l||l.call(r,this,t,a.indexOf(d),!0)}unlistenTo(e,t,o){var n,s;null==e?e=Object.keys(this.signals):'string'==typeof e&&(e=[e]);const i=null!=o;for(const r of e){const e=this.signals[r];if(e){for(let l=e.length-1;l>=0;l--)t&&e[l][0]!==t||i&&e[l][3]!==o||(null===(s=(n=this.constructor).onListener)||void 0===s||s.call(n,this,r,l,!1),e.splice(l,1));e[0]||delete this.signals[r]}}}isListening(e,t,o){if(null==e)return Object.keys(this.signals).some((e=>this.isListening(e,t,o)));const n=this.signals[e];return!(!n||t&&!n.some((e=>e[0]===t))||null!=o&&!n.some((e=>e[3]===o)))}sendSignal(e,...t){const o=this.constructor.getListenersFor?this.constructor.getListenersFor(this,e):this.signals[e];o&&callListeners(o,t)}static onListener(e,t,o,n){}}}function askListeners(t,o,n){const s=n&&(n.includes('first')||n.includes('first-true')),i=n&&(s||n.includes('last')),r=n&&n.includes('no-false'),l=n&&n.includes('no-null');let a=[];for(const d of t.slice()){const c=d[2]||0;if(c&e.OneShot){const e=d[4]||t,o=e.indexOf(d);-1!==o&&e.splice(o,1)}if(c&e.Deferred)setTimeout((()=>d[0](...d[1]&&o?[...o,...d[1]]:o||d[1]||[])),0);else{const e=d[0](...d[1]&&o?[...o,...d[1]]:o||d[1]||[]);if(!e&&(void 0===e||r||l&&null==e))continue;if(i?a[0]=e:a.push(e),s&&(e||!n.includes('first-true')))break}}return i?a[0]:a}function mixinSignalMan(e){return class SignalMan extends(mixinSignalBoy(e)){sendSignalAs(e,t,...o){const n='string'==typeof e?[e]:e,s=n.includes('delay')||n.includes('pre-delay'),i=n.includes('first')||n.includes('first-true'),r=n.includes('multi')||!i&&!n.includes('last');if(n.includes('await'))return new Promise((async e=>{s&&await this.afterRefresh(n.includes('delay'));const l=this.constructor.getListenersFor?this.constructor.getListenersFor(this,t):this.signals[t];if(!l)return e(r?[]:void 0);let a=(await Promise.all(askListeners(l,o))).filter((e=>!(void 0===e||null==e&&n.includes('no-null')||!e&&n.includes('no-false'))));i&&n.includes('first-true')&&(a=a.filter((e=>e)));const d=a.length;d?i?e(r?[a[0]]:a[0]):n.includes('last')?e(r?[a[d-1]]:a[d-1]):e(a):e(r?[]:void 0)}));if(!s){const e=this.constructor.getListenersFor?this.constructor.getListenersFor(this,t):this.signals[t];return e?askListeners(e,o,n):n.includes('last')||i?void 0:[]}(async()=>{await this.afterRefresh(n.includes('delay'));const e=this.constructor.getListenersFor?this.constructor.getListenersFor(this,t):this.signals[t];e&&(i?askListeners(e,o,n):callListeners(e,o))})()}afterRefresh(e=!1){return new Promise((t=>setTimeout(e&&this.awaitDelay?async()=>{await this.awaitDelay(),t()}:t,0)))}}}function mixinDataBoy(e){return class DataBoy extends e{constructor(){super(...arguments),this.dataListeners=new Map}listenToData(...e){var t;let o=1;const n=e.length,s='boolean'==typeof e[n-o]&&e[n-o++],i='object'==typeof e[0],r=i?e[0]:Array.isArray(e[n-o])?null===(t=e[n-o++])||void 0===t?void 0:t.slice():void 0,l=i?Object.keys(e[0]):e.slice(0,n-o),a=e[n-o];this.dataListeners.set(a,[r,...l]),s&&a(...this.getDataArgsBy(l,r))}unlistenToData(e){return!!this.dataListeners.has(e)&&(this.dataListeners.delete(e),!0)}getInData(e,t=void 0){return t}setInData(e,t,o,n){}refreshData(e,t){e&&('string'==typeof e&&(e=[e]),null!=t?setTimeout((()=>this.callDataBy(e))):this.callDataBy(e))}getDataArgsBy(e,t){return t?Array.isArray(t)?e.map(((e,o)=>this.getInData(e,t[o]))):[e.reduce(((e,o)=>(e[o]=this.getInData(o,t[o]),e)),{})]:e.map(((e,t)=>this.getInData(e)))}callDataBy(e=!0,t){if(t||!this.constructor.callDataListenersFor)for(const[t,[o,...n]]of this.dataListeners.entries())(!0===e||e.some((e=>n.some((t=>t===e||t.startsWith(e+'.')||e.startsWith(t+'.'))))))&&t(...this.getDataArgsBy(n,o));else this.constructor.callDataListenersFor(this,e)}}}class RefreshCycle extends SignalBoy{constructor(...e){super(),this.state='',this.settings=e[0]||{},this.settings.autoRenewPromise?this.initPromise():this.promise=Promise.resolve(),this.pending=this.settings.initPending?this.settings.initPending():void 0}start(e){if(this.state)return;const t=this.signals;this.setState('waiting'),this._resolve&&this.settings.autoRenewPromise||this.initPromise();const o=void 0===e?void 0===this.nextTimeout?this.settings.defaultTimeout:this.nextTimeout:e;this.extend(o),t.onStart&&this.sendSignal('onStart'),null===o&&this.resolve()}trigger(e,t){const o=void 0===t?void 0===this.nextTimeout?e:this.nextTimeout:t;return this.state?void 0!==o&&this.extend(o,'instant'):this.start(o),this.promise}extend(e,t){switch(this.state){case'':void 0===e?delete this.nextTimeout:this.nextTimeout=e,(!0===t||t&&null===e)&&this.start();break;case'waiting':this.clearTimer(),null===e?t?this.resolve():this.nextTimeout=null:void 0!==e&&(this.timer=setTimeout((()=>{delete this.timer,this.resolve()}),e))}}clearTimer(){delete this.nextTimeout,void 0!==this.timer&&(clearTimeout(this.timer),delete this.timer)}resetPending(){const e=this.pending;return this.pending=this.settings.initPending?this.settings.initPending():void 0,e}resolve(){if('waiting'!==this.state)return;this.setState('resolving'),this.clearTimer();const e=this.resetPending(),t=this.signals;t.onResolve&&this.sendSignal('onResolve');let o=0;const resolvePromise=(e=!1)=>{1&o?e||2&o||'resolving'!==this.state||(o|=2,this.setState(''),this._resolve&&this._resolve()):(o|=e?1:3,e||'resolving'!==this.state||this.setState(''),this._resolve&&this._resolve())};t.onRefresh&&this.sendSignal('onRefresh',e,resolvePromise),resolvePromise(),this.settings.autoRenewPromise&&this.initPromise(),t.onFinish&&this.sendSignal('onFinish',!1)}reject(){if('waiting'!==this.state)return;this.setState('resolving'),this.clearTimer(),this.resetPending();const e=this.signals;e.onResolve&&this.sendSignal('onResolve'),this.setState(''),this.settings.autoRenewPromise?this.initPromise():this._resolve&&this._resolve(),e.onFinish&&this.sendSignal('onFinish',!0)}initPromise(){this._resolve&&this._resolve(),this.promise=new Promise((e=>this._resolve=()=>{delete this._resolve,e()}))}setState(e){this.state=e,this.signals.onState&&this.sendSignal('onState',this.state)}}class Context extends(function mixinDataMan(e){return class DataMan extends(mixinDataBoy(e)){constructor(...e){super(...e.slice(1)),this.dataListeners=new Map,this.dataKeysPending=null,this.data=e[0]||{}}getData(){return this.data}getInData(e,t){if(!this.data)return t;if(!e)return this.data;const o=e.split('.');let n=this.data;for(const e of o){if(!n)return t;n=n[e]}return void 0===n?t:n}setData(e,t=!0,o=!0,n){this.data=!1!==t?Object.assign(Object.assign({},this.data),e):e,o?this.refreshData(!0,n):this.addRefreshKeys(!0)}setInData(e,t,o=!0,n=!0,s){var i;if(e){const n=e.split('.'),s=n.pop();if(!s)return;const r=this.constructor.createPathTo(this,n);if(!r)return;r[s]=o&&(null===(i=r[s])||void 0===i?void 0:i.constructor)===Object?Object.assign(Object.assign({},r[s]),t):t}else this.data=o&&this.data?Object.assign(Object.assign({},this.data),t):t;n?this.refreshData(e||!0,s):this.addRefreshKeys(e||!0)}refreshData(e,t){if(e&&this.addRefreshKeys(e),null!=t)return void setTimeout((()=>this.refreshData(null)),t);const o=this.dataKeysPending;this.dataKeysPending=null,o&&this.callDataBy(o)}addRefreshKeys(e){if(!0===e)this.dataKeysPending=!0;else if(e&&!0!==this.dataKeysPending)if('string'==typeof e&&(e=[e]),this.dataKeysPending)for(const t of e)this.dataKeysPending.some((e=>e===t||t.startsWith(e+'.')))||this.dataKeysPending.push(t);else this.dataKeysPending=[...e]}static createPathTo(e,t){var o;let n=e.data=Object.assign({},e.data);for(const e of t)n=n[e]=(null===(o=n[e])||void 0===o?void 0:o.constructor)===Object?Object.assign({},n[e]):n[e]||{};return n}}}(mixinSignalMan(Object))){constructor(e,t){super(e),this.settings=this.constructor.getDefaultSettings(),this.contextAPIs=new Map,this.preDelayCycle=new RefreshCycle,this.delayCycle=new RefreshCycle({autoRenewPromise:!0}),t&&this.modifySettings(t),this.constructor.initializeCyclesFor(this)}modifySettings(e){var t;const o=this.constructor.getDefaultSettings();for(const n in e)this.settings[n]=void 0!==e[n]?e[n]:null!==(t=this.settings[n])&&void 0!==t?t:o[n]}triggerRefresh(e){this.preDelayCycle.trigger(this.settings.refreshTimeout,e)}afterRefresh(e=!1,t){return e&&this.delayCycle.state||this.preDelayCycle.trigger(this.settings.refreshTimeout,t),e?this.delayCycle.promise:this.preDelayCycle.promise}async awaitDelay(){const e=new Set;for(const t of this.contextAPIs.keys())e.add(t.afterRefresh(!0));await Promise.all(e)}refreshData(e,t){e&&this.addRefreshKeys(e),this.triggerRefresh(t)}static getListenersFor(e,t){let o=e.signals[t]||[];for(const[n,s]of e.contextAPIs)for(const e of s){const s=n.constructor.getListenersFor?n.constructor.getListenersFor(n,e+'.'+t):n.signals[e+'.'+t];s&&(o=o.concat(s))}return o[0]&&o}static createPathTo(e,t){switch(e.settings.dataMode){case'immutable':return super.createPathTo(e,t);case'mutable':{let o=e.data;for(const e of t)o=o[e]=o[e]?o[e]:{};return o}case'existing':{let o=e.data;for(const e of t){if(!o[e])return;o=o[e]}return o}default:return}}static getDefaultSettings(){return{refreshTimeout:0,dataMode:'immutable'}}static initializeCyclesFor(e){e.preDelayCycle.listenTo('onRefresh',((t,o)=>e.constructor.runPreDelayFor(e,o))),e.delayCycle.listenTo('onRefresh',((t,o)=>e.constructor.runDelayFor(e,o))),e.preDelayCycle.listenTo('onFinish',(()=>{e.delayCycle.trigger(),'waiting'===e.delayCycle.state&&(e.awaitDelay?e.awaitDelay().then((()=>e.delayCycle.resolve())):e.delayCycle.resolve())})),e.delayCycle.listenTo('onResolve',(()=>e.preDelayCycle.resolve()))}static runPreDelayFor(e,t){const o=e.dataKeysPending;if(e.dataKeysPending=null,t(),o){for(const[t,[n,...s]]of e.dataListeners.entries())(!0===o||o.some((e=>s.some((t=>t===e||t.startsWith(e+'.')||e.startsWith(t+'.'))))))&&t(...e.getDataArgsBy(s,n));for(const[t,n]of e.contextAPIs.entries())t.callDataBy(!0===o?n:n.reduce(((e,t)=>e.concat(o.map((e=>e?t+'.'+e:t)))),[]))}}static runDelayFor(e,t){}}class ContextAPI extends(mixinDataBoy(mixinSignalMan(Object))){constructor(e,t){super(),this.contexts=Object.assign({},e),t&&(this.inheritedContexts=Object.assign({},t)),this.dataListeners=new Map}afterRefresh(e=!1,t){return this.awaitDelay?this.awaitDelay():Promise.resolve()}sendSignal(e,...t){var o;const n=e.indexOf('.');-1!==n&&(null===(o=this.getContext(e.slice(0,n)))||void 0===o||o.sendSignal(e.slice(n+1),...t))}sendSignalAs(e,t,...o){const n=t.indexOf('.'),s=-1===n?null:this.getContext(t.slice(0,n));if(s)return s.sendSignalAs(e,t.slice(n+1),...o);const i='string'==typeof e?[e]:e,r=i.includes('last')||i.includes('first')||i.includes('first-true')?void 0:[];return i.includes('await')?Promise.resolve(r):r}getInData(e,t=void 0){const o=e.indexOf('.'),n=this.getContext(-1===o?e:e.slice(0,o));return n?-1===o?n.getData():n.getInData(e.slice(o+1),t):t}setInData(e,t,o,n,s){const i=e.indexOf('.'),r=this.getContext(-1===i?e:e.slice(0,i));r&&(-1===i?r.setData(t,o,n,s):r.setInData(e.slice(i+1),t,o,n,s))}refreshData(e,t){if(!e)return;const o={};for(const t of!0===e?Object.keys(this.getContexts()):'string'==typeof e?[e]:e){const e=t.indexOf('.'),n=-1===e?t:t.slice(0,e);let s=o[n];void 0===s&&(s=o[n]=this.getContext(n)||null),s&&s.addRefreshKeys(-1===e||t.slice(n.length+1))}for(const e in o)o[e]&&o[e].refreshData(null,t)}refreshDataBy(e,t){const o=this.getContexts(e);for(const n in o){const s=o[n];s&&s.refreshData(e[n],t)}}getContext(e,t=!0){return void 0!==this.contexts[e]?this.contexts[e]:t&&this.inheritedContexts?this.inheritedContexts[e]:void 0}getContexts(e,t=!0,o=!1){if(!e)return Object.assign(Object.assign({},t?this.inheritedContexts:void 0),this.contexts);const n=e.constructor===Set?e:e.constructor===Array?new Set(e):new Set(Object.keys(e)),s={},i=t&&this.inheritedContexts?Object.assign(Object.assign({},this.inheritedContexts),this.contexts):this.contexts;for(const e in i)!n.has(e)||void 0===i[e]||o&&null===i[e]||(s[e]=i[e]);return s}newContext(e,t,o,n=!0){const s=new Context(e,t);return o&&this.setContext(o,s,n),s}newContexts(e,t,o=!1,n=!0){const s=((e,t)=>{const o={};for(const n in e)o[n]=new Context(e[n],t);return o})(e,t);return o&&this.setContexts(s,n),s}setContext(e,t,o=!0,n=!1){return void 0!==this.constructor.modifyContexts(this,{[e]:t},o,n)[0]}setContexts(e,t=!0,o=!1){return this.constructor.modifyContexts(this,e,t,o)}refreshContext(e,t){var o;null===(o=this.getContext(e))||void 0===o||o.triggerRefresh(t)}refreshContexts(e,t){if(!e||Array.isArray(e))for(const o of e||Object.keys(this.getContexts()))this.refreshContext(o,t);else for(const o in e)this.refreshContext(o,void 0===e[o]?t:e[o])}static modifyContexts(e,t,o,n){let s=[];for(const o in t){const i=t[o],r=e.getContext(o),l=n?e.inheritedContexts||(e.inheritedContexts={}):e.contexts;if(r===i){(n?(e.inheritedContexts&&e.inheritedContexts[o])!==i:e.contexts[o]!==i)&&(void 0!==i?l[o]=i:delete l[o]);break}if(r){const t=r.contextAPIs.get(e);if(t){const n=t.filter((e=>e!==o));n.length?r.contextAPIs.set(e,n):r.contextAPIs.delete(e)}}if(i){const t=i.contextAPIs.get(e)||[];t.includes(o)||t.push(o),i.contextAPIs.set(e,t)}void 0!==i?l[o]=i:delete l[o],s.push(o)}return o&&void 0!==s[0]&&e.callDataBy(s),s}static parseContextDataKey(e){const t=e.indexOf('.');return-1===t?[e,'']:[e.slice(0,t),e.slice(t+1)]}static readContextNamesFrom(e,t){return e.reduce(((e,o)=>{const n=o.indexOf('.'),s=-1===n?o:o.slice(0,n);return(t||s&&!e.includes(s))&&e.push(s),e}),[])}static readContextDictionaryFrom(e){const t={};for(const o of e){const[e,n]=ContextAPI.parseContextDataKey(o);!0!==t[e]&&(n?(t[e]||(t[e]=[])).push(n):t[e]=!0)}return t}}function lowerCaseStr(e,t='-'){return e.replace(/([A-Z])/g,t+'$1').toLowerCase()}function camelCaseStr(e,t='-'){return e.split(t).map(((e,t)=>e?t?e[0].toUpperCase()+e.slice(1):e:'')).join('')}function parseDOMStyle(e,t=!1){const o=e.replace(/\/\*(.|\s)*?\*\//g,' ').replace(/\s+/g,' ').trim();if(!o)return t?null:{};const n=o.split(';').map((e=>{const t=e.indexOf(':');return-1===t?[e.trim()]:[e.slice(0,t).trim(),e.slice(t+1).trim()]})),s={};for(const[e,o]of n)e&&o&&(s[e.replace(/\W+\w/g,(e=>e.slice(-1).toUpperCase()))]=(t=!1)||o);return t?null:s}function classNames(...e){let t='';for(const o of e)o&&('string'==typeof o?t+=' '+o:o[Symbol.iterator]&&'function'==typeof o[Symbol.iterator]?t+=' '+[...o].filter((e=>e)).join(' '):o&&'object'==typeof o&&(t+=' '+Object.keys(o).filter((e=>o[e])).join(' ')));return t.trimStart().replace(/\s+/g,' ')}function getDictionaryDiffs(e,t){const o={};let n=!1;for(const s in e)void 0!==e[s]&&void 0===t[s]&&(o[s]=(n=!0)&&void 0);for(const s in t){const i=t[s];e[s]!==i&&(o[s]=(n=!0)&&i)}return n?o:null}const t={innerHTML:!0,outerHTML:!0,textContent:!0,innerText:!0,outerText:!0},o={value:!0},n=['area','base','br','col','embed','hr','img','input','link','meta','param','source','track','wbr'],s={autoCapitalize:'autocapitalize',autoFocus:'autofocus',contentEditable:'contenteditable',enterKeyHint:'enterkeyhint',exportParts:'exportparts',inputMode:'inputmode',itemId:'itemid',itemProp:'itemprop',itemRef:'itemref',itemScope:'itemscope',itemType:'itemtype',popOver:'popover',spellCheck:'spellcheck',tabIndex:'tabindex',virtualKeyboardPolicy:'virtualkeyboardpolicy',writingSuggestions:'writingsuggestions',acceptCharset:'accept-charset',autoComplete:'autocomplete',autoPlay:'autoplay',bgColor:'bgcolor',colSpan:'colspan',crossOrigin:'crossorigin',dateTime:'datetime',dirName:'dirname',encType:'enctype',formAction:'formaction',formEncType:'formenctype',formMethod:'formmethod',formNoValidate:'formnovalidate',formTarget:'formtarget',hrefLang:'hreflang',httpEquiv:'http-equiv',isMap:'ismap',maxLength:'maxlength',minLength:'minlength',noValidate:'novalidate',playsInline:'playsinline',readOnly:'readonly',referrerPolicy:'referrerpolicy',rowSpan:'rowspan',srcDoc:'srcdoc',srcLang:'srclang',srcSet:'srcset',useMap:'usemap',xmlBase:'xml:base',xmlLang:'xml:lang',xmlSpace:'xml:space',xmlnsXlink:'xmlns:xlink',accentHeight:'accent-height',alignmentBaseline:'alignment-baseline',allowReorder:'allow-reorder',arabicForm:'arabic-form',baselineShift:'baseline-shift',capHeight:'cap-height',clipPath:'clip-path',clipRule:'clip-rule',colorInterpolation:'color-interpolation',colorInterpolationFilters:'color-interpolation-filters',colorRendering:'color-rendering',dominantBaseline:'dominant-baseline',fillOpacity:'fill-opacity',fillRule:'fill-rule',floodColor:'flood-color',floodOpacity:'flood-opacity',fontFamily:'font-family',fontSize:'font-size',fontSizeAdjust:'font-size-adjust',fontStretch:'font-stretch',fontStyle:'font-style',fontVariant:'font-variant',fontWeight:'font-weight',glyphName:'glyph-name',glyphOrientationHorizontal:'glyph-orientation-horizontal',glyphOrientationVertical:'glyph-orientation-vertical',horizAdvX:'horiz-adv-x',horizOriginX:'horiz-origin-x',horizOriginY:'horiz-origin-y',imageRendering:'image-rendering',letterSpacing:'letter-spacing',lightingColor:'lighting-color',markerEnd:'marker-end',markerMid:'marker-mid',markerStart:'marker-start',overlinePosition:'overline-position',overlineThickness:'overline-thickness',paintOrder:'paint-order',pointerEvents:'pointer-events',shapeRendering:'shape-rendering',stopColor:'stop-color',stopOpacity:'stop-opacity',strokeDashArray:'stroke-dasharray',strokeDashOffset:'stroke-dashoffset',strokeLineCap:'stroke-linecap',strokeLineJoin:'stroke-linejoin',strokeMiterLimit:'stroke-miterlimit',strokeOpacity:'stroke-opacity',strokeWidth:'stroke-width',textAnchor:'text-anchor',textDecoration:'text-decoration',textRendering:'text-rendering',transformOrigin:'transform-origin',underlinePosition:'underline-position',underlineThickness:'underline-thickness',unicodeBidi:'unicode-bidi',unicodeRange:'unicode-range',unitsPerEm:'units-per-em',vAlphabetic:'v-alphabetic',vHanging:'v-hanging',vIdeographic:'v-ideographic',vMathematical:'v-mathematical',vectorEffect:'vector-effect',vertAdvY:'vert-adv-y',vertOriginX:'vert-origin-x',vertOriginY:'vert-origin-y',wordSpacing:'word-spacing',writingMode:'writing-mode',xlinkActuate:'xlink:actuate',xlinkArcrole:'xlink:arcrole',xlinkHref:'xlink:href',xlinkRole:'xlink:role',xlinkShow:'xlink:show',xlinkTitle:'xlink:title',xlinkType:'xlink:type'},i=['abort','activate','animationcancel','animationend','animationiteration','animationstart','auxclick','beforeinput','beforetoggle','begin','blur','cancel','canplay','canplaythrough','change','click','close','contextlost','contextmenu','contextrestored','copy','cuechange','cut','dblclick','drag','dragend','dragenter','dragleave','dragover','dragstart','drop','durationchange','emptied','ended','error','focus','focusin','focusout','formdata','gotpointercapture','input','invalid','keydown','keypress','keyup','load','loadeddata','loadedmetadata','loadstart','lostpointercapture','mousedown','mouseenter','mouseleave','mousemove','mouseout','mouseover','mouseup','mousewheel','paste','pause','play','playing','pointercancel','pointerdown','pointerenter','pointerleave','pointermove','pointerout','pointerover','pointerup','progress','ratechange','repeat','reset','resize','scroll','scrollend','securitypolicyviolation','seeked','seeking','select','selectionchange','selectstart','show','slotchange','stalled','submit','suspend','timeupdate','toggle','touchcancel','touchend','touchmove','touchstart','transitioncancel','transitionend','transitionrun','transitionstart','unload','volumechange','waiting','webkitanimationend','webkitanimationiteration','webkitanimationstart','webkittransitionend','wheel'].reduce(((e,t)=>(e['on'+t]=t,e)),{}),r={class:!0,className:!0,style:!0};function readDOMProps(e){var t;const o={};if(!e.getAttributeNames)return o;for(const n of e.getAttributeNames())switch(n){case'style':{const t=parseDOMStyle(e.style.cssText,!0);t&&(o.style=t);break}case'class':o.className=e.className;break;default:n.startsWith('data-')?(o.data=o.data||{},o.data[camelCaseStr(n.slice(5))]=e.getAttribute(n)):(o.attributes=o.attributes||{},o.attributes[n]=null!==(t=e.getAttribute(n))&&void 0!==t?t:void 0)}return o}function cleanDOMProps(e,t=i,o=s){var n;const l={};let a;for(const s in e)if(r[s])if('style'===s){const t='string'==typeof e.style?parseDOMStyle(e.style):e.style||{};for(const e in t){l.style=t;break}}else e[s]&&(l.className=l.className?l.className+' '+e[s]:e[s]);else if(a=t[s.toLowerCase()]){if(!e[s])continue;l.listeners=l.listeners||{},l.listeners[a]=null!==(n=e[s])&&void 0!==n?n:void 0}else if(s.startsWith('data'))'-'===s[4]?(l.data=l.data||{},l.data[camelCaseStr(s.slice(5))]=e[s]):l.data=Object.assign(Object.assign({},l.data),e.data);else{if(void 0===e[s])continue;l.attributes=l.attributes||{},l.attributes[o[s]||s.startsWith('aria')&&'-'!==s[4]&&'aria-'+s.slice(4).toLowerCase()||s]=e[s]}return l}function equalDOMProps(e,t){return(e.className||'')===(t.className||'')&&function equalSubDictionaries(e,t,...o){for(const n of o){if(!e[n]&&!t[n])continue;const o=e[n]||{},s=t[n]||{};if(o!==s){for(const e in o)if(s[e]!==o[e])return!1;for(const e in s)if(o[e]!==s[e])return!1}}return!0}(e,t,'style','data','listeners','attributes')}function applyDOMProps(e,n,s={},i=!0,r=t,l=o){var a,d;const c={},u=(s.style||n.style?1:0)|(s.data||n.data?2:0);if(u)for(const t of 1===u?['style']:2===u?['data']:['style','data']){const o=getDictionaryDiffs(s[t]||{},n[t]||{});if(o&&(c[t]=o),o&&e)if('data'===t){const t=e.dataset;if(t)for(const e in o)void 0!==o[e]?t[e]=o[e]:delete t[e]}else{const t=e.style;if(t)for(const e in o)t[e]=null!==(a=o[e])&&void 0!==a?a:null}}if(s.className||n.className){const t=function getNameDiffs(e,t,o=' '){if((e=e||'')===(t=t||''))return null;const n=o?e.split(o):[e],s=o?t.split(o):[t],i={};let r=null;if(n)for(const e of n)!e||s&&s.includes(e)||(i[e]=r=!1);if(s)for(const e of s)!e||n&&n.includes(e)||(i[e]=r=!0);return null!==r?i:null}(s.className,n.className);if(t&&(c.className=t),t&&e)for(const o in t)e.classList[t[o]?'add':'remove'](o)}if(s.attributes||n.attributes){const t=getDictionaryDiffs(s.attributes||{},n.attributes||{});if(t&&(c.attributes=t),t&&e)for(const o in t)r[o]?i&&console.warn('Warning: Tried to apply a protected attribute: ',o,' for element: ',e):(l[o]&&(e[o]=void 0===t[o]?'':t[o]),void 0===t[o]?e.removeAttribute(o):e.setAttribute(o,t[o]))}if(s.listeners||n.listeners){const t=getDictionaryDiffs(s.listeners||{},n.listeners||{});if(t&&(c.attributes=t),t&&e)for(const o in t){const n=null===(d=s.listeners)||void 0===d?void 0:d[o];n&&e.removeEventListener(o,n),t[o]&&e.addEventListener(o,t[o])}}for(const e in c)return c;return null}function readDOMString(e,o,n,s,r=t){let l='';if(o||(o={}),!e&&(s&&s instanceof Element&&(e=s.tagName.toLowerCase()||''),!e))return(s&&s.textContent||'')+(!0===n?'':n||'');if(s){const{className:e,style:t,data:n,attributes:i}=readDOMProps(s);if(o=Object.assign({},o),e&&(o.className=o.className?o.className+' '+e:e),t){o.style=Object.assign({},o.style);for(const e in t)o.style[e]=t[e]}if(n){o.data=Object.assign({},o.data);for(const e in n)o.data[e]=n[e]}if(i){o.attributes=Object.assign({},o.attributes);for(const e in i)o.attributes[e]=i[e]}}const{className:a,style:d,data:c,attributes:u}=o;if(l+='<'+e,a&&(l+=' class="'+a+'"'),d){let e='';for(const t in d)e+=(e?' ':'')+lowerCaseStr(t)+': '+d[t]+';';e&&(l+=' style="'+e+'"')}if(c)for(const e in c)l+=' data-'+lowerCaseStr(e)+'="'+c[e].toString()+'"';if(u)for(let e in u)!u[e]||r[e]||i[e.toLowerCase()]||(l+=' '+e+'="'+u[e].toString()+'"');return n?(l+='>',!0!==n&&(l+=n),l+='</'+e+'>'):l+='/>',l}var l;function areEqual(e,t,o=-1){if(e===t)return!0;if(e&&o&&'object'==typeof e){if(!t||'object'!=typeof t)return!1;const n=e.constructor;if(n!==t.constructor)return!1;o--;let s=!1;switch(n){case Object:break;case Array:s=!0;break;case Set:if(s=!0,e.size!==t.size)return!1;e=[...e],t=[...t];break;case Map:if(e.size!==t.size)return!1;for(const[n,s]of e){if(!t.has(n))return!1;if(o?!areEqual(t.get(n),s,o):t.get(n)!==s)return!1}return!0;default:const n=e.toString();'[object NodeList]'!==n&&'[object HTMLCollection]'!==n||(s=!0)}if(s){const n=e.length;if(n!==t.length)return!1;for(let s=0;s<n;s++)if(o?!areEqual(e[s],t[s],o):e[s]!==t[s])return!1}else{for(const n in t){if(!e.hasOwnProperty(n))return!1;if(o?!areEqual(e[n],t[n],o):e[n]!==t[n])return!1}for(const o in e)if(!t.hasOwnProperty(o))return!1}return!0}return!1}function areEqualBy(e,t,o){var n;const s=!e||!t;for(const i in o){const r=o[i],a='number'==typeof r?r:null!==(n=l[r])&&void 0!==n?n:0;if(a<-1){if(-2===a)return!1}else{if(s)return!e&&!t;if(0===a){if(e[i]!==t[i])return!1}else if(!areEqual(e[i],t[i],a))return!1}}return!0}function createTrigger(e,t,o=1){const n='string'==typeof o?l[o]:o;let s;return(o,i=!1,r)=>{const l=t;if(n<-1){if(-2!==n)return!1}else if(!i&&areEqual(l,o,n))return!1;return void 0!==r&&(s&&s(l,o),s=void 0,e=r||void 0),t=o,e&&(s=e(o,l)||void 0),!1}}function createMemo(e,t=0){let o,n;const s='string'==typeof t?l[t]:t;return(...t)=>{if(n)if(s<-1){if(-2!==s)return o}else if(areEqual(n,t,s>=0?s+1:s))return o;return n=t,o=e(...t),o}}!function(e){e[e.never=-3]='never',e[e.always=-2]='always',e[e.deep=-1]='deep',e[e.changed=0]='changed',e[e.shallow=1]='shallow',e[e.double=2]='double'}(l||(l={}));var __rest$6=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&'function'==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(o[n[s]]=e[n[s]])}return o};const a={};function newDef(e,t=null,...o){const n=function parseDefType(e){if('string'==typeof e)return'_'===e?'element':'dom';if(!e)return'';const t=e.MIX_DOM_CLASS;if(!t)return'function'==typeof e?e.length>=2?'boundary':'spread':'';switch(t){case'Component':case'Remote':return'boundary';case'Fragment':case'Portal':case'Element':case'Host':return t.toLowerCase();default:return''}}(e);if(!n||t&&t._disable)return null;const s=[];let i=!1,r=0;for(const e of o){let t='string'==typeof e;if(e&&t&&i){s[r-1].domContent+=e;continue}const o=newDefFrom(e);o&&(r=s.push(o),i=t)}if('spread'===n)return function unfoldSpread(e,t,o){var n;const{_key:s,_disable:i}=t;let r=newDefFrom(e(__rest$6(t,['_key','_disable'])));if(!r)return null;const l={passes:[],withs:[]},a={MIX_DOM_DEF:'fragment',childDefs:[Object.assign({},r)],scopeType:'spread',spreadLinks:l,tag:null};null!=s&&(a.key=s),null!=i&&(a.disabled=i);let d,c=[a],u=!1,p=0;const f=!!o[0];for(;d=c[p];){if(p++,!d.childDefs[0])continue;let e=[];const t=d.childDefs;d.childDefs=[];for(const s of t){let t;if(s.spreadLinks){t=s,e=e.concat(s.spreadLinks.passes);for(const[e,t]of s.spreadLinks.withs){const o=e&&hasContentInDefs(e,f);'maybe'!==o&&(t.props.hasContent=o),'maybe'===o&&l.withs.push([e,t])}}else if('pass'===s.MIX_DOM_DEF)s.getRemote?t=s:(t={MIX_DOM_DEF:'fragment',tag:null,childDefs:[...o]},null!=s.key&&(t.key=s.key),u||'copy'===s.contentPassType?t.scopeType='spread-copy':(t.scopeType='spread-pass',u=!0),l.passes.push(t));else if(t=Object.assign({},s),e.push(t),'boundary'===s.MIX_DOM_DEF&&s.tag._WithContent&&!s.tag._WithContent.getRemote&&!s.tag.withContents&&null==(null===(n=t.props)||void 0===n?void 0:n.hasContent)){const e=hasContentInDefs(o,f);t.props=Object.assign({hasContent:'maybe'===e?void 0:e},t.props),'maybe'===e&&l.withs.push([o,t])}d.childDefs.push(t)}c=e.concat(c.slice(p)),p=0}return a}(e,t||{},s);if('fragment'===n&&!s[0])return null;const l='dom'===n&&e||'boundary'===n&&e||'element'===n&&'_'||('content'===n?'':null),a={MIX_DOM_DEF:n,tag:l,childDefs:s};if('fragment'===a.MIX_DOM_DEF);else if(t){const{_key:e,_ref:o,_signals:s,_contexts:i,_disable:r}=t,d=__rest$6(t,['_key','_ref','_signals','_contexts','_disable']);if(null!=e&&(a.key=e),o){const e=[];if('Ref'===o.constructor.MIX_DOM_CLASS)e.push(o);else for(const t of o)t&&'Ref'===t.constructor.MIX_DOM_CLASS&&-1===e.indexOf(t)&&e.push(t);a.attachedRefs=e}s&&(a.attachedSignals=Object.assign({},s)),i&&'boundary'===n&&(a.attachedContexts=Object.assign({},i)),l&&(a.props='string'==typeof l?cleanDOMProps(d):d)}else l&&(a.props={});switch(a.MIX_DOM_DEF){case'portal':a.domPortal=t.container||null;break;case'element':{const e=a.props||{},{element:t,cloneMode:o}=e,n=__rest$6(e,['element','cloneMode']);a.props=cleanDOMProps(n),a.domElement=t||null,a.domCloneMode=null!=o?'boolean'==typeof o?o?'deep':'':o:null;break}}return a}function newDefFrom(e){if(e&&'object'==typeof e){if('string'==typeof e.MIX_DOM_DEF)return e;if(e instanceof Node)return{MIX_DOM_DEF:'content',tag:'',childDefs:[],domContent:e};if('Host'===e.constructor.MIX_DOM_CLASS)return{MIX_DOM_DEF:'host',tag:null,host:e,key:e,childDefs:[]};if(Array.isArray(e)||e instanceof HTMLCollection||e instanceof NodeList){const t=[...e].map((e=>newDefFrom(e))).filter((e=>e));return t.length?{MIX_DOM_DEF:'fragment',tag:null,isArray:!0,childDefs:t}:null}e=String(e)}return null!=e?{MIX_DOM_DEF:'content',tag:'',domContent:e,childDefs:[]}:null}function newAppliedDef(e,t){const o={MIX_DOM_DEF:e.MIX_DOM_DEF,tag:e.tag,childDefs:[],action:'mounted'};return null!=e.key&&(o.key=e.key),'fragment'===o.MIX_DOM_DEF?(e.isArray&&(o.isArray=!0),e.scopeType&&(o.scopeType=e.scopeType)):'pass'===o.MIX_DOM_DEF?e.getRemote?(o.getRemote=e.getRemote,o.contentPass=e.contentPass||null):o.contentPass=e.contentPass||t||null:e.host&&(o.host=e.host),o}function newContentPassDef(e,t){const o={MIX_DOM_DEF:'pass',tag:null,childDefs:[],contentPassType:t?'copy':'pass'};return null!=e?o.key=e:t||(o.key=a),o}const checkRecursively$1=e=>e.contentPass&&e.contentPass.envelope&&hasContentInDefs(e.contentPass.envelope.applied.childDefs,checkRecursively$1)||!1;function hasContentInDefs(e,t=checkRecursively$1){let o=!1;for(const n of e){if(n.disabled)continue;const e='fragment'===n.MIX_DOM_DEF?hasContentInDefs(n.childDefs,t):'pass'!==n.MIX_DOM_DEF||('function'==typeof t?t(n):t&&'maybe');if(e){if(!0===e)return!0;o=!0}}return o&&'maybe'}class BaseBoundary{constructor(e,t,o){this.host=e,this.treeNode=o,this._outerDef=t,this._innerDef=null,this.isMounted=!1,this.sourceBoundary=null,this.parentBoundary=null,this.innerBoundaries=[]}}function treeNodesWithin(e,t,o=0,n=!1,s=!1,i){const r=[];let l,a=[e],d=0;const c=e.boundary;for(;l=a[d];)if(d++,!l.boundary||null!==l.boundary.isMounted){if((!t||t.has(l.type))&&(!i||i(l))){const e=r.push(l);if(o&&e>=o)return r}l.boundary&&!n&&l.boundary!==c||('host'!==l.type||s)&&l.children[0]&&(a=l.children.concat(a.slice(d)),d=0)}return r}function rootDOMTreeNodes(e,t=!1,o=!1,n=0){let s=[];for(const i of e.children)if(i.domNode||o)switch(i.type){case'dom':if(s.push(i),n&&s.length>=n)return s;break;case'boundary':case'pass':case'host':if(!t)break;case'root':if(s=s.concat(rootDOMTreeNodes(i,t,o,n&&n-s.length)),n&&s.length>=n)return s.slice(0,n)}return s}function allDefsIn(e,t=!1){var o,n;const s=[];let i,r=[e],l=0;for(;i=r[l++];)i.updateId&&t&&i.updateId===(null===(n=null===(o=i.treeNode)||void 0===o?void 0:o.sourceBoundary)||void 0===n?void 0:n.host.services._whileUpdating)||s.push(i),i.childDefs[0]&&(r=i.childDefs.concat(r.slice(l)),l=0);return s}function domElementByQuery(e,t,o=!1,n=!1){const s=treeNodesWithin(e,new Set(['dom']),1,o,n,(e=>e.domNode&&e.domNode instanceof Element&&e.domNode.matches(t)))[0];return s&&s.domNode||null}function domElementsByQuery(e,t,o=0,n=!1,s=!1){return treeNodesWithin(e,new Set(['dom']),o,n,s,(e=>e.domNode&&e.domNode instanceof Element&&e.domNode.matches(t))).map((e=>e.domNode))}class ContentClosure{constructor(e,t){this.thruBoundary=e||null,this.sourceBoundary=t||null,this.envelope=null,this.truePassDef=null,this.groundedDefs=new Map,this.pendingDefs=new Set}hasContent(){var e;return!(!(null===(e=this.envelope)||void 0===e?void 0:e.applied)||!hasContentInDefs(this.envelope.applied.childDefs,!1))}readContent(e=!1){if(!this.envelope)return null;const t=this.envelope.applied,o=t.childDefs;if('fragment'===t.MIX_DOM_DEF&&(!o.length||o[0].disabled&&1===o.length))return null;const n=this.envelope.target.childDefs;return e?n.slice():n}}class ComponentContextAPI extends ContextAPI{afterRefresh(e=!1,t,o){return e?(this.host.triggerRefresh(t,o),this.awaitDelay()):this.host.afterRefresh(!1,t,o)}awaitDelay(){return this.host.afterRefresh(!0)}}function mixinComponent(e){var t;return(t=class Component extends(mixinSignalMan(e)){constructor(e,t,...o){super(...o),this.props=e,t&&(this.boundary=t,t.component=this)}initContextAPI(){if(this.contextAPI)return;this.contextAPI=new ComponentContextAPI;const e=this.contextAPI.host=this.boundary.host;e.contextComponents.add(this),this.contextAPI.setContexts(e.contextAPI.contexts,!1,!0);const t=this.boundary._outerDef.attachedContexts;if(t)for(const e in t)this.contextAPI.setContext(e,t[e],!1)}isMounted(){return!0===this.boundary.isMounted}getLastState(e=!0){return this.lastState||e&&this.state||null}getHost(){return this.boundary.host}queryElement(e,t=!1,o=!1){return domElementByQuery(this.boundary.treeNode,e,t,o)}queryElements(e,t=0,o=!1,n=!1){return domElementsByQuery(this.boundary.treeNode,e,t,o,n)}findElements(e=0,t=!1,o=!1,n){return treeNodesWithin(this.boundary.treeNode,new Set(['dom']),e,t,o,n).map((e=>e.domNode))}findComponents(e=0,t=!1,o=!1,n){return treeNodesWithin(this.boundary.treeNode,new Set(['boundary']),e,t,o,n).map((e=>e.boundary&&e.boundary.component))}findTreeNodes(e,t=0,o=!1,n=!1,s){const i=e?Array.isArray(e)?new Set(e):'[object Set]'===e.toString()?e:new Set(Object.keys(e)):void 0;return treeNodesWithin(this.boundary.treeNode,i,t,o,n,s)}setTimer(e,t,o){return null==e&&(e={}),this.timers?this.timers.has(e)&&this.clearTimers(e):this.timers=new Map,this.timers.set(e,setTimeout((()=>{this.clearTimers(e),t.call(this)}),o)),e}hasTimer(e){return!!this.timers&&this.timers.has(e)}clearTimers(...e){if(this.timers)if(e.length)for(const t of e){const e=this.timers.get(t);null!=e&&(clearTimeout(e),this.timers.delete(t))}else this.timers.forEach((e=>clearTimeout(e))),this.timers.clear()}setUpdateModes(e,t=!0){t&&this.updateModes||(this.updateModes={});for(const t in e)this.updateModes[t]=e[t]}setConstantProps(e,t=!0,o=null){var n,s;t&&this.constantProps||(this.constantProps={});let i=!1;if(e)if(Array.isArray(e))for(const t of e)this.constantProps[t]=null===(n=(i=!0)&&o)||void 0===n||n;else for(const t in e)this.constantProps[t]=null!==(s=(i=!0)&&o)&&void 0!==s?s:e[t];i||t||delete this.constantProps}setState(e,t=!0,o,n,s){this.boundary.updateBy({state:t?Object.assign(Object.assign({},this.state),e):Object.assign({},e)},o,n,s)}setInState(e,t,o,n,s){this.boundary.updateBy({state:Object.assign(Object.assign({},this.state),{[e]:t})},o,n,s)}triggerUpdate(e,t,o){this.boundary.host.services.absorbUpdates(this.boundary,{force:e||!1},!0,t,o)}addWired(e){this.wired?this.wired.add(e):this.wired=new Set([e])}removeWired(e){var t;null===(t=this.wired)||void 0===t||t.delete(e)}afterRefresh(e=!1,t,o){return e?(this.boundary.host.triggerRefresh(t,o),this.awaitDelay()):this.boundary.host.afterRefresh(!1,t,o)}awaitDelay(){return this.boundary.host.afterRefresh(!0)}render(e,t){return null}}).MIX_DOM_CLASS='Component',t}class Component extends(mixinComponent(Object)){constructor(e,t){super(e,t)}}function createComponent(e,t,o){const n=t&&'object'==typeof t?t:void 0,s=(n?o:t)||e.name||'[createComponent]',i=e.length>1?{[s]:(t,o,n)=>e(o,n)}[s]:{[s]:(t,o)=>e(o)}[s];if(n)for(const e in n)i[e]=n[e];return i}function createComponentCtx(e,t,o){const n=t&&'object'==typeof t?t:void 0,s=(n?o:t)||e.name||'[createComponentCtx]',i={[s]:(t,o,n)=>e(o,n)}[s];if(n)for(const e in n)i[e]=n[e];return i}class SourceBoundary extends BaseBoundary{constructor(e,t,o,n){super(e,t,o),this.bId=e.services.createBoundaryId(),this.sourceBoundary=n||null,this.closure=new ContentClosure(this,n)}reattach(){this.component=null;const e=this._outerDef.props||{};let t=this._outerDef.tag;if('function'==typeof t){const o=t.api,n=t.MIX_DOM_CLASS?null:this._outerDef.tag,s=n&&n.length>=3||!1,i=this.component=new(n?SourceBoundary.getComponentFuncClass(n):t)(e,this);if(this.component=i,s&&i.initContextAPI(),n&&(i.render=s?e=>n.call(i,e,i,i.contextAPI):e=>n.call(i,e,i)),i.boundary||(i.boundary=this),o){i.constructor.api=o,o.components.add(i);for(const e in o.signals)for(const t of o.signals[e]){const[o,n,s]=t;i.listenTo(e,((...e)=>n?o(i,...e,...n):o(i,...e)),null,s,o)}}'Remote'===t.MIX_DOM_CLASS&&(this.closure.remote=i,t.addSource(i)),i.signals.preMount&&callListeners(i.signals.preMount)}else this.component=new Component(e,this)}update(e,t,o){this.host.services.absorbUpdates(this,{force:this.isMounted?e||!1:'all'},!0,t,o)}updateBy(e,t,o,n){this.host.services.absorbUpdates(this,Object.assign(Object.assign({},e),{force:this.isMounted?t||!1:'all'}),!0,o,n)}render(e=0){const t=!1===this.isMounted&&!this._renderState;e||(this._renderState='active');const o=this.component,n=o.render(o.props||{},o.state),s='function'==typeof n;if(s&&(o.render=n),t&&o.contextAPI&&o.contextAPI.callDataBy(),s)return this.render(e);if('re-updated'===this._renderState){const t=this.host.settings;if(t.maxReRenders<0||e<t.maxReRenders)return e++,this._renderState='active',this.render(e);t.debugMode&&console.warn('__SourceBoundary.render: Warning: The component tried to render for over '+(e+1).toString()+' times.',this._outerDef.tag.MIX_DOM_CLASS?o.constructor:this._outerDef.tag,o)}return delete this._renderState,n}static getComponentFuncClass(e){let t=!1;for(const o in e){t=!0;break}if(!t)return Component;const o={[e.name]:class extends Component{}}[e.name];for(const t in e)o[t]=e[t];return o}}const d=newContentPassDef(),c=newContentPassDef({},!0);class Ref extends SignalBoy{constructor(...e){super(...e),this.treeNodes=new Set}getTreeNode(){return[...this.treeNodes][this.treeNodes.size-1]||null}getTreeNodes(){return[...this.treeNodes]}getElement(e=!1){let t=this.treeNodes.size-1;const o=[...this.treeNodes];for(;t>=0;){const n=o[t];if(n.domNode&&(!e||'dom'===n.type))return n.domNode}return null}getElements(e=!1){let t=[];for(const o of this.treeNodes)o.domNode&&('dom'===o.type?t.push(o.domNode):e||(t=t.concat(rootDOMTreeNodes(o,!0).map((e=>e.domNode)))));return t}getComponent(){var e;const t=[...this.treeNodes][this.treeNodes.size-1];return t&&'boundary'===t.type&&(null===(e=t.boundary)||void 0===e?void 0:e.component)||null}getComponents(){var e;const t=[];for(const o of this.treeNodes)'boundary'===o.type&&(null===(e=o.boundary)||void 0===e?void 0:e.component)&&t.push(o.boundary.component);return t}static onListener(e,t,o,n){if(e.treeNodes.size&&e.signals[t]){const s=e.signals[t][o],i=s[0];if(n)for(const o of e.getComponents())o.listenTo(t,((...e)=>s[1]?i(o,...e,...s[1]):i(o,...e)),null,s[2],i);else for(const o of e.getComponents())o.unlistenTo(t,i)}}static didAttachOn(e,t){var o;if(!e.treeNodes.has(t))if(e.treeNodes.add(t),'boundary'===t.type){const n=null===(o=t.boundary)||void 0===o?void 0:o.component;for(const t in e.signals)for(const o of e.signals[t]){const[e,s,i]=o;n.listenTo(t,((...t)=>s?e(n,...t,...s):e(n,...t)),null,i,e)}n&&e.signals.didAttach&&callListeners(e.signals.didAttach,[n])}else'dom'===t.type&&t.domNode&&e.signals.domDidAttach&&callListeners(e.signals.domDidAttach,[t.domNode])}static willDetachFrom(e,t){var o;if(e.treeNodes.has(t))if('boundary'===t.type){const n=null===(o=t.boundary)||void 0===o?void 0:o.component;if(n){e.signals.willDetach&&callListeners(e.signals.willDetach,[n]);for(const t in e.signals)for(const o of e.signals[t])n.unlistenTo(t,o[0])}}else'dom'===t.type&&t.domNode&&e.signals.domWillDetach&&callListeners(e.signals.domWillDetach,[t.domNode]);e.treeNodes.delete(t)}}Ref.MIX_DOM_CLASS='Ref';class HostContextAPI extends ContextAPI{setContext(e,t,o=!0,n=!1){return n&&(t?this.host.shadowAPI.contexts[e]=t:delete this.host.shadowAPI.contexts[e]),void 0!==this.constructor.modifyContexts(this,{[e]:t},o,!1)[0]}setContexts(e,t=!0,o=!1){if(o){const t=this.host.shadowAPI.contexts;for(const o in e)e[o]?t[o]=e[o]:delete t[o]}return this.constructor.modifyContexts(this,e,t,!1)}awaitDelay(){return this.host.services.renderCycle.promise}afterRefresh(e,t,o){return this.host.services.triggerRefresh(t,o),e?this.awaitDelay():this.host.services.updateCycle.promise}static modifyContexts(e,t,o,n){const s=super.modifyContexts(e,t,o,n);for(const n of e.host.contextComponents)n.contextAPI.setContexts(t,o,!0);return s}}class ContentBoundary extends BaseBoundary{constructor(e,t,o,n){super(n.host,e,o),this.sourceBoundary=n,this.targetDef=t,this._innerDef=newAppliedDef(t,n.closure)}updateEnvelope(e,t){this.targetDef=e,t&&(this._innerDef.childDefs=t.childDefs)}}class HostShadowAPI{constructor(){this.hosts=new Set,this.contexts={}}}class HostRender{constructor(e,t){this.assimilationRoot=t||null,this.paused=e.disableRendering,this.settings=e,this.externalElements=new Set,this.inBrowser='object'==typeof document}pause(){this.paused=!0}resume(){this.paused&&(this.paused=!1,this.assimilationRoot&&this.reassimilate(null,!0))}reassimilate(e=null,t=!1,o=!1,n=!1,s,i){var r;const l=this.assimilationRoot;if(!l)return void(this.settings.debugMode&&console.warn('__HostRender.reassimilate: Warning: No assimilation root assigned. ',this));const a=e?HostRender.createVirtualItemsFor(e):{};a.validator=s,a.suggester=i;const d=a.reused=new Set(e?[...this.externalElements,e]:this.externalElements),c=[];for(const[e,,n]of HostRender.getVirtualDomPairs(l,a,!1)){let s=e.domNode;!n||e.domNode&&!o||(s=n),s&&d.add(s);const i={treeNode:e};let r=t;if(s!==e.domNode&&(r=!0,e.domNode?s&&(i.swap=s):i.create=!0),!i.create&&s){const[t,o]=HostRender.findInsertionNodes(e);s.parentNode===t&&s.nextSibling===o||(i.move=!0),'content'===e.def.MIX_DOM_DEF?i.content=!0:(r&&(e.domProps=readDOMProps(s)),i.update=!0)}(i.create||i.swap||i.move||i.update||i.content)&&c.push(i)}if(n&&e){let t,o=e===l.domNode?rootDOMTreeNodes(l.children[0],!0).map((e=>e.domNode)).filter((e=>e)):[...e.childNodes],n=0;for(;t=o[n];)n++,d.has(t)?t.childNodes[0]&&(o=[...t.childNodes,...o.slice(n)],n=0):null===(r=t.parentNode)||void 0===r||r.removeChild(t)}if(this.settings.disableRendering||(this.paused=!1),c[0]&&this.applyToDOM(c),this.pausedPending){const e=this.pausedPending.filter((e=>e.treeNode.domNode&&!d.has(e.treeNode.domNode)));delete this.pausedPending,e[0]&&this.applyToDOM(e)}}applyToDOM(e){var t;const o=this.sourceRemount;if(o&&this.assimilationRoot&&HostRender.onRemount(o,this.assimilationRoot),this.paused){const t=e.filter((e=>e.remove));return void(t[0]&&(this.pausedPending=(this.pausedPending||[]).concat(t)))}const n=this.settings;let s=null,i=null,r=null,l=null;for(const a of e){const e=a.treeNode,d=e.def.attachedSignals,c=e.def.attachedRefs;if(a.remove){if('dom'===e.type&&e.domNode){const t=e.domNode,o=t.parentNode;let n=!1;if((null==d?void 0:d.domWillUnmount)&&d.domWillUnmount(t)&&(n=!0),c)for(const o of c)o.signals.domWillUnmount&&askListeners(o.signals.domWillUnmount,[t],['no-false','last'])&&(n=!0),Ref.willDetachFrom(o,e);n?r?r.push(t):r=[t]:!o||i&&-1!==i.indexOf(o)||r&&r.some((e=>e.contains(t)))||o.removeChild(t);const s='element'===e.def.MIX_DOM_DEF;(s||'content'===e.def.MIX_DOM_DEF)&&this.externalElements.delete(t),s||(i||(i=[])).push(t),e.domNode=null,HostRender.updateDOMChainBy(e,null)}continue}let u=!1,p=0;if(a.refresh&&e.domNode&&e.domProps&&(e.domProps='read'===a.refresh?readDOMProps(e.domNode):{},u=!0),a.create)if(e.domNode)p=!o||e.domNode.nodeType!==Node.TEXT_NODE||!0!==o.readFromDOM&&'content'!==o.readFromDOM?2:3;else switch(e.type){case'dom':const t=this.createDOMNodeBy(e);t&&(e.domNode=t,p=1,o&&o.created&&o.created.add(t));break;case'portal':e.domNode=e.def.domPortal||null}if(p||a.move)if('host'===e.type){const t=e.def.host||null;t&&t.services.refreshRoot(!1,null,null),e.domNode=e.parent&&t&&t.getRootElement()||null,HostRender.updateDOMChainBy(e,e.domNode)}else e.domNode&&(p<2||!e.domNode.parentElement?(s||(s=[])).push(a):((e.def.attachedRefs||e.def.attachedSignals)&&(l||(l=[])).push([!0,a.treeNode,e.domNode.parentElement,e.domNode.nextSibling]),HostRender.updateDOMChainBy(e,e.domNode)));if(a.swap){const o=!0!==a.swap,s=e.domNode;let i=o?a.swap:('portal'===e.type?e.def.domPortal:e.def.domElement)||null;if(s!==i){if(!o&&'dom'===e.type){const o=e,r=s&&s.parentNode;if(i&&(i=this.getApprovedNode(i,o),i)){let[t,o]=r?[r,s]:HostRender.findInsertionNodes(e);t&&t.insertBefore(i,o)}if(s){if(this.externalElements.delete(s),(null===(t=o.domProps)||void 0===t?void 0:t.listeners)&&s instanceof Element){const e=o.domProps.listeners;for(const t in e)e[t]&&s.removeEventListener(t,e[t])}r&&r.removeChild(s)}o.domProps&&(o.domProps=i&&'read'===n.renderDOMPropsOnSwap?readDOMProps(i):{},u=!0)}for(const t of e.children){const e=t.domNode;e&&(e.parentNode&&e.parentNode.removeChild(e),i&&i.appendChild(e))}e.domNode=i,HostRender.updateDOMChainBy(e,i)}}if((a.content||3===p)&&'dom'===e.type&&e.domNode){const t=e.def.domContent,o=e.domNode;let s=o;if('content'===e.def.MIX_DOM_DEF)if(e.def.domHTMLMode&&null!=t&&''!==t)s=HostRender.domNodeFrom(t.toString(),e.def.tag||n.renderHTMLDefTag,!0),s&&e.domProps&&(u=!0,e.domProps={});else{const e=null==t?'':(n.renderTextHandler?n.renderTextHandler(t):t).toString();o.nodeType!==Node.TEXT_NODE&&this.inBrowser?s=document.createTextNode(e):o.textContent=e}else if(t instanceof Node){const e=t.parentNode;e&&e.removeChild(t)}else o.textContent='';if(s&&o!==s){const t=o.parentNode;t&&(e.domNode=s,t.insertBefore(s,o),t.removeChild(o)),HostRender.updateDOMChainBy(e,e.domNode)}if((null==d?void 0:d.domDidContent)&&d.domDidContent(e.domNode,null!=t?t:null),c)for(const o of c)o.signals.domDidContent&&callListeners(o.signals.domDidContent,[e.domNode,null!=t?t:null])}if((p||u||a.update)&&'dom'===e.type){const t=e.domNode instanceof Element?e.domNode:null,o=e.def.props||{},s=applyDOMProps(e.domNode instanceof Element?e.domNode:null,o,e.domProps||{},n.debugMode);if(e.domProps=o,s&&a.update&&t&&((null==d?void 0:d.domDidUpdate)&&d.domDidUpdate(t,s),c))for(const e of c)e.signals.domDidUpdate&&callListeners(e.signals.domDidUpdate,[t,s])}a.emptyMove&&HostRender.updateDOMChainBy(e,null,!0)}if(s){const e=[];let t=s.length;for(;t--;){const o=s[t],n=o.treeNode,i=n.domNode;if(i){const t=i.parentNode,s=i.nextSibling,[r,a]=i?HostRender.findInsertionNodes(n):[null,null];r===t&&a===s||(r&&e.push([i,r,a]),(n.def.attachedRefs||n.def.attachedSignals)&&(l||(l=[])).push([!o.move,o.treeNode,t,s]),t&&t.removeChild(i))}HostRender.updateDOMChainBy(n,i)}if(e[0])for(const t of e)t[1].insertBefore(t[0],t[2])}if(l){let e=l.length;for(;e--;){const[t,o,n,s]=l[e],{attachedSignals:i,attachedRefs:r}=o.def,a=o.domNode;if(i&&(t?i.domDidMount&&i.domDidMount(a):i.domDidMove&&i.domDidMove(a,n,s)),r)for(const e of r)t?(Ref.didAttachOn(e,o),e.signals.domDidMount&&callListeners(e.signals.domDidMount,[a])):e.signals.domDidMove&&callListeners(e.signals.domDidMove,[a,n,s])}}}getApprovedNode(e,t){let o=e;const n=null!=t.def.domCloneMode?t.def.domCloneMode:this.settings.duplicateDOMNodeBehaviour;return('always'===n||this.externalElements.has(e))&&(o=this.settings.duplicateDOMNodeHandler?this.settings.duplicateDOMNodeHandler(e,t):n?e.cloneNode('deep'===n||'always'===n):null),o&&this.externalElements.add(o),o}createDOMNodeBy(e){var t;const o=e.def.tag;if('string'!=typeof o)return null;if('_'===o)return e.def.domElement&&this.getApprovedNode(e.def.domElement,e)||null;const n=e.def.domContent;if(n instanceof Node)return this.getApprovedNode(n,e);const s=this.settings;if(e.def.domHTMLMode&&null!=n&&''!==n)return HostRender.domNodeFrom(n.toString(),o||s.renderHTMLDefTag,!0);if(o)return this.inBrowser?function createDOMElement(e,t,o){return'svg'===e||t&&(!0===t||void 0!==t.ownerSVGElement)?document.createElementNS(o||'http://www.w3.org/2000/svg',e):document.createElement(e)}(o,null===(t=e.parent)||void 0===t?void 0:t.domNode,s.renderSVGNamespaceURI):null;let i=null,r='',l='';if(null!=n){l=(s.renderTextHandler?s.renderTextHandler(n):n).toString();const e=s.renderTextTag;if(e)if('string'==typeof e)r=e;else if('function'==typeof e){const t=e(n);t instanceof Node&&(i=t)}}if(!i){if(!this.inBrowser)return null;i=r?document.createElement(r):document.createTextNode(l)}return r&&l&&(i.textContent=l),i}static escapeHTML(e){return e.replace(/\&(?!(\w+;))/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}static findInsertionNodes(e){let t=null,o=e.parent;for(;o;){if(!(HostRender.PASSING_TYPES[o.type]||'root'===o.type&&o.parent)){t=o.domNode;break}o=o.parent}if(!t)return[null,null];let n=null,s=e;for(;s&&(o=s.parent,o);){let e,i=o.children.indexOf(s)+1;for(;e=o.children[i];){if(e.domNode&&'portal'!==e.type){n=e.domNode;break}i++}if(n||o.domNode===t)break;s=o}return[t,n]}static updateDOMChainBy(e,t,o=!1){let n=e,s=o?e:e.parent,i=t;for(;s&&(HostRender.PASSING_TYPES[s.type]||s===n);){if(s.children[0]!==n&&s!==n){let e=!1,t=s.children.indexOf(n)-1;for(;t>=0;){if(s.children[t].domNode){e=!0;break}t--}if(e)break}if(!i){let e,t=s.children.indexOf(n)+1;for(;e=s.children[t];){if(e.domNode&&'portal'!==e.type){i=e.domNode;break}t++}if(i&&s.domNode===i)break}s.domNode=i,n=s,s=s.parent}}static domNodeFrom(e,t='div',o=!1){const n=t instanceof Element?t:'object'==typeof document?document.createElement(t):null;return n?(n.innerHTML=e,o||n.children[1]?n:n.children[0]):null}static readDOMString(e,t=!1,o=-1,s=n){const i=e.def;if(!i)return'';let r=i.tag,l='';if('string'!=typeof r){if(e.children)for(const n of e.children)l+=HostRender.readDOMString(n,t,o,s);return l}let a=null;if(r)'_'===r&&(r='',a=i.domElement||null);else{const e=i.domContent;e&&(e instanceof Node?a=e:l+=e.toString())}if(!r&&!a)return l;const d=o>=0?'\n'+'\t'.repeat(o):'',c=o>=0?o+1:o,u=(null!=i.domContent?i.domContent instanceof Node?readDOMString('',null,null,i.domContent):t?HostRender.escapeHTML(i.domContent.toString()):i.domContent.toString():'')+(e.children?e.children.reduce(((e,o)=>e+HostRender.readDOMString(o,t,c,s)),''):'');return l+=d+readDOMString(r,e.domProps,u+(d&&e.children.some((e=>'dom'!==e.type||e.def.tag))?d:'')||s&&!s.includes(r),a||((null==i?void 0:i.domContent)instanceof Node?i.domContent:null)),l}static onRemount(e,t){let{reused:o,readFromDOM:n}=e;o||(o=e.reused=new Set),t.domNode&&o.add(t.domNode);for(const[s,i,r]of HostRender.getVirtualDomPairs(t,e,!0)){if(!0!==n&&'attributes'!==n||(s.domProps=readDOMProps(r)),s.domNode=r,o.add(r),s.def.domHTMLMode&&i)for(const e of HostRender.flattenVirtualItems(i))o.add(e.node);if(r.parentElement){let e=s;for(;e=e.parent;)if('dom'===e.type){r.parentElement!==e.domNode&&r.parentElement.removeChild(r);break}}}if(e.vRoot)for(const t of HostRender.flattenVirtualItems(e.vRoot)){if(o.has(t.node))continue;const n=t.node;e.unused&&e.unused.add(n),e.removeUnused&&n.parentElement&&n.parentElement.removeChild(n)}}static createVirtualItemsFor(e){var t,o;let n=null;const s={};if(n={tag:(null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase())||'',node:e,parent:null},e.childNodes[0]){let t,i=[[[...e.childNodes],n]],r=0;for(;t=i[r];){r++;const[e,n]=t;n.children||(n.children=[]);let l=[];for(const t of e){const e={tag:(null===(o=t.tagName)||void 0===o?void 0:o.toLowerCase())||'',node:t,parent:n},i=t instanceof Element?t.getAttribute('_key'):null;null!=i&&(e.key=i,(s[e.tag]||(s[e.tag]=[])).push(e)),n.children.push(e),t.childNodes[0]&&l.push([[...t.childNodes],e])}l[0]&&(i=l.concat(i.slice(r)),r=0)}}return{vRoot:n,vKeyedByTags:s}}static flattenVirtualItems(e){let t,o=[e],n=0;for(;t=o[n++];)t.children&&t.children[0]&&(o=o.slice(0,n).concat(t.children.concat(o.slice(n))));return o}static getVirtualDomPairs(e,t,o){const{vRoot:n,vKeyedByTags:s,validator:i,suggester:r}=t,l=t.reused||new Set;let a,d=[],c=[[e,n||null]],u=0;for(;a=c[u++];){let[e,t]=a;if('dom'===e.type){const n=HostRender.getTreeNodeMatch(e,t,s,l,i,r);if(n){let o;n instanceof Node?(o=n,d.push([e,null,n])):(t=n,o=t.node),d.push([e,n===o?null:n,o]),l.add(o)}else o||d.push([e,t,null]),e.domNode&&l.add(e.domNode)}e.children[0]&&(c=e.children.map((e=>[e,t])).concat(c.slice(u)),u=0)}return d}static getTreeNodeMatch(e,t,o,n,s,i){const r=e.def.tag,l=e.def.key;if(i){const o=i(t,e,r,l);if(o&&(o instanceof Element?o.tagName.toLowerCase():'')===r&&(o instanceof Node?!(null==n?void 0:n.has(o)):!(null==n?void 0:n.has(o.node))&&HostRender.isVirtualItemOk(e,o,t,s)))return o}const a=null!=l;if(t)for(const o of t.children?[t,...t.children]:[t])if(!o.used&&o.tag===r&&(a?o.key===l:null==o.key)&&!(null==n?void 0:n.has(o.node))&&(!s||s(o,e,r,l)))return o;if(o&&a){const i=o[r];if(i)for(const o of i)if(!o.used&&o.key===l&&!(null==n?void 0:n.has(o.node))&&HostRender.isVirtualItemOk(e,o,t,s))return o}return null}static isVirtualItemOk(e,t,o,n){if(t.tag!==e.def.tag)return!1;const s=e.def;if(o){let i=t;for(;i;){if(i===o)return!n||n(t,e,s.tag,s.key);i=i.parent}}else if(!n||n(t,e,s.tag,s.key))return!0;return!1}}function mergeChangesTo(e,...t){for(const o of t)o&&o[0][0]&&(e[0]=e[0].concat(o[0])),o&&o[1][0]&&(e[1]=e[1].concat(o[1]))}function sortBoundaries(e){const t=new Map;for(const o of e){let e=o.bId,n=o.parentBoundary;for(;n;)e=(n.bId||'')+'>'+e,n=n.parentBoundary;const s=t.get(e);if(s){let e=0;if(o.parentBoundary){const t=o.parentBoundary.innerBoundaries,n=t.indexOf(o);for(const o of s){if(n<t.indexOf(o))break;e++}}s.splice(e,0,o)}else t.set(e,[o])}const o=[];for(const e of t.keys()){let t=0,n=!1;for(const s of o){if(s.startsWith(e+'>'))break;if(e.startsWith(s+'>'))n=!0;else if(n)break;t++}o.splice(t,0,e)}let n=0;const s=[];for(const e of o)for(const o of t.get(e))s[n++]=o;return s}function updatedInterestedInClosure(e,t=!0){let o=[[],[]];for(const n of t&&e.size>1?sortBoundaries(e):e){if(!n._forceUpdate&&!n.component.lastState&&n.component.props===n._outerDef.props)continue;const e=n.host.services.updateBoundary(n);e&&mergeChangesTo(o,e)}return o}function collectInterestedInClosure(e,t){if(t){const e=new Set;if(t.closure.withContents)for(const o of t.closure.withContents)e.add(o);for(const o of t.constructor.WithContent.withContents)e.add(o);return e.size?e:null}if(!e.withContents&&!e.chainedClosures)return null;const o=e.withContents?new Set(e.withContents):new Set;if(e.chainedClosures)for(const t of e.chainedClosures){const e=collectInterestedInClosure(t);if(e)for(const t of e)o.add(t)}return o.size?o:null}HostRender.PASSING_TYPES={boundary:!0,pass:!0,host:!0,fragment:!0};const u={fragment:1,portal:2,pass:3,host:4};function assignTreeNodesFor(e,t,o,n,s){t.children[0]&&(t.children=[]);const i=e.length;if(!i)return[];const r=[];let l=0,a=null,d=t;if(o){if(!t.parent)return[];if(d=t.parent,a=t,l=d.children.indexOf(t),-1===l)return[]}for(let t=0;t<i;t++){const o=e[t];if(o.disabled){l--,r.push(null);continue}let i=null;o.treeNode?i=o.treeNode:'fragment'!==o.MIX_DOM_DEF&&(o.action='mounted'),a&&(i?d.children.splice(l,1):i=a,a=null);const c=o.MIX_DOM_DEF,u='content'===c||'element'===c?'dom':'fragment'===c?'':c;if(i){if(i.parent){const e=i.parent.children.indexOf(i);0===e&&i.parent!==d&&!0===HostRender.PASSING_TYPES[i.parent.type]&&s&&-1===s.indexOf(i.parent)&&s.push(i.parent),-1!==e&&i.parent.children.splice(e,1)}i.parent=d,i.sourceBoundary=n||null,i.type=u}else i={type:u,parent:d,children:[],sourceBoundary:n||null,domNode:null},'dom'===i.type&&(i.domProps={});'fragment'!==o.MIX_DOM_DEF&&(i.def=o,o.treeNode=i),d.children.splice(l+t,0,i),r.push(i)}return r}function findAppliedDefsFor(e,t,o,n,s,i,r){var l,a,d,c,p,f;let h=t.childDefs.length;if(!h)return[];const m=i||!t.isArray;if(!i&&t.isArray!=(e&&e.isArray))return t.childDefs.map((e=>newAppliedDef(e,s&&s.closure||null)));const g=e&&e.childDefs||null,y=[];for(let i=0;i<h;i++){const h=t.childDefs[i],v=null!=h.key,b=h.MIX_DOM_DEF,C=h.getRemote||u[b]||h.tag;let D=!1,w=null;if(g)for(const e of g)if((v?e.key===h.key:null==e.key)&&C===(e.getRemote||u[e.MIX_DOM_DEF]||e.tag)&&n.has(e)&&('boundary'!==b||!(null===(d=null===(a=null===(l=e.treeNode)||void 0===l?void 0:l.boundary)||void 0===a?void 0:a.component)||void 0===d?void 0:d.constantProps)||areEqualBy(h.props,e.props,e.treeNode.boundary.component.constantProps))){w=e,n.delete(e),w.updateId&&w.updateId!==r&&delete w.updateId;break}if(!w&&v&&m){const e=o&&o.get(C);if(e)for(const t of e)if(t.key===h.key&&n.has(t)&&('boundary'!==b||!(null===(f=null===(p=null===(c=t.treeNode)||void 0===c?void 0:c.boundary)||void 0===p?void 0:p.component)||void 0===f?void 0:f.constantProps)||areEqualBy(h.props,t.props,t.treeNode.boundary.component.constantProps))){w=t,n.delete(t),D=!0;for(const e of allDefsIn(w))e.updateId=r;break}}w?w.action=D||!e||e.childDefs[i]!==w?'moved':'updated':w=newAppliedDef(h,s&&s.closure||null),y.push(w)}return y}function buildDefMaps(e,t=!1,o=new Set,n){const s=new Map;let i,r=t?e.childDefs.slice():[e],l=0;for(;i=r[l];){l++,o.add(i);const e=i.getRemote||u[i.MIX_DOM_DEF]||i.tag,t=s.get(e);if(t?t.push(i):s.set(e,[i]),i.scopeType)if('spread-pass'===i.scopeType)n&&n.push(i);else{const e=[];i.scopeMap=buildDefMaps(i,!0,o,e)[0],e[0]&&(r=e[0].childDefs.concat(r.slice(l)),l=0)}else i.childDefs[0]&&(r=i.childDefs.concat(r.slice(l)),l=0)}return[s,o]}function runPassUpdate(e,t=!1){const[o,n,s]=function assignTreeNodesForPass(e){const t=e._innerDef,o=e.sourceBoundary,n=[],s=[],i=[];let r,l=[[e.targetDef,t,e.treeNode,!1]],a=0;for(;r=l[a];){a++;const[e,t,d,c]=r;if(c&&!e.childDefs[0]&&d&&!d.type&&d.parent){const e=d.parent.children,t=e.indexOf(d);-1!==t&&e.splice(t,1),d.sourceBoundary=null}else{if(t.childDefs[0]){const i=d&&'boundary'!==e.MIX_DOM_DEF&&('element'!==e.MIX_DOM_DEF||e.domElement)?assignTreeNodesFor(t.childDefs,d,c,o,s):[];let r=0;const u=[];for(const o of t.childDefs){const t=i[r]||null;!t&&o.treeNode&&(n.push(o.treeNode),o.treeNode.sourceBoundary=null),u.push([e.childDefs[r],o,t,'fragment'===o.MIX_DOM_DEF]),r++}l=u.concat(l.slice(a)),a=0}d&&!t.disabled&&i.push([e,t,d])}}return[i,n,s]}(e);let[i,r]=applyDefPairs(e,o,t);if(n[0]){const e=new Set;for(const t of n)t.sourceBoundary||(t.def&&e.add(t.def),t.parent=null);if(e.size){const t=cleanUpDefs(e);i=t[0].concat(i),r=t[1].concat(r)}}return s[0]&&(i=s.map((e=>({treeNode:e,emptyMove:!0}))).concat(i)),e.isMounted=!0,[i,r]}function runBoundaryUpdate(e,t=!1){let o,n,s=null,i=e._innerDef;e.bId?(s=newDefFrom(e.render()),s&&!i&&(i=newAppliedDef(s,e.closure))):s=e.targetDef;const[r,l]=i?buildDefMaps(i):[new Map,new Set],a=[];if(s){const d=[],c=function pairDefs(e,t,o,n,s,i,r){const l=e.host.settings,a=l.noRenderValuesMode,d=l.wideKeysInArrays,c=[],u=e.bId?e:e.sourceBoundary;let p,f=[[{childDefs:[t]},{childDefs:[o]},e.treeNode,!1,null]],h=0;for(;p=f[h];){h++;const[t,o,l,m]=p,g='spread-pass'===o.scopeType?void 0:o.scopeMap||p[5];if(t.childDefs[0]){const c=findAppliedDefsFor(o,t,g||n,s,u,d,e.host.services._whileUpdating);o.childDefs=c;for(let e,n=0;e=t.childDefs[n];n++)if('content'===e.MIX_DOM_DEF){const t=o.childDefs[n];a&&(!0===a?!e.domContent:-1!==a.indexOf(e.domContent))?t.disabled=!0:delete t.disabled}const y='boundary'===t.MIX_DOM_DEF,v=p[4]||y&&o;y&&delete o.hasPassWithin;const b=!l||y||'element'===t.MIX_DOM_DEF&&!t.domElement?[]:assignTreeNodesFor(c,l,m,u,r),C=[];for(let e,o=0;e=t.childDefs[o];o++){const t=b[o]||null,n=c[o];!t&&n.treeNode&&(n.treeNode.sourceBoundary=null,i&&i.push(n)),v&&'pass'===e.MIX_DOM_DEF&&(v.hasPassWithin=!0);const s=[e,n,t,'fragment'===e.MIX_DOM_DEF,v||'boundary'===e.MIX_DOM_DEF&&n||null];C.push(s),g&&(s[5]=g)}f=C.concat(f.slice(h)),h=0}else o.childDefs=[];l&&t.MIX_DOM_DEF&&o.MIX_DOM_DEF&&c.push([t,o,l])}return c}(e,s,i,r,l,d,a);if(e._innerDef=c[0][1],[o,n]=applyDefPairs(e,c,t),d[0])for(const e of d){const t=e.treeNode;t&&null===t.sourceBoundary&&l.add(e)}}else o=[],n=[],!i&&e.isMounted||a.push(e.treeNode),e.innerBoundaries=[],e.treeNode.children=[],e._innerDef=null;if(l.size){const e=cleanUpDefs(l);o=e[0].concat(o),n=e[1].concat(n)}return a[0]&&(o=a.map((e=>({treeNode:e,emptyMove:!0}))).concat(o)),e.isMounted||(e.isMounted=!0),[o,n]}function applyDefPairs(e,t,o=!1){var n,s;const i=e.bId?e:e.sourceBoundary,r=[],l=e.host.settings.preCompareDOMProps;e.innerBoundaries=[];let a=[[],[]];for(const c of t){const[t,u,p]=c,f='mounted'===u.action;if(!f&&'moved'===u.action)switch(u.MIX_DOM_DEF){case'fragment':for(const e of rootDOMTreeNodes(p,!0,!0))-1===r.indexOf(e)&&(r.push(e),a[0].push({treeNode:e,move:!0}));break;case'host':u.host&&u.host.groundedTree.parent===p&&a[0].push({treeNode:p,move:!0})}if('fragment'===u.MIX_DOM_DEF)continue;if('pass'===p.type){if('pass'!==u.MIX_DOM_DEF)continue;let t=d.key;if(u.getRemote){const o=u.getRemote();t=null===(n=o.Content)||void 0===n?void 0:n.key,mergeChangesTo(a,groundClosureContent(o.closure,u,e,p,u.key!==t?u.key:null))}else u.contentPass&&mergeChangesTo(a,groundClosureContent(u.contentPass,u,e,p,u.key!==t?u.key:null));p.boundary&&e.innerBoundaries.push(p.boundary);continue}const h=u.props;let m=!1;t.props&&(p.boundary&&(p.boundary._outerDef.props=t.props),u.props=t.props||{});let g=!1;switch(u.MIX_DOM_DEF){case'content':g=!0;const o=t.domHTMLMode;m=u.domContent!==t.domContent||o!==t.domHTMLMode,m&&(u.domContent=t.domContent,void 0!==o?u.domHTMLMode=o:delete u.domHTMLMode);break;case'element':g=!0,u.domElement!==t.domElement&&(f||a[0].push({treeNode:p,swap:!0}),u.domElement=t.domElement||null),u.domCloneMode=null!=t.domCloneMode?t.domCloneMode:null;break;case'dom':g=!0;break;case'portal':u.domPortal!==t.domPortal&&(a[0].push({treeNode:p,[f?'create':'swap']:!0}),u.domPortal=t.domPortal||null);break;case'boundary':if(f){t.attachedContexts&&(u.attachedContexts=t.attachedContexts);const o=new SourceBoundary(e.host,u,p,i);o.parentBoundary=e,p.boundary=o}break;case'host':if(u.host){const e=u.host;let t=e;if('mounted'===u.action){if(e.groundedTree.parent){const o=t.settings.duplicatableHost;if('function'==typeof o){const e=o(u.host,p);if(!e)break;if('object'==typeof e){if(e.groundedTree.parent)break;t=e}}else if(!o)break;const n=e.shadowAPI;t===e?t=new e.constructor(e.services.getRootDef(!0),null,e.settings,null,n):t.shadowAPI!==e.shadowAPI&&(t.shadowAPI.hosts.delete(t),t.shadowAPI=e.shadowAPI);for(const e in n.contexts){const o=n.contexts[e];o&&t.contextAPI.setContext(e,o,!1)}u.host=t}e.shadowAPI.hosts.add(t)}t.groundedTree.parent=p,p.children=[t.groundedTree],a[0].push({treeNode:p,move:!0});break}}if(g){if(f)a[0].push({treeNode:p,create:!0});else{const e='moved'===u.action&&-1===r.indexOf(p),o=!!u.tag&&(!l||'if-needed'===l&&(m||e)||!equalDOMProps(h||{},t.props||{}));if(o||m||e){const t={treeNode:p};o&&(t.update=!0),m&&(t.content=!0),e&&(t.move=!0,r.push(p)),a[0].push(t)}}u.attachedSignals!==t.attachedSignals&&(t.attachedSignals?u.attachedSignals=t.attachedSignals:delete u.attachedSignals)}if(p.boundary){const n=p.boundary;if(e.innerBoundaries.push(n),f){if(u.tag&&u.tag._WithContent){const e=u.tag._WithContent,t=e.getRemote?e.getRemote().closure:i.closure;(t.withContents||(t.withContents=new Set)).add(n)}n.reattach()}const l=n.component;if(u.attachedSignals!==t.attachedSignals){const e=getDictionaryDiffs(u.attachedSignals||{},t.attachedSignals||{});if(e)for(const t in e)e[t]?l.listenTo(t,e[t]):l.unlistenTo(t,u.attachedSignals[t]);u.attachedSignals=t.attachedSignals}if(u.attachedContexts!==t.attachedContexts){if(l.contextAPI){const e=getDictionaryDiffs(u.attachedSignals||{},t.attachedSignals||{});if(e){for(const t in e)e[t]?l.contextAPI.setContext(t,e[t]):l.contextAPI.setContext(t,null);l.contextAPI.callDataBy(f||Object.keys(e))}}u.attachedContexts=t.attachedContexts}let d=null;const c=n.closure.envelope;t.childDefs[0]&&(d=c?{applied:Object.assign(Object.assign({},c.applied),{childDefs:u.childDefs,action:u.action}),target:Object.assign(Object.assign({},c.target),{childDefs:t.childDefs})}:{applied:{tag:null,MIX_DOM_DEF:'fragment',childDefs:u.childDefs,action:'mounted'},target:{tag:null,MIX_DOM_DEF:'fragment',childDefs:t.childDefs}});const h=c||d?n.closure:null;let m=null;if(h){m=preRefreshClosure(h,d);const e=i.closure;u.hasPassWithin?(e.chainedClosures||(e.chainedClosures=new Set)).add(h):null===(s=e.chainedClosures)||void 0===s||s.delete(h)}mergeChangesTo(a,e.host.services.updateBoundary(n,o,r,m)),h&&mergeChangesTo(a,applyClosureRefresh(h,o))}if(u.attachedRefs||t.attachedRefs){const e=u.attachedRefs,o=t.attachedRefs;if(e)for(const t of e)o&&o.includes(t)||Ref.willDetachFrom(t,p);if(o)for(const t of o)e&&e.includes(t)||Ref.didAttachOn(t,p);u.attachedRefs=o}}return a}function cleanUpDefs(e,t=!0,o=!0){var n;let s=[[],[]];for(const i of e){const e=i.treeNode;if(e){switch(i.MIX_DOM_DEF){case'dom':case'element':case'content':o&&s[0].push({treeNode:e,remove:!0});break;case'boundary':e.boundary&&mergeChangesTo(s,destroyBoundary(e.boundary,!1,o));break;case'pass':(i.contentPass||i.getRemote)&&mergeChangesTo(s,ungroundClosureContent(i.contentPass||i.getRemote().closure,i));case'host':{const t=i.host;if(t&&t.groundedTree.parent===e){t.groundedTree.parent=null,e.children=[],s[0].push({treeNode:e,move:!0}),t.shadowAPI.hosts.delete(t);const o=t.contextAPI.getContexts(null,!0,!0);for(const e in o)o[e].contextAPIs.delete(t.contextAPI)}}default:if(i.attachedRefs&&i.MIX_DOM_DEF)for(const t of i.attachedRefs)Ref.willDetachFrom(t,e)}t&&('pass'===(null===(n=e.parent)||void 0===n?void 0:n.type)&&e.parent.def.getRemote&&s[0].push({emptyMove:!0,treeNode:e.parent}),e.parent=null,e.sourceBoundary=null,delete i.treeNode)}}return s}function destroyBoundary(e,t=!0,o=!0){var n,s,i;let r=[[],[]];if(null===e.isMounted)return r;const l=e.bId?e:null;if(l){const e=l.component,t=e.constructor;e.signals.willUnmount&&callListeners(e.signals.willUnmount);const o=l._outerDef;if(o.attachedRefs)for(const e of o.attachedRefs)Ref.willDetachFrom(e,l.treeNode);if(null===(s=null===(n=l.sourceBoundary)||void 0===n?void 0:n.closure.chainedClosures)||void 0===s||s.delete(l.closure),e.contextAPI){const t=e.contextAPI,o=t.getContexts(null,!0,!0);for(const e in o)o[e].contextAPIs.delete(t);t.contexts={},l.host.contextComponents.delete(e)}if(t.api&&(t.api.components.delete(e),t.api.signals&&(t.api.signals={})),'Remote'===t.MIX_DOM_CLASS&&mergeChangesTo(r,t.removeSource(e)),o.tag._WithContent){const e=o.tag._WithContent,t=e.getRemote?e.getRemote().closure:null===(i=l.sourceBoundary)||void 0===i?void 0:i.closure;(null==t?void 0:t.withContents)&&(t.withContents.delete(l),t.withContents.size||delete t.withContents)}e.signals&&(e.signals={}),e.timers&&e.clearTimers()}return o&&(r[0]=r[0].concat(rootDOMTreeNodes(e.treeNode,!0).map((e=>({treeNode:e,remove:!0}))))),e._innerDef&&mergeChangesTo(r,cleanUpDefs(allDefsIn(e._innerDef,!0),t,!1)),l&&l.host.services.cancelUpdates(l),e.isMounted=null,r}function groundClosureContent(e,t,o,n,s){return e.groundedDefs.get(t)?'moved'===t.action&&n.boundary?[rootDOMTreeNodes(n.boundary.treeNode,!0,!0).map((e=>({treeNode:e,move:!0}))),[]]:[[],[]]:(e.groundedDefs.set(t,[o,n,s]),applyContentDefs(e,[t]))}function ungroundClosureContent(e,t){const o=e.groundedDefs.get(t);if(!o)return[[],[]];e.groundedDefs.delete(t),e.pendingDefs.delete(t),e.truePassDef===t&&(e.truePassDef=null);const n=o[1].boundary;return n?destroyBoundary(n):[[],[]]}function preRefreshClosure(e,t,o){if(e.remote)return e.envelope=t,preRefreshClosure(e.remote.closure,t,e.remote);if(!e.envelope&&!t)return null;const n=collectInterestedInClosure(e,o);if(n)for(const e of n)e._forceUpdate=e._forceUpdate||!0;return e.envelope=t,e.pendingDefs=new Set(e.groundedDefs.keys()),n}function applyClosureRefresh(e,t=!1){if(e.remote)return applyClosureRefresh(e.remote.closure,t);let o=[],n=[];return e.pendingDefs.size&&([o,n]=applyContentDefs(e,e.pendingDefs,t)),[o,n]}function applyContentDefs(e,t,o=!1){let n=[],s=[];for(const i of t){e.pendingDefs.delete(i);const t=e.groundedDefs.get(i);if(void 0===t)continue;let[r,l,a]=t,d=l.boundary;if(e.envelope&&e.sourceBoundary){let t=!0;const c=e.envelope;d?(t=e.truePassDef===i,d.updateEnvelope(c.target,t?c.applied:null)):(d=new ContentBoundary(i,c.target,l,e.sourceBoundary),t=null==a&&(!e.truePassDef||e.truePassDef===i),t&&(d._innerDef.childDefs=c.applied.childDefs,e.truePassDef=i),d.parentBoundary=r,l.boundary=d);const[u,p]=t?runPassUpdate(d,o):runBoundaryUpdate(d,o);n=n.concat(u),s=s.concat(p)}else if(d){const e=destroyBoundary(d,!1);n=n.concat(e[0]),s=s.concat(e[1]),l.boundary=null}}return[n,s]}class HostServices{constructor(e){this.host=e,this.bIdCount=0,this.renderer=new HostRender(e.settings,e.groundedTree),this.updateCycle=new RefreshCycle({initPending:()=>({updates:new Set})}),this.renderCycle=new RefreshCycle({initPending:()=>({rCalls:[],rInfos:[]}),autoRenewPromise:!0}),this.constructor.initializeCyclesFor(this)}createBoundaryId(){return'h-'+this.host.constructor.idCount.toString()+':b-'+(this.bIdCount++).toString()}clearTimers(e=!1){e||(this.updateCycle.resolve(),this.renderCycle.resolve()),this.updateCycle.reject(),this.renderCycle.reject()}createRoot(e){return this.rootDef=newDefFrom(e),{HostRoot:(e,t)=>()=>this._rootDisabled?null:this.rootDef}.HostRoot}updateRoot(e,t,o){this.rootDef=newDefFrom(e),this.host.rootBoundary.update(!0,t,o)}refreshRoot(e=!1,t,o){const n=!this._rootDisabled,s=this.host,i=!(s.settings.onlyRunInContainer&&!s.groundedTree.domNode&&!s.groundedTree.parent);if(i?delete this._rootDisabled:this._rootDisabled=!0,!e&&i&&n){if(i&&n){const e=s.rootBoundary?rootDOMTreeNodes(s.rootBoundary.treeNode,!0).map((e=>({treeNode:e,move:!0}))):[];this.absorbChanges(e,null,o)}}else s.rootBoundary.update(!0,t,o)}clearRoot(e=!1){this.clearTimers(e),this.rootDef=null}getRootDef(e){return this.rootDef&&(e?Object.assign({},this.rootDef):this.rootDef)}hasPending(e=!0,t=!0){return!!(e&&this.updateCycle.state||t&&this.renderCycle.state)}addRefreshCall(e,t=!1){t?this.renderCycle.promise.then(e):this.updateCycle.promise.then(e)}cancelUpdates(e){var t;null===(t=this.updateCycle.pending.updates)||void 0===t||t.delete(e)}absorbUpdates(e,t,o=!0,n,s){if(null!==e.isMounted){if(t.force&&(e._forceUpdate='all'===e._forceUpdate?'all':t.force),t.props&&(e._outerDef.props=t.props),t.state){const o=e.component;o.lastState||(o.lastState=Object.assign({},o.state)),o.state=t.state}e._renderState?e._renderState='re-updated':(this.updateCycle.pending.updates.add(e),o&&this.triggerRefresh(n,s))}}triggerRefresh(e,t){this.updateRefreshTimes(e,t),this.updateCycle.trigger(this.host.settings.updateTimeout)}updateRefreshTimes(e,t){void 0!==e&&this.updateCycle.extend(e),void 0!==t&&this.renderCycle.extend(t)}updateBoundary(e,t=!1,o,n){let s=!!t,i='all'===t,r=[],l=[];const a=e.component,d=!e.isMounted;if(d){if(null===e.isMounted)return null;l.push([e,'mounted']),s=!0}const c=e._outerDef.props!==a.props?a.props||{}:void 0;c&&(a.props=e._outerDef.props);const u=a.constructor.api;if(u&&(d||c)&&(d&&u.onBuildProps&&!u.builtProps&&(u.builtProps=u.onBuildProps(null)),u.getMixedProps&&(d||a.lastState||(a.lastState=Object.assign({},a.state)),a.state=u.getMixedProps(a))),!d&&a.signals.beforeUpdate&&callListeners(a.signals.beforeUpdate),e._forceUpdate&&('all'===e._forceUpdate&&(i=!0),s=!0,delete e._forceUpdate),!d){const t=a.lastState;if(t&&delete a.lastState,s||c||t){if(!s){const o=a.signals.shouldUpdate?askListeners(a.signals.shouldUpdate,[c,t],['first-true','no-false']):null;(!0===o||null==o&&HostServices.shouldUpdateBy(e,c,t))&&(s=!0)}const n='moved'===e._outerDef.action;if(n&&l.push([e,'moved']),s&&l.push([e,'updated',c,t]),n)for(const t of rootDOMTreeNodes(e.treeNode,!0,!0)){if(o){if(-1!==o.indexOf(t))continue;o.push(t)}r.push({treeNode:t,move:!0})}a.signals.preUpdate&&callListeners(a.signals.preUpdate,[c,t,s])}}if(s){const[t,o]=runBoundaryUpdate(e,i);r=r.concat(t),l=l.concat(o)}if(a.lastState&&delete a.lastState,a.wired)for(const e of a.wired){if(e.api.onBuildProps){const t=e.api.builtProps;if(e.api.builtProps=e.api.onBuildProps(t),t===e.api.builtProps&&!e.api.onMixProps)continue}if(e.api.components.size){n||(n=new Set);for(const t of e.api.components)t.boundary._outerDef.props=Object.assign({},t.boundary._outerDef.props),n.add(t.boundary)}}if(n&&n.size){for(const t of n)t.sourceBoundary===e.sourceBoundary&&t._updateId!==e.host.services._whileUpdating&&(t._forceUpdate=!0,n.delete(t));const t=updatedInterestedInClosure(n,!0);r=r.concat(t[0]),l=l.concat(t[1])}return r[0]||l[0]?[r,l]:null}absorbChanges(e,t,o){var n;e&&this.renderCycle.pending.rInfos.push(e),t&&(this.host.settings.useImmediateCalls?HostServices.callBoundariesBy(t):this.renderCycle.pending.rCalls.push(t)),this.renderCycle.trigger(null!==(n=this.host.settings.renderTimeout)&&void 0!==n?n:void 0,null!=o?o:void 0)}static initializeCyclesFor(e){e.updateCycle.listenTo('onRefresh',((t,o)=>e.constructor.runUpdates(e,t,o))),e.renderCycle.listenTo('onRefresh',((t,o)=>e.constructor.runRenders(e,t,o))),e.updateCycle.listenTo('onFinish',(()=>{e.renderCycle.trigger(e.host.settings.renderTimeout)})),e.renderCycle.listenTo('onResolve',(()=>e.updateCycle.resolve()))}static runUpdates(e,t,o){if(!e._whileUpdating){for(;t.updates.size;){e._whileUpdating={};let o=[],n=[];for(const s of t.updates.size>1?sortBoundaries(t.updates):[...t.updates]){s._updateId=e._whileUpdating;const t=e.updateBoundary(s);t&&(o=o.concat(t[0]),n=n.concat(t[1]))}o[0]&&e.renderCycle.pending.rInfos.push(o),n[0]&&(e.host.settings.useImmediateCalls?HostServices.callBoundariesBy(n):e.renderCycle.pending.rCalls.push(n)),t=e.updateCycle.resetPending()}delete e._whileUpdating}}static runRenders(e,t,o){if(t.rInfos)for(const o of t.rInfos)o[0]&&e.renderer.applyToDOM(o);if(t.rCalls)for(const e of t.rCalls)e[0]&&HostServices.callBoundariesBy(e)}static shouldUpdateBy(e,t,o){var n,s,i;const r=e.component,a=e.host.settings.updateComponentModes,d=null===(n=r.constructor.api)||void 0===n?void 0:n.updateModes,c=t&&o?['props','state']:t?['props']:o?['state']:[];for(const e of c){const n=null!==(i=null!==(s=r.updateModes&&r.updateModes[e])&&void 0!==s?s:d&&d[e])&&void 0!==i?i:a[e],c='number'==typeof n?n:l[n]||0;if(c<-1){if(-2===c)return!0}else{if(0===c)return!0;if(!areEqual('state'===e?o:t,r[e],c))return!0}}return!1}static callBoundariesBy(e){for(const t of e){const[e,o,n,s]=t,i=e.component,r='mounted'===o?'didMount':'moved'===o?'didMove':'didUpdate';i.signals[r]&&callListeners(i.signals[r],'updated'===o?[n,s]:void 0)}}}class Host{constructor(e,t,o,n,s){this.constructor.idCount++,this.shadowAPI=s||new HostShadowAPI,this.contextComponents=new Set,this.contextAPI=new HostContextAPI,this.contextAPI.host=this,n&&this.contextAPI.setContexts(n,!1,!0),this.groundedTree={type:'root',parent:null,children:[],domNode:t||null,sourceBoundary:null},this.settings=Host.getDefaultSettings(),o&&Host.modifySettings(this.settings,o),this.services=new HostServices(this);const i=newAppliedDef({MIX_DOM_DEF:'boundary',tag:this.services.createRoot(e),props:{},childDefs:[]},null),r={type:'boundary',def:i,sourceBoundary:null,boundary:null,parent:this.groundedTree,children:[],domNode:null};this.groundedTree.children.push(r),this.rootBoundary=new SourceBoundary(this,i,r),r.boundary=this.rootBoundary,this.rootBoundary.reattach(),this.services.absorbUpdates(this.rootBoundary,{})}clearRoot(e=!0,t,o){this.services.clearRoot(!0),e&&this.rootBoundary.update(!0,t,o)}moveRoot(e,t){if(this.groundedTree.domNode===e)return;this.groundedTree.domNode=e;const o=rootDOMTreeNodes(this.rootBoundary.treeNode,!0).map((e=>({treeNode:e,move:!0})));(o[0]||void 0!==t)&&this.services.absorbChanges(o,null,t)}updateRoot(e,t,o){this.services.updateRoot(e,t,o)}refreshRoot(e=!1,t,o){this.services.refreshRoot(e,t,o)}refreshDOM(e=!1,t){const o=!e||'read',n=[];let s,i=[...this.groundedTree.children],r=0;for(;s=i[r];)r+=1,s.domProps&&n.push({treeNode:s,refresh:o}),s.children[0]&&(i=s.children.concat(i.slice(r)),r=0);this.services.absorbChanges(n,null,t)}afterRefresh(e=!1,t,o){return new Promise((n=>this.afterRefreshCall(n,e,t,o)))}updateRefreshTimes(e,t){this.services.updateRefreshTimes(e,t)}afterRefreshCall(e,t=!1,o,n){this.services.hasPending(!0,t)?(this.addRefreshCall(e,t),this.services.triggerRefresh(o,n)):e()}addRefreshCall(e,t=!1){this.services.addRefreshCall(e,t)}triggerRefresh(e,t){this.services.triggerRefresh(e,t)}pause(){this.services.renderer.pause()}resume(){this.services.renderer.resume()}isPaused(){return this.services.renderer.paused}reassimilate(e=null,t=!1,o=!1,n=!1,s,i){this.services.renderer.reassimilate(e||this.groundedTree.domNode,t,o,n,s,i)}reassimilateWith(e,t=null,o=!1,n=!1,s=!1,i,r){this.pause(),this.updateRoot(e,null,null),this.services.renderer.reassimilate(t||this.groundedTree.domNode,o,n,s,i,r)}remount(e=null,t=!1,o=!0,n,s){return this.remountWith(this.services.getRootDef(!0),e,t,o,n,s)}remountWith(e,t=null,o=!1,n=!0,s,i){null==e&&(e=this.services.getRootDef(!0));const r=t&&HostRender.createVirtualItemsFor(t);this.clearRoot(!0,null,null);const l=this.settings.debugMode||void 0,a=this.services.renderer,d=a.sourceRemount=r?Object.assign(Object.assign({},r),{reused:l&&new Set,created:l&&new Set,unused:l&&new Set,readFromDOM:o,removeUnused:n,validator:s,suggester:i}):void 0;if(this.services.updateRoot(e,null,null),delete a.sourceRemount,l&&d)return{created:d.created,reused:d.reused,unused:d.unused}}readDOMString(){return HostRender.readDOMString(this.rootBoundary.treeNode)}getRootDef(){return this.services.getRootDef(!0)}getContainerElement(){return this.groundedTree.domNode}getRootElement(){return this.rootBoundary&&this.rootBoundary.treeNode.domNode}getRootElements(e){return this.rootBoundary?rootDOMTreeNodes(this.rootBoundary.treeNode,e,!1).map((e=>e.domNode)):[]}queryElement(e,t=!1){return domElementByQuery(this.groundedTree,e,!0,t)}queryElements(e,t=0,o=!1){return domElementsByQuery(this.groundedTree,e,t,!0,o)}findElements(e=0,t=!1,o){return treeNodesWithin(this.groundedTree,new Set(['dom']),e,!0,t,o).map((e=>e.domNode))}findComponents(e=0,t=!1,o){return treeNodesWithin(this.groundedTree,new Set(['boundary']),e,!0,t,o).map((e=>e.boundary&&e.boundary.component))}findTreeNodes(e,t=0,o=!1,n){const s=e?Array.isArray(e)?new Set(e):'[object Set]'===e.toString()?e:new Set(Object.keys(e)):void 0;return treeNodesWithin(this.groundedTree,s,t,!0,o,n)}modifySettings(e,t=!0){const o=this.settings.onlyRunInContainer;if(Host.modifySettings(this.settings,e),void 0!==e.onlyRunInContainer&&e.onlyRunInContainer!==o&&this.refreshRoot(!1,null,null),t)for(const t of this.shadowAPI.hosts)t!==this&&t.modifySettings(e,!1)}static modifySettings(e,t,o=!1){var n;let s=null;if(t.updateComponentModes){const e=t.updateComponentModes,o={};for(const t in e)o[t]=null!==(n=e[t])&&void 0!==n?n:(s||(s=Host.getDefaultSettings())).updateComponentModes[t];t=Object.assign(Object.assign({},t),{updateComponentModes:o})}for(const n in t)void 0!==t[n]?e[n]=t[n]:o&&(e[n]=(s||(s=Host.getDefaultSettings()))[n])}static getDefaultSettings(){return{updateTimeout:0,renderTimeout:null,useImmediateCalls:!1,updateComponentModes:{props:'shallow',state:'shallow'},preCompareDOMProps:'if-needed',wideKeysInArrays:!1,noRenderValuesMode:!1,onlyRunInContainer:!1,disableRendering:!1,duplicateDOMNodeBehaviour:'deep',duplicateDOMNodeHandler:null,duplicatableHost:!1,maxReRenders:1,renderTextTag:'',renderHTMLDefTag:'span',renderTextHandler:null,renderSVGNamespaceURI:'http://www.w3.org/2000/svg',renderDOMPropsOnSwap:!0,debugMode:!1}}}Host.MIX_DOM_CLASS='Host',Host.idCount=0;class PseudoFragment{constructor(e){}}PseudoFragment.MIX_DOM_CLASS='Fragment';class PseudoPortal{constructor(e){}}PseudoPortal.MIX_DOM_CLASS='Portal';class PseudoElement{constructor(e){}}PseudoElement.MIX_DOM_CLASS='Element';class PseudoEmpty{constructor(e){}render(){return null}}PseudoEmpty.MIX_DOM_CLASS='Empty';class PseudoEmptyRemote extends PseudoEmpty{constructor(e,t){super(e,t)}static isRemote(){return!1}}PseudoEmptyRemote.MIX_DOM_CLASS='EmptyRemote',PseudoEmptyRemote.Content=null,PseudoEmptyRemote.ContentCopy=null,PseudoEmptyRemote.copyContent=e=>null,PseudoEmptyRemote.filterContent=(e,t)=>null,PseudoEmptyRemote.wrapContent=(e,t)=>null,PseudoEmptyRemote.renderContents=e=>null,PseudoEmptyRemote.hasContent=e=>!1,PseudoEmptyRemote.WithContent=(e,t)=>null,PseudoEmptyRemote.sources=[];class ComponentShadowAPI extends SignalBoy{constructor(){super(...arguments),this.components=new Set}update(e=!0,t,o){for(const n of this.components)n.triggerUpdate(e,t,o)}static onListener(e,t,o,n){if(e.components.size&&e.signals[t]){const s=e.signals[t][o],i=s[0];if(n)for(const o of e.components)o.listenTo(t,((...e)=>s[1]?i(o,...e,...s[1]):i(o,...e)),null,s[2],i);else for(const o of e.components)o.unlistenTo(t,i)}}}function prepareShadow(e,t,o){if(o)for(const t in o)e[t]=o[t];if(e.api=new ComponentShadowAPI,t)for(const o in t)e.api.listenTo(o,t[o])}class ComponentWiredAPI extends ComponentShadowAPI{constructor(){super(),this.updateModes={props:'never'},this.builtProps=null}buildProps(){return this.onBuildProps?this.onBuildProps(this.builtProps):this.builtProps}getMixedProps(e){return this.onMixProps?this.onMixProps(e.props,this.builtProps,e):Object.assign(Object.assign({},e.props),e.state)}setProps(e,t,o,n){(this.builtProps!==e||t||void 0!==o||void 0!==n)&&(this.builtProps=e,this.update('trigger'!==t&&t,o,n))}refresh(e,t,o){this.setProps(this.buildProps(),e,t,o)}update(e=!0,t,o){for(const n of this.components)n.setState(this.getMixedProps(n),!1,e,t,o)}}var p;const checkRecursively=e=>{var t;return!(!(null===(t=e.contentPass)||void 0===t?void 0:t.envelope)||!hasContentInDefs(e.contentPass.envelope.applied.childDefs,checkRecursively))},f=((p=class WithContent extends Component{hasContent(){var e;const t=null===(e=this.boundary.sourceBoundary)||void 0===e?void 0:e.closure;return t&&t.envelope&&hasContentInDefs(t.envelope.applied.childDefs,checkRecursively)||!1}render(){var e;return(null!==(e=this.props.hasContent)&&void 0!==e?e:this.hasContent())?d:null}})._WithContent=d,p);function mergeShadowWiredAPIs(e){const t=e.some((e=>e instanceof ComponentWiredAPI))?new ComponentWiredAPI:new ComponentShadowAPI;for(const o of e){if(o.updateModes){t.updateModes||(t.updateModes={});for(const e in o.updateModes)t.updateModes[e]=Object.assign(Object.assign({},t.updateModes[e]),o.updateModes[e])}for(const e in o.signals)t.signals[e]=[...t.signals[e]||[],...o.signals[e]];o instanceof ComponentWiredAPI&&(o.builtProps&&(t.builtProps=o.builtProps),o.onBuildProps&&(t.onBuildProps=o.onBuildProps),o.onMixProps&&(t.onMixProps=o.onMixProps))}return t}function mixFuncs(...e){const t=e.length,o=!0===e[t-1],n=o||!e[t-1]?e.slice(0,t-1):e,CompFunc=(e,t,s)=>{let i=null;for(const o of n){if(!o)continue;const n=t.state,r=o(e,t,s);'function'!=typeof r&&'function'==typeof i||(i=r),n!==t.state&&t.state&&(t.state=Object.assign(Object.assign({},n||{}),t.state))}return o?()=>i:i},s=n.some((e=>e.length>2))?(e,t,o)=>CompFunc(e,t,o):(e,t)=>CompFunc(e,t),i=[];for(const e of n)for(const t in e)'api'===t?i.push(e.api):s[t]=e[t];return i[0]&&(s.api=mergeShadowWiredAPIs(i)),s}function mixFuncsWith(...e){const t=e.length;return'function'!=typeof e[t-1]?mixFuncs(...e.slice(0,t-1),!0):mixFuncs(...e,!0)}function mixMixins(...e){const t=e[0].MIX_DOM_CLASS?e[0]:null;let o=t||Component;for(const n of t?e.slice(1):e)o=n(o);return o}function mixClassFuncs(e,...t){const o='function'!=typeof t[t.length-1]&&!!t.pop(),n=t.length>1?mixFuncs(...t):t[0],s={[e.name]:class extends e{render(e){const t=n(e,this,this.contextAPI);return o?super.render:'function'==typeof t?t:()=>t}}}[e.name];for(const e in n)'api'===e?s.api=s.api?mergeShadowWiredAPIs([s.api,n.api]):n.api:s[e]=n[e];return s}const h={def:newDef,defHTML:function newDefHTML(e,t,o,n){const s={MIX_DOM_DEF:'content',tag:t||'',childDefs:[],domContent:e,domHTMLMode:!0};return t&&o&&(s.props=cleanDOMProps(o)),null!=n&&(s.key=n),s},Content:d,WithContent:f,ContentCopy:c,copyContent:function newContentCopyDef(e){return newContentPassDef(e,!0)},Component,Host,Ref,Fragment:PseudoFragment,Portal:PseudoPortal,Element:PseudoElement,Empty:PseudoEmpty,EmptyRemote:PseudoEmptyRemote,component:createComponent,componentCtx:createComponentCtx,shadow:function createShadow(e,t,...o){const n=o[0]&&'object'==typeof o[0]?o[0]:void 0,s=(n?o[1]:o[0])||e.name||'[createShadow]',i=e.MIX_DOM_CLASS?{[s]:class extends e{}}[s]:createComponent(e,s);return prepareShadow(i,t,n),i},shadowCtx:(e,t,...o)=>{const n=o[0]&&'object'==typeof o[0]?o[0]:void 0,s=createComponentCtx(e,(n?o[1]:o[0])||e.name||'[createShadowCtx]');return prepareShadow(s,t,n),s},spread:e=>e.length>1?function(t,...o){return e(t,...o)}:e,spreadWith:e=>e.length>1?function(t,...o){return e(t,...o)}:e,remote:(e='Remote')=>{const t='WithContent',o={[e]:class extends Component{constructor(){super(...arguments),this.closure=new ContentClosure(null,this.boundary),this.Content=Object.assign(Object.assign({},newContentPassDef(this)),{contentPass:null,getRemote:()=>this}),this.ContentCopy=Object.assign(Object.assign({},newContentPassDef(this,!0)),{contentPass:null,getRemote:()=>this}),this.copyContent=e=>Object.assign(Object.assign({},newContentPassDef(null!=e?e:o,!0)),{contentPass:null,getRemote:()=>this}),this.hasContent=()=>this.closure.hasContent(),this.WithContent=(()=>{const o=this,n={[e+'[i].'+t]:class extends Component{render(){return(null!=this.props.hasContent?this.props.hasContent:o.hasContent())?d:null}}}[e+'[i].'+t];return n._WithContent=o.Content,n})()}render(){return null}static isRemote(){return!0}static addSource(e,t=e.props.order){const s=o.sources.indexOf(e),i=function orderedIndex(e,t,o){return null!=o?null==e?t.findIndex((e=>e[o]<0)):e<0?t.findIndex((t=>null!=t[o]&&t[o]<0&&t[o]>e)):t.findIndex((t=>null==t[o]||t[o]<0||t[o]>e)):null==e?t.findIndex((e=>e<0)):e<0?t.findIndex((t=>null!=t&&t<0&&t>e)):t.findIndex((t=>null==t||t<0||t>e))}(t,o.sources.map((e=>e.props.order)));if(-1===s);else{if(-1===i?s===o.sources.length-1:s===i)return;o.sources.splice(s,1)}-1===i?o.sources.push(e):o.sources.splice(i,0,e);for(const t of n.passers)t.boundary.host===e.boundary.host?t.boundary.update(!0):t.boundary.host.addRefreshCall((()=>t.boundary.update(!0,null,null)),!0)}static removeSource(e){const t=o.sources.indexOf(e);if(-1===t)return null;o.sources.splice(t,1);let s=null;const i=collectInterestedInClosure(e.closure,e);s=function applyClosureEnvelope(e,t){const o=preRefreshClosure(e,t),n=o&&updatedInterestedInClosure(o),s=applyClosureRefresh(e);return n?[n[0].concat(s[0]),n[1].concat(s[1])]:s}(e.closure,null),e.closure.sourceBoundary=null;for(const t of n.passers)t.boundary.host===e.boundary.host?t.boundary.update(!0):t.boundary.host.addRefreshCall((()=>t.boundary.update(!0,null,null)),!0);return i&&e.boundary.host.addRefreshCall((()=>{for(const e of i)e.update(!0,null,null)}),!0),s}}}[e],n={[e+'.Passer']:class extends Component{constructor(e,t){super(e,t),this.constructor.passers.add(this),this.listenTo('willUnmount',(()=>this.constructor.passers.delete(this)))}render(e){return e.renderer?e.renderer(o.sources.slice()):{tag:null,MIX_DOM_DEF:'fragment',childDefs:e.wrapper?o.sources.map(((t,o)=>e.wrapper?newDefFrom(e.wrapper(t,o)):null!=e.copyKey?t.copyContent(e.copyKey):e.copy?t.ContentCopy:t.Content)).filter((e=>e)):(e.filterer?o.sources.filter(e.filterer):o.sources).map((t=>null!=e.copyKey?t.copyContent(e.copyKey):e.copy?t.ContentCopy:t.Content))}}}}[e+'.Passer'];n.passers=new Set;const s=newDef(n),i={[e+'.'+t]:class extends Component{constructor(e,t){super(e,t),this.constructor.withContents.add(this.boundary),this.listenTo('willUnmount',(()=>this.constructor.withContents.delete(this.boundary)))}render(){return(null!=this.props.hasContent?this.props.hasContent:o.hasContent())?d:null}}}[e+'.'+t];return i._WithContent=s,i.withContents=new Set,o.MIX_DOM_CLASS='Remote',o.sources=[],o.ContentPasser=n,o.Content=s,o.ContentCopy=newDef(n,{copy:!0}),o.copyContent=e=>newDef(n,{copy:!0,copyKey:e}),o.hasContent=e=>e?o.sources.some(((t,o)=>e(t,o)&&t.closure.hasContent())):o.sources.some((e=>e.closure.hasContent())),o.filterContent=(e,t)=>newDef(n,{copyKey:t,filterer:e}),o.wrapContent=(e,t)=>newDef(n,{copyKey:t,wrapper:e}),o.renderContents=e=>newDef(n,{renderer:e}),o.WithContent=i,o},wired:function createWired(...e){const t=e.length,o='string'==typeof e[t-1]?-1:0,n=e[t-3+o],s=e[t-2+o]||null,i=e[t-1+o],r=o?e[t-1]:i.name||'[createWired]',l={[r]:function(e,t){return newDef(i,Object.assign({},t.state),d)}}[r];return l.api=new ComponentWiredAPI,n&&('object'==typeof n?l.api.builtProps=n:t>2&&'function'==typeof n&&(l.api.onBuildProps=n)),s&&(l.api.onMixProps=s),l},mixin:function createMixin(e){return e},mixinComponent,mixFuncs,mixFuncsWith,mixClassFuncs,mixClassFuncsWith:function mixClassFuncsWith(...e){const t=e.length;return mixClassFuncs(...'function'!=typeof e[t-1]?e.slice(0,t-1):e)},mixClassMixins:function mixClassMixins(...e){return mixMixins(...e)},mixMixins,mixMixinsWith:function mixMixinsWith(...e){const t=e.length;return'function'!=typeof e[t-1]?mixMixins(...e.slice(0,t-1)):mixMixins(e)},mixHOCs:function mixHOCs(e,...t){let o=e;for(const e of t)o=e(o);return e=>newDef(o,e,d)},findTreeNodesIn:(e,t,o,n,s,i)=>treeNodesWithin(e,t?Array.isArray(t)?new Set(t):'[object Set]'===t.toString()?t:new Set(Object.keys(t)):void 0,o,n,s,i),findComponentsIn:(e,t,o,n,s)=>treeNodesWithin(e,new Set(['boundary']),t,o,n,s).map((e=>e.boundary&&e.boundary.component)),findElementsIn:(e,t,o,n,s)=>treeNodesWithin(e,new Set(['dom']),t,o,n,s).map((e=>e.domNode)),queryElementIn:(e,t,o,n)=>domElementByQuery(e,t,o,n),queryElementsIn:(e,t,o,n,s)=>domElementsByQuery(e,t,o,n,s),readDOMString:(e,t=!1,o=-1,s=n)=>{const i=e&&(e.constructor.MIX_DOM_CLASS?e.boundary.treeNode:e.treeNode||'string'==typeof e.type&&e);return i?HostRender.readDOMString(i,t,o,s):''}};function consoleLog(e,...t){console.log(...t),e&&e.console&&e.console.log(...t)}const wrapTip=(...e)=>h.def('div',{class:classNames('style-ui-panel flex-col layout-gap-l'),style:'min-width: 100px;'},...e);const m='0.2.24';var g;!function(e){e[e.Left=1]='Left',e[e.Top=2]='Top',e[e.Right=4]='Right',e[e.Bottom=8]='Bottom',e[e.Horizontal=5]='Horizontal',e[e.Vertical=10]='Vertical',e[e.None=0]='None',e[e.All=15]='All'}(g||(g={}));const cleanMargin=e=>{const t={top:0,left:0,right:0,bottom:0};if('number'==typeof e)t.top=t.left=t.bottom=t.right=e;else if(e&&e.constructor===Array)t.left=t.right=e[0]||0,t.top=t.bottom=e[1]||0;else if(e){const o=e;t.left=o.left||0,t.right=o.right||0,t.top=o.top||0,t.bottom=o.bottom||0}return t};class FitBoxAlgoritms{static fitToSize(e,t,o=g.None,n='push',s='push'){const i=Object.assign({},e);if((o&g.Horizontal)!==g.Horizontal){let e=i.left,s=i.width;'anchored'===n?[e,s]=FitBoxAlgoritms.axisFitAnchored(i.left,i.width,t.left,t.width,!(o&g.Left),!(o&g.Right)):'push'===n&&([e,s]=FitBoxAlgoritms.axisFitPush(i.left,i.width,t.left,t.width)),i.left=e,i.width=s}if((o&g.Vertical)!==g.Vertical){let e=i.top,n=i.height;'anchored'===s?[e,n]=FitBoxAlgoritms.axisFitAnchored(i.top,i.height,t.top,t.height,!(o&g.Top),!(o&g.Bottom)):'push'===s&&([e,n]=FitBoxAlgoritms.axisFitPush(i.top,i.height,t.top,t.height)),i.top=e,i.height=n}return i}static axisFitPush(e,t,o,n){t>n&&(t=n);const s=e+t,i=o+n;return s>i&&(e-=s-i),e<o&&(e=o),[e,t]}static axisFitAnchored(e,t,o,n,s=!0,i=!0){const r=o+n;let l=e,a=e+t,d=0;if(i&&a>r){d=r-a,a=r}if(s&&l+d<o){d=o-(l+d),l=o}return d>0&&i&&a+d>r&&(a=r,d=0),[l,a-l]}}const y=h.component((e=>{let t=null;const o=new Ref;e.state={left:0,top:0,width:0,height:0},e.listenTo('didMount',(()=>{t=new ResizeObserver(onResize);const e=o.getElement();if(e){const o=e.parentElement;t.observe(e),o&&t.observe(o)}})),e.listenTo('willUnmount',(()=>{t&&t.disconnect(),t=null}));const onResize=()=>{const t=o.getElement(),n={top:e.props.offset&&e.props.offset.top||0,left:e.props.offset&&e.props.offset.left||0,width:t?t.offsetWidth:0,height:t?t.offsetHeight:0},s=e.props.align&&e.props.align.horizontal||'left',i=e.props.align&&e.props.align.vertical||'top';'right'===s?n.left-=n.width:'center'===s&&(n.left-=.5*n.width),'bottom'===i?n.top-=n.height:'center'===i&&(n.top-=.5*n.height),resizeBy(n)},resizeBy=t=>{let n={left:0,top:0,width:0,height:0};if(e.props.getContainerRect)n=e.props.getContainerRect();else{const e=o.getElement();if(e){const t=e.parentElement;t&&(n.width=t.offsetWidth,n.height=t.offsetHeight)}}const s=cleanMargin(e.props.margin);n.left=s.left,n.width-=s.left+s.right,n.top=s.top,n.height-=s.top+s.bottom;let i=0;const r=e.props.align?e.props.align.horizontal:'left',l=e.props.align?e.props.align.vertical:'top';e.props.lockHorizontal&&(i|='left'===r?g.Left:'right'===r?g.Right:g.Horizontal),e.props.lockVertical&&(i|='top'===l?g.Top:'bottom'===l?g.Bottom:g.Vertical);const a=e.props.lockHorizontal?'anchored':'push',d=e.props.lockVertical?'anchored':'push',c=FitBoxAlgoritms.fitToSize(t,n,i,a,d);e.props.lockHorizontal?c.width='left'===r?n.left+n.width-t.left:'right'===r?t.left+t.width-n.left:c.width:c.width=n.width,e.props.lockVertical?c.height='top'===l?n.top+n.height-t.top:'bottom'===l?t.top+t.height-n.top:c.height:c.height=n.height,!e.props.onMaxSize||c.width===e.state.width&&c.height===e.state.height||e.props.onMaxSize(c.width,c.height),e.isMounted()?e.setState(c,!0,!1,null,null):e.setState(c)};return onResize(),(e,t)=>{const n=Object.assign(Object.assign({},e.style?'string'==typeof e.style?parseDOMStyle(e.style):e.style:void 0),{position:'absolute',left:t.left+'px',top:t.top+'px',maxWidth:t.width+'px',maxHeight:t.height+'px'});return h.def('div',{className:classNames('m-size-fitter',e.className),_ref:o,style:n},h.Content)}})),v=h.component((e=>{e.state={refreshId:{}};const t={top:0,left:0},o={horizontal:e.props.hAlign||'center',vertical:e.props.vAlign||'center'},n=createMemo(((e,t)=>()=>e&&e()||{top:0,left:0,width:window.innerWidth,height:window.innerHeight})),s=createTrigger((({getContainerRect:e,getElement:s,elementMargin:i,hAlign:r,vAlign:l,refreshId:a})=>{const d=n(e,a)(),c=s&&('function'==typeof s?s():s)||null;if(c&&document.body.contains(c)){const e=c.getBoundingClientRect(),n=cleanMargin(null==i?0:i);o.horizontal=r||'center',o.vertical=l||(e.top+.5*e.height>.5*d.height?'bottom':'top'),t.left=e.left+('right'===o.horizontal?-n.right+e.width:'center'===o.horizontal?.5*e.width:n.left),t.top=e.top+('top'===o.vertical?n.bottom+e.height:'center'===o.vertical?.5*e.height:-n.top)}else t.left=d.left+.5*d.width,t.top=d.top+.5*d.height,o.horizontal='center',o.vertical='center'})),i=new ResizeObserver((()=>{e.setState({refreshId:{}})}));e.listenTo('willUnmount',(()=>i.disconnect));const domDidMount=e=>{i.observe(e)};return(e,i)=>(s({getContainerRect:e.getContainerRect,getElement:e.getElement,elementMargin:e.elementMargin,hAlign:e.hAlign,vAlign:e.vAlign,refreshId:i.refreshId}),h.def('div',{class:classNames('ui-popup-contents layout-fit-size',e.className),style:e.style,_signals:{domDidMount}},h.def(y,{offset:t,getContainerRect:n(e.getContainerRect),align:o,margin:e.margin},h.def('div',{class:classNames('popup-content',e.contentClassName),style:e.contentStyle},h.Content))))})),UIPopupContainer=e=>{const t=h.def(v,{getElement:e.sourceElement,contentClassName:e.contentClassName,contentStyle:e.contentStyle,hAlign:e.horizontalAlign,vAlign:e.verticalAlign,margin:e.containerMargin,elementMargin:e.elementMargin,style:e.style},h.Content);return!e.container||e.container instanceof Node?h.def(h.Portal,{container:e.container||document.body},t):h.def(e.container,null,t)},UIVirtualRow=e=>h.def('div',{className:'ui-virtual-row',style:{position:'absolute',top:e.rowHeight*e.iRow+'px',height:e.rowHeight,width:'100%'}},h.Content),b=h.component((t=>{t.state={height:0,iStart:-1,iEnd:-1};const o=new Ref;let n;t.scrollToIndex=(s,i,r,l)=>{const a=o.getElement();if(!a)return;l&&(n=o=>{const finishOff=()=>l(t.getElementAt(s));o?t.listenTo('didUpdate',finishOff,null,e.OneShot):finishOff()});const d=a.scrollTop,c=s*t.props.rowHeight;(!r||c<d||c+t.props.rowHeight>d+a.clientHeight)&&a.scrollTo({top:c,behavior:i||'auto'}),d===a.scrollTop&&n&&(n(!1),n=void 0)},t.getElementAt=e=>{var n;return(null===(n=o.getElement())||void 0===n?void 0:n.querySelectorAll('.list-content .ui-virtual-row')[e-t.getLastState().iStart])||null};const s=createTrigger((()=>{let e=null;const mountResizer=o=>{e=new ResizeObserver(onRefresh),e.observe(o),t.setState({height:o.offsetHeight}),onRefresh()};o.listenTo('domDidMount',mountResizer);const unmountResizer=()=>{o.unlistenTo('domDidMount',mountResizer),o.unlistenTo('domWillUnmount',unmountResizer),e&&e.disconnect(),e=null};return o.listenTo('domWillUnmount',unmountResizer),unmountResizer})),onRefresh=()=>{const e=o.getElement(),s=(null==e?void 0:e.scrollTop)||0,i=void 0!==t.props.rowTolerance?t.props.rowTolerance:2,r=(null==e?void 0:e.offsetHeight)||0,l=t.props.nRows-1,a={iStart:Math.min(Math.max(0,Math.floor(s/t.props.rowHeight-i)),l),iEnd:Math.min(Math.floor((s+r)/t.props.rowHeight+i),l),height:(null==e?void 0:e.offsetHeight)||0},d=!areEqual(a,t.state,1);n&&(n(d),n=void 0),d&&t.setState(a)},i=createTrigger(onRefresh,[t.props.rowHeight,t.props.nRows,t.props.rowTolerance,t.props.refreshId]),r=onRefresh;return(e,t)=>{s(!1!==e.handleResizing),i([e.rowHeight,e.nRows,e.rowTolerance,e.refreshId]);const n=e.nRows,l=function numberRange(e,t,o,n){const s=o<0;let[i,r]=null==t?[0,e]:[e,t];const l=i<r;o=o?l!==s?o:-o:l?1:-1;const a=[];if(n)for(;l?i<=r:i>=r;)a.push(i),i+=o;else for(;l?i<r:i>r;)a.push(i),i+=o;return s&&a.reverse(),a}(t.iStart,t.iEnd+1).map((t=>{let o=e.renderRow(t,n,e.rowHeight);return o&&!1!==e.autoWrap?h.def(UIVirtualRow,{iRow:t,nRows:n,rowHeight:e.rowHeight,_key:e.getRowKey?e.getRowKey(t,n):t},o):o}));return h.def('div',{_ref:o,className:classNames('ui-virtual-list layout-scrollable style-scrollable',e.className),style:Object.assign({display:'flex',flexDirection:'column'},e.style||{}),onScroll:r},h.def('div',{className:classNames('list-content',e.contentClassName),style:Object.assign({position:'relative',paddingBottom:n*e.rowHeight+'px'},e.contentStyle||{})},l))}}));function UIList(e,t){const o=createMemo(((...e)=>({}))),n=createMemo(((e,t,...o)=>{let n=0;return t?e.filter(((e,o)=>!!t(e,o,n)&&++n)):e.slice()}));let s=n(t.props.items,t.props.filter,t.props.refreshId);const renderRow=(e,o,n)=>{const i=t.props,r=s[e];return r?h.def(i.Item,Object.assign({_key:i.keyProp?r[i.keyProp]:r,item:r},i.commonProps)):null},getRowKey=e=>t.props.keyProp&&t.props.items[e]?t.props.items[e][t.props.keyProp]:e;return(e,t)=>{var i;return s=n(e.items,e.filter,e.refreshId),h.def('div',{class:classNames('ui-tree-list flex-col layout-fit-size',e.className),role:'tree'},h.def(b,{_ref:e.refVirtualList,nRows:s.length,getRowKey,rowHeight:null!==(i=e.rowHeight)&&void 0!==i?i:30,renderRow,refreshId:o(s,e.commonProps,e.refreshId),className:e.listClassName}))}}var __rest$5=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&'function'==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(o[n[s]]=e[n[s]])}return o};const MixPositionedPopup=(e,t)=>(t.state=Object.assign(Object.assign({},t.state),{popupOpened:!1,popupSourceElement:null}),t.showPopup=(e,o)=>{void 0!==e&&t.setInState('popupSourceElement',e);const n=t.state.popupFadeIn;o||!n?t.setInState('popupOpened',!0):!0!==t.state.popupOpened&&(t.setTimer('popupFade',(()=>{'start'===t.state.popupOpened&&(t.setTimer('popupFade',(()=>'in'===t.state.popupOpened&&t.setInState('popupOpened',!0)),n),t.setInState('popupOpened','in'))}),25),t.setInState('popupOpened','start'))},t.hidePopup=e=>{t.state.popupOpened&&(e||!t.state.popupFadeOut?t.setState({popupOpened:!1,popupSourceElement:null}):(t.setInState('popupOpened','out'),t.setTimer('popupFade',(()=>'out'===t.state.popupOpened&&t.setState({popupOpened:!1,popupSourceElement:null})),t.state.popupFadeOut)))},t.WithTooltip=h.wired((()=>({popupOpened:t.state.popupOpened,horizontalAlign:t.state.horizontalAlign,verticalAlign:t.state.verticalAlign,containerMargin:t.state.containerMargin,elementMargin:t.state.elementMargin,popupFadeIn:t.state.popupFadeIn,popupFadeOut:t.state.popupFadeOut,popupSourceEl:t.state.popupSourceElement,refreshId:t.refreshPopupId})),(e=>{if(!e.popupOpened)return null;const o=t.renderPopup?t.renderPopup():null;if(null==o)return null;const{popupOpened:n,refreshId:s}=e,i=__rest$5(e,['popupOpened','refreshId']),r='start'===n||'in'===n?e.popupFadeIn:e.popupFadeOut;return h.def(UIPopupContainer,Object.assign({container:t.popupContainer,sourceElement:e.popupSourceEl,contentClassName:classNames('style-shadow-overlay','out'===n||'start'===n?'style-opacity-0':'style-opacity-1'),contentStyle:r?`transition: opacity ${r}ms ease-in-out`:void 0},i),o)}),'WithTooltip'),t.addWired(t.WithTooltip),null);var __rest$4=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&'function'==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(o[n[s]]=e[n[s]])}return o};const C=h.remote(),D=h.mixFuncsWith(((e,t)=>{t.hoverTimeout=500;let o=!1;return t.hoverRef=new Ref,t.hoverRef.listenTo('domDidMount',(e=>{e.addEventListener('mouseenter',(()=>{!t.hoverDisabled&&t.setTimer('onMouseEnter',(()=>t.sendSignal('onHover',o=!0)),t.hoverTimeout)})),e.addEventListener('mouseleave',(()=>{'one-time'===t.hoverDisabled&&(t.hoverDisabled=!1),t.clearTimers('onMouseEnter'),o&&t.sendSignal('onHover',o=!1)}))})),null}),((e,t)=>{const onKeyDown=e=>{'Escape'===e.key&&(e.preventDefault(),e.stopPropagation(),t.sendSignal('onEscape'))};return t.useEscape=e=>(e?window.addEventListener:window.removeEventListener)('keydown',onKeyDown),null}),MixPositionedPopup,((e,t)=>{t.state=Object.assign(Object.assign({},t.state),{elementMargin:5,containerMargin:10,popupFadeIn:100,popupFadeOut:300}),t.popupContainer=C,t.setHovered=e=>{const o=t.hoverRef.getElement();e?t.showPopup(t.props.getPositionSource?t.props.getPositionSource(o):o):t.hidePopup(),t.useEscape(t.props.escToCloseTip&&e||!1)},t.listenTo('onHover',(e=>{e&&'one-time'===t.hoverDisabled?t.hoverDisabled=!1:t.setHovered(e)})),t.listenTo('onEscape',(()=>t.hidePopup()));const onClick=e=>{t.props.onClick&&t.props.onClick(e),!1!==t.props.clickToCloseTip&&(t.state.popupOpened?t.hidePopup():t.hoverDisabled='one-time')};return t.renderPopup=()=>'function'==typeof t.props.renderTip?t.props.renderTip(t):t.props.renderTip,t.listenTo('preUpdate',(e=>{e&&e.disableHover!==t.props.disableHover&&(t.hoverDisabled=t.props.disableHover)})),e=>{const{class:o,className:n,tag:s,renderTip:i,getPositionSource:r,escToCloseTip:l,clickToCloseTip:a,onClick:d,refreshId:c,rootRef:u}=e,p=__rest$4(e,['class','className','tag','renderTip','getPositionSource','escToCloseTip','clickToCloseTip','onClick','refreshId','rootRef']);return t.refreshPopupId=i,h.def(s,Object.assign({_ref:u?[u,t.hoverRef]:t.hoverRef,class:classNames(o,n),onClick},p),h.Content,h.def(t.WithTooltip))}}),null),w=['heading','code','props','state','contexts','rendered-by','wired','remote','children','renders'],x={'':null,expanded:h.def('svg',{viewBox:'0 0 10 10'},h.def('path',{d:'M 2.5,4 L 5,6 L 7.5,4',fill:'none',stroke:'currentColor','stroke-width':'1.5','stroke-linejoin':'round','stroke-linecap':'round'})),collapsed:h.def('svg',{viewBox:'0 0 10 10'},h.def('path',{d:'M 4,2.5 L 6,5 L 4,7.5',fill:'none',stroke:'currentColor','stroke-width':'1.5','stroke-linejoin':'round','stroke-linecap':'round'})),back:h.def('svg',{viewBox:'0 0 768 768'},h.def('path',{d:'M658.8,527.9c14.4,0,26.2-11.8,26.2-26.1V292.3c0-14.4-11.8-26.2-26.2-26.2H397V135.2c0-10.6-6.4-20.1-16.2-24.2 c-9.7-4-21-1.8-28.5,5.7L90.5,378.5c-10.1,10.2-10.1,26.9,0,37l261.8,261.8c4.9,5.1,11.6,7.7,18.5,7.7c3.3,0,6.7-0.7,10-2 c9.8-4.1,16.2-13.6,16.2-24.2V527.9H658.8L658.8,527.9z',fill:'currentColor'})),forwards:h.def('svg',{viewBox:'0 0 768 768'},h.def('path',{d:'M109.1,527.9h261.8v130.9c0,10.6,6.4,20.1,16.2,24.2c3.3,1.3,6.7,2,10,2c6.9,0,13.6-2.6,18.5-7.7l261.8-261.8 c10.1-10.1,10.1-26.8,0-37L415.6,116.7c-7.5-7.5-18.8-9.7-28.5-5.7c-9.8,4.1-16.2,13.6-16.2,24.2v130.9H109.1 c-14.4,0-26.2,11.8-26.2,26.2v209.5C82.9,516.1,94.7,527.9,109.1,527.9L109.1,527.9z',fill:'currentColor'})),console:h.def('svg',{viewBox:'0 0 10 10'},h.def('path',{d:'M 2,3 L 4,5 L 2,7',fill:'none',stroke:'currentColor','stroke-width':'1.5','stroke-linejoin':'round','stroke-linecap':'round'}),h.def('line',{x1:'6',x2:'8.5',y1:'8',y2:'8',stroke:'currentColor','stroke-width':'1.5','stroke-linejoin':'round','stroke-linecap':'round'})),theme:h.def('svg',{viewBox:'0 0 768 768'},h.def('path',{d:'M386.4,50.2c-184.5,0-334,149.5-334,334s149.5,334,334,334c59.1,0,84.8-81,36.6-114.1c-29.8-20.5,18.2-83.2,70.4-83.2 c79.9,0,227,12.7,227-136.7C720.4,199.8,570.9,50.2,386.4,50.2z M148.4,401.8c-22.6,0-40.9-18.3-40.9-40.9s18.3-40.9,40.9-40.9 c22.6,0,40.9,18.3,40.9,40.9S171,401.8,148.4,401.8z M217.6,272.9c-26.2,0-47.5-21.2-47.5-47.5c0-26.2,21.2-47.5,47.5-47.5 c26.2,0,47.5,21.2,47.5,47.5C265.1,251.7,243.8,272.9,217.6,272.9z M358.6,209c-29.9,0-54.1-24.2-54.1-54.1 c0-29.9,24.2-54.1,54.1-54.1c29.9,0,54.1,24.2,54.1,54.1C412.6,184.8,388.4,209,358.6,209z M521.1,262.2c-32.1,0-58.1-26-58.1-58.1 s26-58.1,58.1-58.1c32.1,0,58.1,26,58.1,58.1S553.2,262.2,521.1,262.2z M613.1,427.1c-34.6,0-62.6-28-62.6-62.6s28-62.6,62.6-62.6 c34.6,0,62.6,28,62.6,62.6S647.7,427.1,613.1,427.1z',fill:'currentColor'})),close:h.def('svg',{viewBox:'0 0 16 16'},h.def('path',{d:'M10.1,8L13,5.1c0.6-0.6,0.6-1.5,0-2.1c-0.6-0.6-1.5-0.6-2.1,0L8,5.9L5.1,3C4.5,2.4,3.6,2.4,3,3C2.4,3.6,2.4,4.5,3,5.1L5.9,8 L3,10.9c-0.6,0.6-0.6,1.5,0,2.1c0.3,0.3,0.7,0.4,1.1,0.4s0.8-0.1,1.1-0.4L8,10.1l2.9,2.9c0.3,0.3,0.7,0.4,1.1,0.4s0.8-0.1,1.1-0.4 c0.6-0.6,0.6-1.5,0-2.1L10.1,8z',fill:'currentColor'})),info:h.def('svg',{viewBox:'0 0 16 16'},h.def('path',{d:'M8,15.2c-1,0-1.7-0.8-1.7-1.7v-6H4.9c0-1,1.1-1.7,3.1-1.7c1,0,1.7,0.8,1.7,1.7v6H11C11.1,14.5,9.7,15.2,8,15.2z',fill:'currentColor'}),h.def('circle',{cx:'8',cy:'2.6',r:'1.7',fill:'currentColor'})),'show-all':h.def('svg',{viewBox:'0 0 768 768'},h.def('path',{d:'M384 134.4c-177.6 0-331.2 139.2-331.2 249.6s158.4 249.6 331.2 249.6c182.4 0 331.2-153.6 331.2-249.6s-148.8-249.6-331.2-249.6zM384 576c-158.4 0-273.6-124.8-273.6-192s115.2-192 273.6-192c153.6 0 273.6 134.4 273.6 192s-120 192-273.6 192z M384 244.8c-67.2 0-124.8 62.4-124.8 139.2s57.6 139.2 124.8 139.2 124.8-62.4 124.8-139.2-57.6-139.2-124.8-139.2z',fill:'currentColor'})),'show-matched':h.def('svg',{viewBox:'0 0 768 768'},h.def('path',{d:'M744 158.4c-14.4-24-43.2-28.8-67.2-14.4l-91.2 57.6c-52.8-38.4-124.8-67.2-201.6-67.2-177.6 0-331.2 139.2-331.2 249.6 0 38.4 19.2 81.6 52.8 120l-62.4 38.4c-24 14.4-28.8 43.2-14.4 67.2 9.6 14.4 24 24 38.4 24 9.6 0 19.2 0 24-9.6l86.4-52.8c57.6 38.4 129.6 62.4 201.6 62.4 182.4 0 331.2-153.6 331.2-249.6 0-33.6-19.2-76.8-52.8-115.2l67.2-43.2c28.8-14.4 33.6-48 19.2-67.2zM110.4 384c0-67.2 115.2-192 273.6-192 57.6 0 105.6 19.2 148.8 43.2l-374.4 235.2c-28.8-28.8-48-62.4-48-86.4zM657.6 384c0 57.6-120 192-273.6 192-57.6 0-105.6-14.4-148.8-38.4l72-43.2c38.4 33.6 86.4 43.2 134.4 19.2 48-28.8 72-86.4 67.2-144l100.8-67.2c28.8 28.8 48 62.4 48 81.6z',fill:'currentColor'})),'scroll-to':h.def('svg',{viewBox:'0 0 768 768'},h.def('path',{d:'M368.2,704.9c9,9,23.5,9,32.4-0.1l182.8-185.4c14.3-14.4,4.1-38.9-16.3-38.9h-83.4V266.6c0-13.7-11.2-24.9-24.9-24.9H309.6 c-13.7,0-24.9,11.2-24.9,24.9v213.8H199c-20.4,0-30.6,24.6-16.2,39L368.2,704.9z M304.7,202h159.1c10.9,0,19.9-9,19.9-19.9c0-10.9-9-19.9-19.9-19.9H304.7c-10.9,0-19.9,9-19.9,19.9 C284.8,193,293.7,202,304.7,202z M304.7,122.4h159.1c10.9,0,19.9-9,19.9-19.9s-9-19.9-19.9-19.9H304.7c-10.9,0-19.9,9-19.9,19.9S293.7,122.4,304.7,122.4z',fill:'currentColor'})),'select-all':h.def('svg',{viewBox:'0 0 768 768'},h.def('path',{d:'M128,96c-17.7,0-32,14.3-32,32v512c0,17.7,14.3,32,32,32h512c17.7,0,32-14.3,32-32V128c0-17.7-14.3-32-32-32H128z M608,608 H160V160h448V608z M327.4,500.5c6.1,7.3,15.1,11.5,24.6,11.5c0.3,0,0.5,0,0.8,0c9.8-0.2,18.9-5,24.8-12.8l144-192 c10.6-14.1,7.7-34.2-6.4-44.8c-14.1-10.6-34.2-7.7-44.8,6.4L350.7,428.4l-54.1-64.9c-11.3-13.6-31.5-15.4-45.1-4.1 c-13.6,11.3-15.4,31.5-4.1,45.1L327.4,500.5z',fill:'currentColor'})),'select-none':h.def('svg',{viewBox:'0 0 768 768'},h.def('path',{d:'M640,96H128c-17.7,0-32,14.3-32,32v512c0,17.7,14.3,32,32,32h512c17.7,0,32-14.3,32-32V128C672,110.3,657.7,96,640,96z  M556,288L376,528c-7.4,9.8-18.8,15.8-31,16c-0.4,0-0.6,0-1,0c-11.9,0-23.1-5.3-30.8-14.4l-100-120c-14.1-17-11.9-42.3,5.1-56.4 c17-14.1,42.3-11.9,56.4,5.1l67.6,81.1L492,240c13.3-17.6,38.4-21.3,56-8C565.7,245.2,569.3,270.4,556,288z',fill:'currentColor'})),'no-selection':h.def('svg',{viewBox:'0 0 768 768'},h.def('path',{d:'M543.7,352C438,352,352,438,352,543.7s86,191.7,191.7,191.7s191.7-86,191.7-191.7S649.5,352,543.7,352z M543.7,416 c23.6,0,45.8,6.5,64.8,17.7L433.7,608.5c-11.2-19-17.7-41.2-17.7-64.8C416,473.3,473.3,416,543.7,416z M543.7,671.5 c-23.6,0-45.8-6.5-64.8-17.7l174.8-174.8c11.2,19,17.7,41.2,17.7,64.8C671.5,614.2,614.2,671.5,543.7,671.5z',fill:'currentColor'}),h.def('path',{d:'M54,32c-12.2,0-22,9.8-22,22v308c0,12.2,9.8,22,22,22h308c12.2,0,22-9.8,22-22V54c0-12.2-9.8-22-22-22H54z M326.7,147.2 L202.5,312.9c-5.1,6.8-12.9,10.8-21.4,11c-0.2,0-0.5,0-0.7,0c-8.2,0-16-3.6-21.2-9.9l-69-82.8c-9.8-11.7-8.2-29.1,3.5-38.9 c11.7-9.8,29.1-8.2,38.9,3.5l46.7,56l103.3-137.7c9.1-12.2,26.4-14.7,38.6-5.5C333.4,117.7,335.8,135,326.7,147.2z',fill:'currentColor'})),'no-filter':h.def('svg',{viewBox:'0 0 768 768'},h.def('path',{d:'M543.7,352C438,352,352,438,352,543.7s86,191.7,191.7,191.7s191.7-86,191.7-191.7S649.5,352,543.7,352z M543.7,416 c23.6,0,45.8,6.5,64.8,17.7L433.7,608.5c-11.2-19-17.7-41.2-17.7-64.8C416,473.3,473.3,416,543.7,416z M543.7,671.5 c-23.6,0-45.8-6.5-64.8-17.7l174.8-174.8c11.2,19,17.7,41.2,17.7,64.8C671.5,614.2,614.2,671.5,543.7,671.5z',fill:'currentColor'}),h.def('path',{d:'M288.5,282.4v191.2c1,7.3-1.5,15-7,20.1c-9.5,9.5-24.7,9.5-34.2,0L198.5,445c-5.6-5.6-8-13.1-7-20.1V282.4h-0.7L51,103.3 c-8.2-10.4-6.3-25.7,4.1-34c4.6-3.4,9.7-5.3,15-5.3h339.7c5.3,0,10.4,1.9,15,5.3c10.4,8.2,12.4,23.5,4.1,34L289.3,282.4H288.5 L288.5,282.4z',fill:'currentColor'})),'no-info':h.def('svg',{viewBox:'0 0 768 768'},h.def('path',{d:'M543.7,352C438,352,352,438,352,543.7s86,191.7,191.7,191.7s191.7-86,191.7-191.7S649.5,352,543.7,352z M543.7,416 c23.6,0,45.8,6.5,64.8,17.7L433.7,608.5c-11.2-19-17.7-41.2-17.7-64.8C416,473.3,473.3,416,543.7,416z M543.7,671.5 c-23.6,0-45.8-6.5-64.8-17.7L653.7,479c11.2,19,17.7,41.2,17.7,64.8C671.5,614.2,614.2,671.5,543.7,671.5z',fill:'currentColor'}),h.def('path',{d:'M162.2,485.2c-32.6,0-55.8-27.9-55.8-55.8v-200H59.8c0-32.6,37.2-55.8,102.3-55.8c32.6,0,55.8,27.9,55.8,55.8v200h41.9 C264.5,461.9,218,485.2,162.2,485.2z',fill:'currentColor'}),h.def('circle',{cx:'162.2',cy:'71.8',r:'55.8',fill:'currentColor'})),filter:h.def('svg',{viewBox:'0 0 768 768'},h.def('path',{d:'M448 384v252.16c1.28 9.6-1.92 19.84-9.28 26.56-12.48 12.48-32.64 12.48-45.12 0l-64.32-64.32c-7.36-7.36-10.56-17.28-9.28-26.56v-187.84h-0.96l-184.32-236.16c-10.88-13.76-8.32-33.92 5.44-44.8 6.080-4.48 12.8-7.040 19.84-7.040h448c7.040 0 13.76 2.56 19.84 7.040 13.76 10.88 16.32 31.040 5.44 44.8l-184.32 236.16h-0.96z',fill:'currentColor'})),'filter-expanded':h.def('svg',{viewBox:'0 0 768 768'},h.def('path',{d:'M 672,512 L 544,672 L 416,512',fill:'none',stroke:'currentColor','stroke-width':'96','stroke-linejoin':'round','stroke-linecap':'round'}),h.def('path',{d:'M288.5,282.4v191.2c1,7.3-1.5,15-7,20.1c-9.5,9.5-24.7,9.5-34.2,0L198.5,445c-5.6-5.6-8-13.1-7-20.1V282.4h-0.7L51,103.3 c-8.2-10.4-6.3-25.7,4.1-34c4.6-3.4,9.7-5.3,15-5.3h339.7c5.3,0,10.4,1.9,15,5.3c10.4,8.2,12.4,23.5,4.1,34L289.3,282.4H288.5 L288.5,282.4z',fill:'currentColor'})),'filter-collapsed':h.def('svg',{viewBox:'0 0 768 768'},h.def('path',{d:'M 544,384 L 704,512 L 544,640',fill:'none',stroke:'currentColor','stroke-width':'96','stroke-linejoin':'round','stroke-linecap':'round'}),h.def('path',{d:'M288.5,282.4v191.2c1,7.3-1.5,15-7,20.1c-9.5,9.5-24.7,9.5-34.2,0L198.5,445c-5.6-5.6-8-13.1-7-20.1V282.4h-0.7L51,103.3 c-8.2-10.4-6.3-25.7,4.1-34c4.6-3.4,9.7-5.3,15-5.3h339.7c5.3,0,10.4,1.9,15,5.3c10.4,8.2,12.4,23.5,4.1,34L289.3,282.4H288.5 L288.5,282.4z',fill:'currentColor'})),'filter-parents':h.def('svg',{viewBox:'0 0 768 768'},h.def('path',{d:'M288.5,282.4v191.2c1,7.3-1.5,15-7,20.1c-9.5,9.5-24.7,9.5-34.2,0L198.5,445c-5.6-5.6-8-13.1-7-20.1V282.4h-0.7L51,103.3 c-8.2-10.4-6.3-25.7,4.1-34c4.6-3.4,9.7-5.3,15-5.3h339.7c5.3,0,10.4,1.9,15,5.3c10.4,8.2,12.4,23.5,4.1,34L289.3,282.4H288.5 L288.5,282.4z',fill:'currentColor'}),h.def('path',{d:'M656,576c-35.9,0-66.3,23.7-76.4,56.3c-1.2-0.2-2.4-0.3-3.6-0.3H472v-99.3c36.9-10.5,64-44.5,64-84.7c0-48.5-39.5-88-88-88 s-88,39.5-88,88c0,40.2,27.1,74.2,64,84.7V656c0,13.3,10.7,24,24,24h128c1.2,0,2.4-0.1,3.6-0.3c10.1,32.6,40.5,56.3,76.4,56.3 c44.2,0,80-35.8,80-80S700.2,576,656,576z M408,448c0-22.1,17.9-40,40-40s40,17.9,40,40s-17.9,40-40,40S408,470.1,408,448z',fill:'currentColor'})),'filter-children':h.def('svg',{viewBox:'0 0 768 768'},h.def('path',{d:'M288.5,282.4v191.2c1,7.3-1.5,15-7,20.1c-9.5,9.5-24.7,9.5-34.2,0L198.5,445c-5.6-5.6-8-13.1-7-20.1V282.4h-0.7L51,103.3 c-8.2-10.4-6.3-25.7,4.1-34c4.6-3.4,9.7-5.3,15-5.3h339.7c5.3,0,10.4,1.9,15,5.3c10.4,8.2,12.4,23.5,4.1,34L289.3,282.4H288.5 L288.5,282.4z',fill:'currentColor'}),h.def('path',{d:'M656,560c-44.7,0-82.3,30.6-93,72h-91V524.3c32.5-10.2,56-40.5,56-76.3c0-44.2-35.8-80-80-80s-80,35.8-80,80 c0,35.8,23.5,66.1,56,76.3V656c0,13.3,10.7,24,24,24h115c10.7,41.4,48.3,72,93,72c52.9,0,96-43.1,96-96S708.9,560,656,560z M656,699.6c-24.1,0-43.6-19.6-43.6-43.6s19.6-43.6,43.6-43.6s43.6,19.6,43.6,43.6S680.1,699.6,656,699.6z',fill:'currentColor'})),'item-selected':h.def('svg',{viewBox:'0 0 10 10'},h.def('circle',{r:2,cx:5,cy:5,fill:'currentColor'})),'item-deselected':h.def('svg',{viewBox:'0 0 10 10'},h.def('circle',{r:1.6,cx:5,cy:5,strokeWidth:.8,stroke:'currentColor',fill:'none'}))};var __rest$3=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&'function'==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(o[n[s]]=e[n[s]])}return o};function UIAppIcon(e){const{iconName:t,iconSize:o,className:n}=e,s=__rest$3(e,['iconName','iconSize','className']);return h.def('span',Object.assign({},s,{className:classNames('ui-icon style-ui-icon flex-no-shrink',o&&'size-'+o,n)}),x[t])}var __rest$2=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&'function'==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(o[n[s]]=e[n[s]])}return o};const UIAppButton=(e,t)=>{const onClick=e=>{t.props.onPress&&t.props.onPress(e),t.props.onClick&&t.props.onClick(e)},onKeyDown=e=>{!t.props.onPress||' '!==e.key&&'Enter'!==e.key||t.props.disabled||(e.preventDefault(),t.props.onPress(e)),t.props.onKeyDown&&t.props.onKeyDown(e)};return e=>{const{look:t,size:o,invisible:n,iconName:s,iconClassName:i,className:r,disabled:l,onPress:a,onClick:d,onKeyDown:c,toggled:u}=e,p=__rest$2(e,['look','size','invisible','iconName','iconClassName','className','disabled','onPress','onClick','onKeyDown','toggled']);return h.def(D,Object.assign({},p,{tag:'button',disabled:!!(n||l&&'false'!==l)||void 0,onKeyDown,onClick,className:classNames('ui-app-button style-ui-button style-ui-focusable','focusable-look-'+(t||'edge'),void 0!==u?u?'button-on':'button-off':void 0,o&&'size-'+o,n&&'layout-no-pointer style-opacity-0',r)}),void 0!==s?h.def(UIAppIcon,{iconName:s,className:i,iconSize:'narrow'!==o?o:void 0}):null,h.Content)}};var __rest$1=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&'function'==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(o[n[s]]=e[n[s]])}return o};const UIAppInput=(e,t)=>{const o=new h.Ref,onInput=e=>{if(t.props.onInput&&t.props.onInput(e),t.props.onValue){const e=o.getElement();e&&t.props.onValue(e.value)}},onKeyDown=e=>{if(t.props.onKeyDown&&t.props.onKeyDown(e),'Escape'===e.key&&t.props.escToClearInput){const e=o.getElement();e&&e.value&&(e.value='',t.props.onValue&&t.props.onValue(''))}};return e=>{const{look:t,escToClearInput:n,className:s,onKeyDown:i,rootRef:r,onInput:l}=e,a=__rest$1(e,['look','escToClearInput','className','onKeyDown','rootRef','onInput']);return h.def(D,Object.assign({},a,{rootRef:o,onKeyDown,onInput,tag:'input',className:classNames('ui-app-input style-ui-input style-ui-focusable','focusable-look-'+(t||'edge'),s)}))}};function stringifyObject(e,t,o=1){if(!e||'object'!=typeof e)return'string'==typeof e?'"'+e+'"':''+e;if(Array.isArray(e))return'['+(o?e.map((e=>stringifyObject(e,!1,o-1))):e.toString())+']';let n='';if(!o)return''+e;o--;for(const s in e)n+=(t?'\n    ':' ')+s+': '+(o?stringifyObject(e[s],!1,o):'string'==typeof e[s]?'"'+e[s]+'"':''+e[s])+',';return n&&(n=n.slice(0,n.length-1)),'{'+n+(t&&n?'\n':' ')+'}'}const Prettify=e=>{const t=classNames('style-ui-code prettyprint',e.className);return window.PR?h.defHTML(window.PR.prettyPrintOne(e.code),e.tag||'code',{className:t,style:e.style}):h.def(e.tag||'code',{class:t,style:e.style},e.code)},PrettifyDelay=(e,t)=>{t.state={};const o=createTrigger((()=>{t.state.isReady&&t.setState({isReady:!1}),t.setTimer('reset',(()=>t.setState({isReady:!0})),t.props.delay||100)}),void 0,'shallow');return(e,t)=>{o([e.resetId,e.origCode]);const n=classNames('style-ui-code prettyprint',e.className),s=(e.prePrettifier?e.prePrettifier(e.origCode):e.origCode).trim();return t.isReady&&window.PR?h.defHTML(window.PR.prettyPrintOne(s),e.tag||'code',{className:n,style:e.style}):h.defHTML(s,e.tag||'code',{className:n,style:e.style})}};function escapeHTML(e){return window.PR?e.replace(/\&(?!(\w+;))/g,'&amp;').replace(/</g,'&lt;'):e}function beautify(e){return window.exports&&window.exports.js_beautify?window.exports.js_beautify(e):e}function getMiniScrollableProps(e){return{className:'layout-scrollable style-scrollable'+(e?' '+e:''),style:'max-width: 100%; max-height: 250px'}}const renderComponentLinkTip=()=>wrapTip(h.def('div',null,'Scroll and focus to the target.',h.def('br',null),' - Click with ',h.def('b',null,'Ctrl'),'/',h.def('b',null,'Alt'),' to open details popup instead.',h.def('br',null),' - Click with ',h.def('b',null,'Shift'),' to log into console instead.')),renderUIAppTipSectionTip=()=>wrapTip(h.def('div',null,'Toggle the section visibility.',h.def('br',null),' - Click with ',h.def('b',null,'Ctrl'),'/',h.def('b',null,'Alt'),' to only show this section or all.')),renderConsoleTip=()=>wrapTip(h.def('div',null,'Click to log in console.')),UIAppTipSection=(e,t,o)=>{t.state={hiddenSections:[]},o.listenToData('settings.hiddenTipSections',(e=>{t.setState({hiddenSections:e})}),[t.state.hiddenSections]);const onSectionClick=e=>{let n=t.state.hiddenSections.slice();const s=t.props.type;if(e.ctrlKey||e.altKey||e.metaKey)n=n.length+1!==w.length||n.includes(s)?w.filter((e=>e!==s)):[];else{const e=n.indexOf(s);-1!==e?n.splice(e,1):n.push(s)}o.setInData('settings.hiddenTipSections',n)},onPressLink=e=>{t.props.onItemLink&&void 0!==t.props.idToScroll&&t.props.onItemLink(t.props.idToScroll,e.shiftKey?'log':e.ctrlKey||e.altKey||e.metaKey?'details':'focus')},onLog=()=>{consoleLog(t.props.debugInfo,'MixDOMDebug: Log info',Object.assign({},t.props.debugTarget))};return(e,t)=>{const o=!t.hiddenSections.includes(e.type),n=void 0===e.useOverflow?void 0!==e.extraTitle||void 0!==e.afterTitle:e.useOverflow;return h.def('aside',null,h.def('h3',{class:classNames('style-ui-heading',e.debugInfo&&'flex-row')},h.def(UIAppButton,{look:'transparent',className:classNames(n&&'style-text-ellipsis',!o&&'style-dimmed'),renderTip:renderUIAppTipSectionTip,onPress:onSectionClick},h.def(Title,{title:e.title,extraTitle:e.extraTitle,afterTitle:e.afterTitle,idToScroll:e.idToScroll,onPress:onPressLink})),e.debugInfo?h.def('span',{class:'flex-grow'}):null,e.debugInfo?h.def(UIAppButton,{look:'transparent',iconName:'console',onPress:onLog,renderTip:renderConsoleTip}):null),o?h.def(h.WithContent,null,h.def('div',Object.assign({},!1!==e.useDefaultLimits?getMiniScrollableProps('style-ui-mini-panel'):{className:'style-ui-mini-panel'}),h.Content)):null)}},UIAppTipHeading=(e,t,o)=>{const onPressLink=e=>{t.props.onItemLink&&void 0!==t.props.idToScroll&&t.props.onItemLink(t.props.idToScroll,e.shiftKey?'log':e.ctrlKey||e.altKey||e.metaKey?'details':'focus')},onPressClose=e=>{t.props.onItemLink&&t.props.onItemLink(null,'details-break')},onHistoryPrev=e=>{t.props.onHistory&&t.props.onHistory(t.props.iHistory?Math.max(t.props.iHistory-1,0):0)},onHistoryNext=e=>{var o;t.props.onHistory&&t.props.onHistory(null!=t.props.iHistory?Math.min(t.props.iHistory+1,(null===(o=t.props.history)||void 0===o?void 0:o.length)||0):0)};return e=>{const t=void 0===e.useOverflow?void 0!==e.extraTitle||void 0!==e.afterTitle:e.useOverflow;return h.def('aside',null,h.def('h2',{class:'style-ui-heading flex-row flex-align-items-baseline layout-gap-m'},e.history&&e.history[1]?e.history[2]?h.def(h.Fragment,null,h.def(UIAppButton,{iconName:'back',look:'transparent',size:'large',className:'flex-align-self-center',onPress:onHistoryPrev,disabled:0===e.iHistory}),h.def(UIAppButton,{iconName:'forwards',look:'transparent',size:'large',className:'flex-align-self-center',onPress:onHistoryNext,disabled:e.iHistory===e.history.length-1})):h.def(UIAppButton,{iconName:1===e.iHistory?'back':'forwards',look:'transparent',size:'large',className:'flex-align-self-center',onPress:1===e.iHistory?onHistoryPrev:onHistoryNext}):null,h.def('span',{class:'flex-grow'}),h.def('span',{class:classNames('flex-row flex-align-items-baseline layout-gap-l',t&&'style-text-ellipsis')},h.def(Title,{title:e.title,extraTitle:e.extraTitle,afterTitle:e.afterTitle,idToScroll:e.idToScroll,onPress:onPressLink})),h.def('span',{class:'flex-grow'}),h.def(UIAppButton,{iconName:'close',look:'transparent',size:'large',className:'flex-align-self-center',onPress:onPressClose})),h.def(h.WithContent,null,h.def('div',Object.assign({},!1!==e.useDefaultLimits?getMiniScrollableProps('style-ui-mini-panel'):{className:'style-ui-mini-panel'}),h.Content)))}};function Title(e){return e.idToScroll?h.def(h.Fragment,null,void 0!==e.extraTitle?h.def(h.Fragment,null,e.title,': '):null,h.def(UIAppButton,{look:'edge',className:'style-text-ellipsis',onPress:e.onPress,renderTip:renderComponentLinkTip},void 0!==e.extraTitle?e.extraTitle:e.title),e.afterTitle):h.def(h.Fragment,null,e.title,e.extraTitle,e.afterTitle)}function readComponentOneLine(e,t,o){if('boundary'===e.type)return h.def(h.Fragment,null,h.def(ComponentLink,{name:e.def.tag.name||'Anonymous',onPress:t||void 0}),h.def(Prettify,{code:e.def.tag.toString(),className:'style-text-ellipsis'}));let n,s;e.def.getRemote?(n='Remote pass',s=e.def.getRemote().boundary):(n='Content pass',s=e.boundary&&e.boundary.sourceBoundary);const i=s&&s._outerDef.tag.name||'Anonymous';return h.def(h.Fragment,null,o?null:h.def('span',{_key:'pass',class:'style-color-dim'},t?h.def(ComponentLink,{name:n,onPress:t}):n),h.def('span',{_key:'from',class:'style-color-dim'},' from '),h.def('b',null,i))}function getGroundingNode(e){let t=e;for(;t=t.parent;)switch(t.type){case'pass':case'boundary':return t}return null}function ComponentLink(e){return e.onPress?h.def(UIAppButton,{look:'edge',size:'narrow',className:e.className,onPress:e.onPress,renderTip:renderComponentLinkTip},h.def('b',null,e.name)):h.def('b',null,e.name)}function RenderComponentPartList(e){var t;const o='contexts'===e.part,n=o?(null===(t=e.component.contextAPI)||void 0===t?void 0:t.getContexts())||{}:e.component[e.part]||{},s=Object.keys(n);return void 0===s[0]?null:h.def('ul',{class:'style-ui-list'},s.map((e=>h.def('li',{_key:e,class:'flex-row flex-align-items-baseline layout-gap-l'},h.def(RenderPropertyName,{bold:!0},e,': '),h.def(Prettify,{code:o?'Context':beautify(stringifyObject(n[e],!1,2)),tag:'pre',className:'style-text-ellipsis'})))))}function RenderPropertyName(e){return h.def('span',{class:classNames('style-color-dim layout-inline-block flex-no-shrink',e.italic&&'style-text-italic',e.bold&&'style-text-bold'),style:'min-width: 100px;'},h.Content)}function RenderComponentWiredChildren(e){if(!e.wired.size)return null;let t=-1;return h.def('ul',{class:'style-ui-list'},[...e.wired].map((o=>o.api&&o.api.components.size?[...o.api.components].map((o=>h.def('li',{_key:++t,class:'flex-row flex-align-items-baseline layout-gap-l'},h.def(RenderComponentChild,{treeNode:o.boundary.treeNode,onItemLink:e.onItemLink,index:t,childText:'Wired'})))):null)))}function RenderComponentRemoteChildren(e){const t=e.remote,o=e.remotePasses||t.getHost().findTreeNodes(['pass'],0,!1,(e=>e.def.getRemote&&e.def.getRemote()===t));return o[0]?h.def('ul',{class:'style-ui-list'},[...o].map(((t,o)=>h.def('li',{_key:t,class:'flex-row flex-align-items-baseline layout-gap-l'},h.def(RenderComponentChild,{treeNode:t,onItemLink:e.onItemLink,index:o,childText:'Pass'}))))):null}function RenderComponentChildren(e){const t=e.treeNode.boundary;return t&&t.innerBoundaries[0]?h.def('ul',{class:'style-ui-list'},t.innerBoundaries.map(((t,o)=>h.def('li',{_key:o,class:'flex-row flex-align-items-baseline layout-gap-l'},h.def(RenderComponentChild,{treeNode:t.treeNode,onItemLink:e.onItemLink,index:o}))))):null}const RenderComponentChild=(e,t)=>{const onPress=e=>t.props.onItemLink&&t.props.onItemLink(t.props.treeNode,e.shiftKey?'log':e.ctrlKey||e.altKey||e.metaKey?'details':'focus');return e=>h.def(h.Fragment,null,h.def(RenderPropertyName,{italic:!0},e.childText||'Child',' ',void 0===e.index?'':'#'+(e.index+1),': '),readComponentOneLine(e.treeNode,onPress))},RenderedByComponents=(e,t)=>{var o,n,s;t.setConstantProps({treeNode:!0});const i=t.props.treeNode,r=(null===(o=i.sourceBoundary)||void 0===o?void 0:o.treeNode)||null,l='pass'===i.type?i:null,a=l?l.def.getRemote?l.def.getRemote().boundary.treeNode:(null===(s=null===(n=l.def.contentPass)||void 0===n?void 0:n.sourceBoundary)||void 0===s?void 0:s.treeNode)||null:null;let d=[];const c=new Map,u=createTrigger((()=>{let e=getGroundingNode(i);for(;e&&e!==r&&(d.push(e),!e.def.getRemote||e.def.getRemote().boundary.treeNode!==r);)e=getGroundingNode(e);d.reverse();const o=new Set(c.keys());for(const e of[...[r,a].filter((e=>e)),...d])e&&(c.set(e,c.get(e)||(o=>{t.props.onItemLink&&t.props.onItemLink(e,o.shiftKey?'log':o.ctrlKey||o.altKey||o.metaKey?'details':'focus')})),o.delete(e));for(const e of o)c.delete(e)})),p={class:'flex-row flex-align-items-baseline layout-gap-l'};return e=>(u(e.iUpdate),r||d[0]?h.def(UIAppTipSection,{type:'rendered-by',title:'Rendered by component'},h.def('ul',{class:'style-ui-list'},a?h.def('li',Object.assign({},p),h.def(RenderPropertyName,{italic:!0},'Pass from: '),readComponentOneLine(a,c.get(a))):null,r?h.def('li',Object.assign({},p),h.def(RenderPropertyName,{italic:!0},'Source: '),readComponentOneLine(r,c.get(r))):null,d.map((e=>h.def('li',Object.assign({},p,{_key:e.boundary.bId}),h.def(RenderPropertyName,{italic:!0},'Through: '),readComponentOneLine(e,c.get(e))))))):null)},UITreeNodeType=(e,t)=>{const renderConceptTip=()=>wrapTip(h.def('div',null,'Filter by view by treeNode type: ',h.def('b',null,t.props.item.treeNode.type||'empty'),'.',h.def('br',null),' - Click with ',h.def('b',null,'Ctrl'),'/',h.def('b',null,'Alt'),' to only filter this type.'));let o=null;const onRowClick=e=>{('click'!==e.type||!o||e.clientX===o[0]&&e.clientY===o[1])&&(t.props.onSelectItem&&t.props.onSelectItem(e),t.props.onTipPresence&&t.props.onTipPresence(t.props.item.treeNode,'hoverable',!1)),o=null},onRowMouseDown=e=>{o=[e.clientX,e.clientY]},onRowMouseEnter=e=>{t.props.onTipPresence&&t.props.onTipPresence(t.props.item.treeNode,'hoverable',!0)},onRowMouseLeave=e=>{t.props.onTipPresence&&t.props.onTipPresence(t.props.item.treeNode,'hoverable',!1)};return(e,t)=>{const o=e.item,n=o.treeNode;let s=n.type,i=null;switch(n.type){case'dom':i=h.def(Prettify,{code:escapeHTML(o.description),className:'style-text-ellipsis'});break;case'pass':case'boundary':i=readComponentOneLine(n);break;case'portal':i=h.def(h.Fragment,null,h.def('span',{class:'style-color-dim'},'Portal to '),h.def(Prettify,{code:escapeHTML(o.description),className:'style-text-ellipsis'}));break;case'root':i=h.def(h.Fragment,null,h.def('span',{class:'style-color-dim'},'Root container '),h.def(Prettify,{code:escapeHTML(o.description),className:'style-text-ellipsis'}));break;case'host':i=h.def(h.Fragment,null,h.def('span',{class:'style-color-dim'},'Nested host'));break;case'':i=h.def(h.Fragment,null,h.def('span',{class:'style-color-dim'},'Empty'))}return h.def('div',{class:classNames('flex-row flex-align-items-center flex-grow layout-overflow-hidden layout-gap-m layout-fit-height',e.className)},h.def('span',{class:classNames('description layout-fit-height flex-row flex-align-items-center flex-grow layout-overflow-hidden',e.displayClassName),onMouseEnter:onRowMouseEnter,onMouseLeave:onRowMouseLeave,onMouseDown:onRowMouseDown,onClick:onRowClick},h.def('div',{class:'layout-gap-m flex-row flex-align-items-baseline flex-grow layout-overflow-hidden'},i)),h.def(UIAppButton,{look:'filled',className:classNames('type style-ui-concept style-fill-app-type-'+s,e.conceptClassName),onPress:e.onSelectConcept,renderTip:renderConceptTip},s||'empty'))}};function UIAppTreeItem(e,t){t.state={};const onToggle=e=>{t.props.toggleCollapsed&&t.props.toggleCollapsed(t.props.item,e.shiftKey?'level':e.ctrlKey||e.metaKey?'siblings':e.altKey?'chain':'self')},onSelect=e=>{t.props.toggleSelected&&t.props.toggleSelected(t.props.item,e.shiftKey?'level':e.ctrlKey||e.metaKey?'siblings':e.altKey?'reset':'self')},onSelectConcept=e=>{t.props.toggleConcept&&t.props.toggleConcept(t.props.item.treeNode.type,e.ctrlKey||e.altKey||e.metaKey)},onToggleTip=e=>{t.props.onToggleTip&&t.props.onToggleTip(t.props.item.treeNode)},onViewInConsole=e=>{const o=t.props.item;switch(o.treeNode.type){case'boundary':consoleLog(t.props.debugInfo,'MixDOMDebug: Log component',o.treeNode.boundary.component);break;case'root':case'dom':case'boundary':consoleLog(t.props.debugInfo,'MixDOMDebug: Log DOM element',o.treeNode.domNode);break;case'host':consoleLog(t.props.debugInfo,'MixDOMDebug: Log nested host',o.treeNode.def.host);break;default:consoleLog(t.props.debugInfo,'MixDOMDebug: Log treeNode',o.treeNode)}};t.listenTo('didMount',(()=>{t.props.animate&&t.setTimer(null,(()=>t.setState({animFinished:!0})),25)}));const renderToggleTip=()=>wrapTip(h.def('div',null,'Click to collapse/uncollapse the item.',h.def('br',null),' - Click with ',h.def('b',null,'Shift'),' to toggle all items in the same level.',h.def('br',null),' - Click with ',h.def('b',null,'Ctrl'),' to toggle all siblings.',h.def('br',null),' - Click with ',h.def('b',null,'Alt'),' to toggle between expanding all or only this item and its parents and children.')),renderSelectTip=()=>wrapTip(h.def('div',null,'Click to select/deselect this item.',h.def('br',null),' - Click with ',h.def('b',null,'Shift'),' to toggle all items in the same level.',h.def('br',null),' - Click with ',h.def('b',null,'Ctrl'),' to toggle all siblings.',h.def('br',null),' - Click with ',h.def('b',null,'Alt'),' to reset selection to this item.')),renderConsoleTip=()=>wrapTip(h.def('div',null,'Click to log the item in console.')),renderTipTip=()=>wrapTip(h.def('div',null,'Click to open the details popup.'));return(e,t)=>{const o=6*e.item.level,n=`style-stroke-app-type-${e.item.treeNode.type||'empty'}`;return h.def('div',{role:'treeitem',class:classNames('ui-app-tree-item layout-fit-height layout-margin-m-x flex-row flex-align-items-center layout-gap-m style-hoverable',e.dimmed&&'style-disabled',e.animate&&(t.animFinished?'style-opacity-1':'style-opacity-0')),style:{marginLeft:o+'px'}},h.def('div',{class:classNames('level-indicator',e.selected?'style-dimmed':'style-disabled',e.selected&&n),style:`position: absolute; left: 0; height: 100%; width: ${o}px; background: linear-gradient(-160deg, currentColor, ${e.selected?'35%':'15%'}, transparent, 100%, transparent);`}),h.def(UIAppButton,{onPress:onSelect,iconName:e.selected?'item-selected':'item-deselected',className:'flex-align-self-center',iconClassName:classNames(!e.selected&&'style-dimmed',n),look:'transparent',renderTip:renderSelectTip}),h.def(UIAppButton,{onPress:onToggle,invisible:null===e.collapsed,disabled:null===e.collapsed||void 0,iconName:null===e.collapsed?'':e.collapsed?'collapsed':'expanded',look:'transparent',renderTip:renderToggleTip}),h.def(UITreeNodeType,{item:e.item,iUpdate:e.iUpdate,displayClassName:e.dimmed?'style-greyed':void 0,conceptClassName:e.dimmed?'style-greyed':void 0,onSelectItem:onSelect,onSelectConcept,onTipPresence:e.onTipPresence}),h.def(UIAppButton,{onPress:onToggleTip,iconName:'info',look:'transparent',renderTip:renderTipTip}),h.def(UIAppButton,{onPress:onViewInConsole,iconName:'console',look:'transparent',renderTip:renderConsoleTip}))}}const UIAppTipDisplay=(e,t)=>{t.state={history:[t.props.item],iHistory:0};const onKeyDown=e=>{'Escape'===e.key&&t.props.escToCloseTip&&t.props.onItemLink&&t.props.onItemLink(null,'details-break')};t.listenTo('didMount',(()=>document.addEventListener('keydown',onKeyDown))),t.listenTo('willUnmount',(()=>document.removeEventListener('keydown',onKeyDown))),t.listenTo('preUpdate',((e,o)=>{if(e&&(e.item!==t.props.item||e.reselectRefreshId!==t.props.reselectRefreshId))if(t.props.item===t.state.history[t.state.iHistory]);else if(t.props.item===t.state.history[t.state.iHistory+1])t.setInState('iHistory',t.state.iHistory+1);else{const e=t.state.history.slice(0,t.state.iHistory+1).concat([t.props.item]);t.setState({history:e,iHistory:e.length-1})}})),t.onHistory=e=>{t.setInState('iHistory',Math.min(Math.max(0,e),t.state.history.length-1)),t.props.onHistoryItem&&t.props.onHistoryItem(t.state.history[t.state.iHistory])};const getHeadingProps=()=>({idToScroll:(t.state.history[t.state.iHistory]||t.props.item).treeNode,onItemLink:t.props.onItemLink,history:t.state.history,iHistory:t.state.iHistory,onHistory:t.onHistory}),domDidMount=e=>{e.addEventListener('mouseenter',(()=>{var e;return null===(e=t.props.tipComponent)||void 0===e?void 0:e.setHovered(!0)})),e.addEventListener('mouseleave',(()=>{var e;return null===(e=t.props.tipComponent)||void 0===e?void 0:e.setHovered(!1)})),t.setTimer(null,(()=>t.setState({isAlive:!0})),1)},o={className:'layout-border-box',style:'max-width: 800px; max-height: 50vh;'},onTipEnter=()=>t.props.onTipPresence&&t.props.onTipPresence(t.props.item.treeNode,'popup',!0),onTipLeave=()=>t.props.onTipPresence&&t.props.onTipPresence(t.props.item.treeNode,'popup',!1);return(e,n)=>{var s,i;const r=t.state.history[t.state.iHistory]||t.props.item,l=r.treeNode;let a=!0,d=null,c=null,u=h.readDOMString(l,!1,0,null);switch(l.type){case'dom':{const e=l.def.tag;let t='';e?t=r.description:u&&(u='"'+u+'"'),d=h.def(UIAppTipHeading,Object.assign({title:e?(l.domNode&&void 0!==l.domNode.ownerSVGElement?'SVG':'HTML')+' element':'Text node',extraTitle:h.def(Prettify,{code:t?escapeHTML(t):r.description})},getHeadingProps()));break}case'boundary':{const t=l.def.tag,o=l.boundary.component,n='Remote'===o.constructor.MIX_DOM_CLASS?o.getHost().findTreeNodes(['pass'],0,!1,(e=>e.def.getRemote&&e.def.getRemote()===o)):null;d=h.def(h.Fragment,null,h.def(UIAppTipHeading,Object.assign({_key:'heading',title:'Remote'===t.MIX_DOM_CLASS?'Remote component':o.contextAPI?h.def(h.Fragment,null,'Component ',h.def('span',{class:'style-text-small'},'(with ContextAPI)')):'Component',extraTitle:h.def('b',{class:'style-color-emphasis'},r.name||'Anonymous')},getHeadingProps())),h.def(UIAppTipSection,{_key:'code',type:'code',title:'JS code',useDefaultLimits:!1},h.def(PrettifyDelay,Object.assign({origCode:t.toString(),prePrettifier:beautify,tag:'pre'},getMiniScrollableProps()))),o.props&&void 0!==Object.keys(o.props)[0]?h.def(UIAppTipSection,{_key:'props',type:'props',title:'Props',debugInfo:e.debugInfo,debugTarget:o.props},h.def(RenderComponentPartList,{component:o,part:'props'})):null,o.state&&void 0!==Object.keys(o.state)[0]?h.def(UIAppTipSection,{_key:'state',type:'state',title:'State',debugInfo:e.debugInfo,debugTarget:o.state},h.def(RenderComponentPartList,{component:o,part:'state'})):null,o.contextAPI&&void 0!==Object.keys(o.contextAPI.getContexts())[0]?h.def(UIAppTipSection,{_key:'contexts',type:'contexts',title:'Contexts',debugInfo:e.debugInfo,debugTarget:null===(s=o.contextAPI)||void 0===s?void 0:s.getContexts()},h.def(RenderComponentPartList,{component:o,part:'contexts'})):null),c=h.def(h.Fragment,null,o.wired&&o.wired.size?h.def(UIAppTipSection,{_key:'wired',type:'wired',title:'Wired components'},h.def(RenderComponentWiredChildren,{wired:o.wired,onItemLink:e.onItemLink})):null,n&&n[0]?h.def(UIAppTipSection,{_key:'remote',type:'remote',title:'Remote passes'},h.def(RenderComponentRemoteChildren,{remote:o,remotePasses:n,onItemLink:e.onItemLink})):null,l.boundary.innerBoundaries[0]?h.def(UIAppTipSection,{_key:'children',type:'children',title:'Inner components'},h.def(RenderComponentChildren,{treeNode:l,onItemLink:e.onItemLink})):null);break}case'root':a=!1,d=h.def(UIAppTipHeading,Object.assign({title:'Root container',extraTitle:r.description?h.def(Prettify,{code:escapeHTML(r.description)}):null},getHeadingProps()),h.def('ul',{class:'style-ui-list'},h.def('li',null,'Contains the debugged host.')));break;case'host':d=h.def(UIAppTipHeading,Object.assign({title:'Nested host'},getHeadingProps()),h.def('ul',{class:'style-ui-list'},h.def('li',null,'Contains another host instance.')));break;case'pass':d=h.def(UIAppTipHeading,Object.assign({title:l.def.getRemote?'Remote pass':'Content pass',afterTitle:readComponentOneLine(l,null,!0)},getHeadingProps())),c=h.def(h.Fragment,null,(null===(i=l.boundary)||void 0===i?void 0:i.innerBoundaries[0])?h.def(UIAppTipSection,{_key:'children',type:'children',title:'Inner components'},h.def(RenderComponentChildren,{treeNode:l,onItemLink:e.onItemLink})):null);break;case'portal':d=h.def(UIAppTipHeading,Object.assign({title:'Portal container',afterTitle:h.def(Prettify,{code:escapeHTML(r.description)})},getHeadingProps()));break;case'':d=h.def(UIAppTipHeading,Object.assign({title:'Empty'},getHeadingProps()),h.def('ul',{class:'style-ui-list'},h.def('li',null,'Empty treeNodes should not typically end up in the grounded tree.')))}return h.def('div',{class:classNames('style-ui-panel layout-scrollable style-scrollable flex-col layout-gap-m',o.className,n.isAlive&&'layout-auto-pointer'),style:o.style,_signals:{domDidMount},onMouseEnter:onTipEnter,onMouseLeave:onTipLeave},d,a?h.def(RenderedByComponents,{treeNode:l,iUpdate:e.iUpdate,onItemLink:e.onItemLink}):null,c,'root'!==l.type&&u?h.def(UIAppTipSection,{type:'renders',title:'Renders in DOM',useDefaultLimits:!1},h.def(PrettifyDelay,Object.assign({origCode:u.replace(/\t/g,'    '),prePrettifier:escapeHTML,tag:'pre'},getMiniScrollableProps()))):null)}},M=mixFuncsWith(MixPositionedPopup,((e,t)=>{t.state=Object.assign(Object.assign({},t.state),{item:t.props.item,elementMargin:5,containerMargin:10,popupFadeIn:100,popupFadeOut:300});const onHistoryItem=e=>{t.setState({popupSourceElement:t.props.getSourceElement?t.props.getSourceElement(e.id):null})};return t.popupContainer=C,t.renderPopup=()=>t.state.item?h.def(UIAppTipDisplay,{item:t.state.item,iUpdate:t.props.iUpdate,onItemLink:t.props.onItemLink,debugInfo:t.props.debugInfo,reselectRefreshId:t.props.reselectRefreshId,onHistoryItem,onTipPresence:t.props.onTipPresence,escToCloseTip:!0}):null,t.listenTo('preUpdate',((e,o,n)=>{const s=t.props;if(e&&(e.item!==s.item||e.iUpdate!==s.iUpdate||e.onItemLink!==s.onItemLink||e.debugInfo!==s.debugInfo||e.reselectRefreshId!==s.reselectRefreshId||e.onTipPresence!==s.onTipPresence||o&&o.popupSourceElement!==t.state.popupSourceElement)&&(t.refreshPopupId={}),e&&e.item!==s.item)if(s.item){const e=s.getSourceElement?s.getSourceElement():null;t.setState({item:s.item,popupSourceElement:e}),t.showPopup()}else t.hidePopup();o&&o.popupOpened&&!t.state.popupOpened&&t.setState({item:null,popupSourceElement:null})})),()=>h.def(t.WithTooltip,null)}),null),S={boundary:'[boundary]',dom:'[dom]',root:'[root] root container',host:'[host] nested host',pass:'[pass] content pass from','pass-remote':'[pass] remote pass from',portal:'[portal] portal to','':'[empty]'};function matchesFilter(e,t){return t&&t.some((t=>t.every((t=>{var o;return e.name.toLowerCase().includes(t)||e.description.toLowerCase().includes(t)||(S[(null===(o=e.treeNode.def)||void 0===o?void 0:o.getRemote)?'pass-remote':e.treeNode.type]||'').includes(t)}))))}function isItemWithinCollapsed(e,t){let o=e.parent;for(;o;){if(t.includes(o.id))return!0;o=o.parent}return!1}function findItemsIdsBy(e,t,o,n){var s,i;const r=o.indexOf(e.id),l=-1===r;switch(t){case'level':{const t=e.level,s=n.filter((e=>e.level===t)).map((e=>e.id));return l?[...o,...s.filter((e=>!o.includes(e)))]:o.filter((e=>!s.includes(e)))}case'siblings':{const t=(null===(i=null===(s=e.parent)||void 0===s?void 0:s.children)||void 0===i?void 0:i.map((e=>e.id)))||[e.id];return l?[...o,...t.filter((e=>!o.includes(e)))]:o.filter((e=>!t.includes(e)))}case'chain':case'parents':{const s=[e.id];let i=e.parent;for(;i;)s.push(i.id),i=i.parent;if('chain'===t){let t,o=e.children||[],n=0;for(;t=o[n++];)s.push(t.id),t.children&&(o=t.children.concat(o.slice(n)),n=0)}const r=n.filter((e=>!s.includes(e.id))).map((e=>e.id));return o.length!==r.length||o.some((e=>s.includes(e)))?r:[]}case'reset':return l||1!==o.length?[e.id]:[];default:return o=o.slice(),l?o.push(e.id):o.splice(r,1),o}}const O=function DebugHost(t,o,n){var s;o.iMatchCycle=-1,o.state={host:null,debugSettings:null,debugLive:null,selected:[],collapsed:[],tipItem:null,filterSplits:null,showCollapsed:!1,showParents:!1,showChildren:!1,ignoreSelection:!1,ignoreFilter:!1,ignoreTip:!1,hideUnmatched:!1,reselectRefreshId:{}},n.listenToData('debug.host','debug.settings','debug.live','settings',((e,t,n,s)=>{const i=s||Object.assign({filter:''},o.state),r=i.filter.replace(/\,/g,' ').trim()?i.filter.split(',').map((e=>e.trim().split(' ').map((e=>e.trim().toLowerCase())).filter((e=>e)))).filter((e=>void 0!==e[0])):null;o.setState({host:e,debugSettings:t,debugLive:n,filterSplits:r&&void 0!==r[0]&&r||null,showCollapsed:i.showCollapsed,showParents:i.showParents,showChildren:i.showChildren,hideUnmatched:i.hideUnmatched,ignoreFilter:i.ignoreFilter,ignoreSelection:i.ignoreSelection,ignoreTip:i.ignoreTip})}),[o.state.host,o.state.debugSettings,o.state.debugLive]);const i=new h.Ref,r=createMemo(((e,t)=>({debugInfo:e,animate:!0,iUpdate:t,toggleCollapsed,toggleSelected,toggleConcept,onToggleTip,onTipPresence})));createMemo(((...e)=>({})));const l=createMemo(((e,t)=>{if(!e)return[];const n=function flattenTreeWith(e,t,o){o||(o='children');const n=[];let s,i=e.map((e=>[e,null,0])),r=0;for(;s=i[r++];){const[e,l,a]=s,d=t(e,l,a);if(n.push(d),e[o]){const t=a+1;i=e[o].map((e=>[e,d,t])).concat(i.slice(r)),r=0}}return n}([e.groundedTree],((e,t,o)=>{let n='',s='';switch(e.type){case'boundary':s=e.def.tag?e.def.tag.name:'',n=e.def.tag?e.def.tag.toString():'';break;case'dom':{s=e.def.tag||'';const t=e.def.tag,o='string'==typeof e.def.domContent?'"'+e.def.domContent+'"':void 0,i=!!(t&&e.children[0]&&hasContentInDefs(e.def.childDefs));n=readDOMString(t,e.def.props,i?null:o),i&&(n=n.replace('/>','>'));break}case'root':{const t=e.domNode;if(s=t?t.tagName.toLowerCase():'',t){n=readDOMString(s,null,!1,t).replace('/>','>')}break}case'host':s='Host';break;case'portal':{s='Portal';const t=(e.def.props||{}).container;n=readDOMString(t?t.tagName.toLowerCase():'body',e.def.props,!1,t||function getDocBodyBy(e){var t;let o=e;for(;o;){if(o.domNode)return(null===(t=o.domNode.ownerDocument)||void 0===t?void 0:t.body)||null;o=o.parent}return null}(e)),n=n.replace('/>','>');break}}const i={id:e,treeNode:e,parent:t,level:o,name:s,description:n};return t&&(t.children?t.children.push(i):t.children=[i]),i})),s=n.map((e=>e.id)),i=o.state.collapsed.filter((e=>s.includes(e)));i.length!==o.state.collapsed.length&&setCollapsed(i);const r=o.state.selected.filter((e=>s.includes(e)));return r.length!==o.state.selected.length&&setSelected(r),n}));let a=l(o.state.host,(null===(s=o.state.debugLive)||void 0===s?void 0:s.iUpdate)||0);const areNoneCollapsed=(e=o.state.collapsed)=>void 0===e[0],setCollapsed=e=>{const t=areNoneCollapsed();areNoneCollapsed(e)!==t&&n.setInData('settings.noneCollapsed',!t),o.setInState('collapsed',e)},toggleCollapsed=(e,t)=>{setCollapsed(findItemsIdsBy(e,t||'self',o.state.collapsed,a.filter((e=>e.children&&void 0!==e.children[0]))))},toggleConcept=(e,t)=>{let o=n.getInData('settings.filter')||'';const s='['+e+']';let i=o?o.split(','):[];const r=i.map((e=>e.trim().toLowerCase())),l=r.findIndex((e=>e===s));if(t){const e=['boundary','dom','host','pass','portal','root',''].map((e=>'['+e+']')),t=r.filter((t=>!e.includes(t)||t===s));t.length===i.length?-1!==l?i.splice(l,1):i.push(void 0===i[0]?s:' '+s):(i=t,-1===l&&i.push(void 0===i[0]?s:' '+s))}else-1!==l?i.splice(l,1):i.push(void 0===i[0]?s:' '+s);n.setInData('settings.filter',i.join(','))};n.listenTo('settings.toggleCollapseAll',(()=>{setCollapsed(areNoneCollapsed()?a.filter((e=>e.children&&void 0!==e.children[0])).map((e=>e.id)):[])}));let d=!0;const whetherShouldSelect=(e=o.state.selected,t=!1)=>f?f.some((t=>!e.includes(t.id)))||t&&(m&&m.some((t=>!e.includes(t.id)))||g&&g.some((t=>!e.includes(t.id))))||!1:void 0===e[0],setSelected=e=>{const t=o.state.selected[o.iMatchCycle],s=void 0!==t?e.indexOf(t):-1;-1!==s?o.iMatchCycle+=s-o.iMatchCycle:o.iMatchCycle>=0&&o.iMatchCycle--;const i=o.state.filterSplits,r=i&&f?f.some((t=>!e.includes(t.id)&&matchesFilter(t,i))):void 0===e[0];r!==d&&n.setInData('settings.shouldSelect',d=r),o.setInState('selected',e)},toggleSelected=(e,t)=>{setSelected(findItemsIdsBy(e,t||'self',o.state.selected,a))};n.listenTo('settings.toggleSelectMatched',(e=>{let t=[];if(!f||!o.state.hideUnmatched&&e)void 0===o.state.selected[0]&&(t=a.map((e=>e.id)));else{const n=f.map((e=>e.id)).concat(e?(m&&m.map((e=>e.id))||[]).concat(g&&g.map((e=>e.id))||[]):[]);t=(e?void 0===o.state.selected.filter((e=>n.includes(e)))[0]:whetherShouldSelect())?n:o.state.selected.filter((e=>!n.includes(e)))}setSelected(t)})),n.listenTo('settings.scrollToMatched',((e,t)=>{const n=f?t||o.state.showCollapsed?f:f.filter((e=>!isItemWithinCollapsed(e,o.state.collapsed))):[];if(!n[0])return;o.iMatchCycle=e?o.iMatchCycle-1<0?n.length-1:o.iMatchCycle-1:o.iMatchCycle+1>=n.length?0:o.iMatchCycle+1;const s=n[o.iMatchCycle];scrollToItem(s)}));const onItemLink=(e,t)=>{const n=e?a.find((t=>t.id===e)):null;switch(t||'focus'){case'focus':n&&scrollToItem(n);break;case'details':setTipBy(n?n.id:null);break;case'details-break':setTipBy(n?n.id:null),setSkipHover();break;case'log':n&&consoleLog(o.state.debugSettings,'MixDOMDebug: Log item',n.treeNode)}},scrollToItem=async t=>{const n=i.getComponent(),s=o.state.collapsed;if(!n)return;let r=null,l=t.parent;for(;l;){const e=(r||s).indexOf(l.id);-1!==e&&(r||(r=s.slice()),r.splice(e,1)),l=l.parent}if(r){let t=new Promise((t=>(n||o).listenTo('didUpdate',(()=>(n||o).setTimer(null,t,20)),null,e.OneShot)));o.setInState('collapsed',r),await t}const d=a.filter(filterer).indexOf(t);-1!==d&&n.scrollToIndex(d,'instant',!0,(e=>{var t;return e&&(null===(t=e.querySelector('button'))||void 0===t?void 0:t.focus())}))},c=createMemo(((e,t,o)=>o||t?e.filter((e=>t&&t.includes(e.id)||o&&matchesFilter(e,o))):null)),u=createMemo((e=>{const t=[];for(const o of e){let n=o.parent;for(;n;)t.includes(n)||e.includes(n)||t.push(n),n=n.parent}return t})),p=createMemo(((e,t)=>{const o=[];for(const n of e){if(t.includes(n))continue;let e=n.parent;for(;e;){if(t.includes(e)){o.push(n);break}e=e.parent}}return o})),filterer=e=>!(!(o.state.hideUnmatched&&o.state.showCollapsed&&(!o.state.ignoreFilter&&o.state.filterSplits||!o.state.ignoreSelection&&void 0!==o.state.selected[0]))&&isItemWithinCollapsed(e,o.state.collapsed))&&(!f||!o.state.hideUnmatched||(!!f.includes(e)||(!(!m||!m.includes(e))||!(!g||!g.includes(e)))));let f=c(a,o.state.ignoreSelection||void 0===o.state.selected[0]?null:o.state.selected,o.state.ignoreFilter?null:o.state.filterSplits),m=f&&o.state.showParents?u(f):null,g=f&&o.state.showChildren?p(a,f):null,y=0,v=!1;const setSkipHover=()=>(v=!0)&&o.setTimer('skip-hover',(()=>{}),300),setTipBy=(e,t=!0)=>{e||(y&=-3),o.clearTimers('tip-hover','skip-hover'),o.setState({tipItem:e&&a.find((t=>t.id===e))||null,reselectRefreshId:t?{}:o.state.reselectRefreshId})};n.listenTo('settings.setTipDisplay',setTipBy);const onToggleTip=e=>{var t;setTipBy((null===(t=o.state.tipItem)||void 0===t?void 0:t.treeNode)===e?null:e)},onTipPresence=(e,t,n)=>{if(o.state.ignoreTip)return;const s='popup'===t?2:1;y=n?y|s:y&~s,n?'hoverable'===t?(!v&&!o.hasTimer('skip-hover')&&!(2&y)&&o.setTimer('tip-hover',(()=>setTipBy(e)),500),v=!1):setTipBy(e,!1):!y&&o.state.tipItem?(setTipBy(null),'popup'===t&&setSkipHover()):o.clearTimers('tip-hover')},getTipSourceElement=e=>{var t,n;return e?(null===(t=i.getComponent())||void 0===t?void 0:t.getElementAt(a.filter(filterer).findIndex((t=>t.id===e))))||null:o.state.tipItem&&(null===(n=i.getComponent())||void 0===n?void 0:n.getElementAt(a.filter(filterer).indexOf(o.state.tipItem)))||null},b=h.wired((()=>{var e;return Object.assign({},r(o.state.debugSettings,null===(e=o.state.debugLive)||void 0===e?void 0:e.iUpdate))}),((e,t,n)=>{const s=e.item,i=s.children&&void 0!==s.children[0],r=o.state.selected.includes(s.id);return Object.assign(Object.assign(Object.assign({},e),t),{collapsed:i?o.state.collapsed.includes(s.id):null,selected:r,dimmed:f?!f.includes(s):!o.state.ignoreSelection&&void 0!==o.state.selected[0]&&!r})}),UIAppTreeItem,'WiredTreeItem');return o.addWired(b),o.listenTo('beforeUpdate',(()=>{var e;let t=f;a=l(o.state.host,(null===(e=o.state.debugLive)||void 0===e?void 0:e.iUpdate)||0),f=c(a,o.state.ignoreSelection||void 0===o.state.selected[0]?null:o.state.selected,o.state.ignoreFilter?null:o.state.filterSplits),m=f&&o.state.showParents?u(f):null,g=f&&o.state.showChildren?p(a,f):null,t!==f&&d!==whetherShouldSelect()&&n.setInData('settings.shouldSelect',d=!d)})),(e,t)=>{var o;return h.def('div',{class:classNames('ui-app-host-tree layout-fit-size',e.className),style:e.style},h.def('div',{class:'flex-row flex-align-items-center layout-fit-size'},h.def(UIList,{items:a,Item:b,keyProp:'id',filter:filterer,rowHeight:30,refreshId:{},listClassName:e.listClassName,refVirtualList:i})),h.def(M,{item:t.tipItem,iUpdate:null===(o=t.debugLive)||void 0===o?void 0:o.iUpdate,onItemLink,getSourceElement:getTipSourceElement,debugInfo:t.debugSettings,reselectRefreshId:t.reselectRefreshId,onTipPresence}))}};var __rest=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&'function'==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(o[n[s]]=e[n[s]])}return o};const N=function DebugHost(e,t,o){t.state={theme:'dark',filter:'',showCollapsed:!1,showParents:!1,showChildren:!1,hideUnmatched:!1,ignoreFilter:!1,ignoreSelection:!1,ignoreTip:!1,shouldSelect:!0,noneCollapsed:!0},o.listenToData('settings',(e=>{const o=e||t.state,n=__rest(o,['hiddenTipSections']);t.setState(Object.assign({},n))}));const setFilter=e=>{o.setInData('settings.filter',e)},toggleFilterAuto=()=>o.setInData('settings.showCollapsed',!t.state.showCollapsed),toggleFilterParents=()=>o.setInData('settings.showParents',!t.state.showParents),toggleFilterChildren=()=>o.setInData('settings.showChildren',!t.state.showChildren),toggleHideUnmatched=()=>o.setInData('settings.hideUnmatched',!t.state.hideUnmatched),toggleIgnoreFilter=()=>o.setInData('settings.ignoreFilter',!t.state.ignoreFilter),toggleIgnoreSelection=()=>o.setInData('settings.ignoreSelection',!t.state.ignoreSelection),toggleIgnoreTip=()=>o.setInData('settings.ignoreTip',!t.state.ignoreTip),toggleCollapseAll=()=>o.sendSignal('settings.toggleCollapseAll'),toggleSelectMatched=e=>o.sendSignal('settings.toggleSelectMatched',e.shiftKey),toggleTheme=()=>o.sendSignal('settings.toggleTheme'),scrollToMatched=e=>o.sendSignal('settings.scrollToMatched',e.ctrlKey||e.altKey||e.metaKey,e.shiftKey),logHost=()=>consoleLog(o.getInData('debug.settings'),'MixDOMDebug: Log host',o.getInData('debug.host')),renderCollapseTip=()=>wrapTip(h.def('div',null,'Click to collapse/uncollapse all.')),renderSelectTip=()=>wrapTip(h.def('div',null,'Click to select/deselect matched (or all).',h.def('br',null),' - Click with ',h.def('b',null,'Shift'),' to always select/deselect all (= including dimly visible).')),renderScrollToMatchedTip=()=>wrapTip(h.def('div',null,'Scroll and focus to the next match.',h.def('br',null),' - Click with ',h.def('b',null,'Ctrl'),'/',h.def('b',null,'Alt'),' to go backwards.',h.def('br',null),' - Click with ',h.def('b',null,'Shift'),' to include matched but collapsed by parents (= uncollapses parents).')),renderHideUnmatchedTip=()=>wrapTip(h.def('div',null,'Whether to always show all items, or only matched by filter and/or selection.')),renderIgnoreFilterTip=()=>wrapTip(h.def('div',null,'Disable the effect of the filter temporarily.')),renderIgnoreSelectionTip=()=>wrapTip(h.def('div',null,'Disable the effect of the selection temporarily.')),renderIgnoreTipTip=()=>wrapTip(h.def('div',null,'Disable the automatic popup display.')),renderFilterAutoTip=()=>wrapTip(h.def('div',null,'Whether auto-expands collapsed parents when filtering.')),renderFilterParentsTip=()=>wrapTip(h.def('div',null,'Whether shows parents with matching children.')),renderFilterChildrenTip=()=>wrapTip(h.def('div',null,'Whether shows children of matching parents.')),renderThemesTip=()=>wrapTip(h.def('div',null,'Toggle color theme.')),renderInputTip=()=>wrapTip(h.def('div',null,'Filter items by keywords.',h.def('br',null),' - Separate by comma (',h.def('b',null,','),') and join by space (',h.def('b',null,' '),').',h.def('br',null),' - Use brackets for tags: [root], [boundary], [dom], [portal], [pass], [host]')),renderConsoleTip=()=>wrapTip(h.def('div',null,'Click to log the debugged ',h.def('b',null,'Host'),' instance in console.'));return(e,o)=>{const n=!!t.state.filter&&t.state.filter.replace(/\,/g,'').trim();return h.def('div',{class:'ui-app-top-bar layout-fit-width flex-row flex-align-items-center layout-gap-m layout-padding-m layout-border-box'},h.def(UIAppButton,{_key:'select',look:'transparent',escToCloseTip:!0,iconName:o.shouldSelect?'select-all':'select-none',onPress:toggleSelectMatched,renderTip:renderSelectTip}),h.def(UIAppButton,{_key:'collapse',look:'transparent',escToCloseTip:!0,iconName:o.noneCollapsed?'expanded':'collapsed',onPress:toggleCollapseAll,renderTip:renderCollapseTip}),h.def(UIAppButton,{_key:'scrollTo',look:'transparent',escToCloseTip:!0,iconName:'scroll-to',disabled:o.shouldSelect&&!n||void 0,onPress:scrollToMatched,renderTip:renderScrollToMatchedTip}),h.def(UIAppInput,{_key:'filter',look:'edge',type:'text',disabled:o.ignoreFilter||void 0,escToCloseTip:!0,escToClearInput:!0,value:o.filter,onValue:setFilter,className:classNames('flex-grow layout-fit-height style-text-bold',n&&'active'),placeholder:'filter items',renderTip:renderInputTip}),o.hideUnmatched?h.def(h.Fragment,null,h.def(UIAppButton,{_key:'showCollapsed',look:o.hideUnmatched?'transparent':'filled',escToCloseTip:!0,iconName:o.hideUnmatched?'filter-expanded':'filter-collapsed',disabled:!o.hideUnmatched||void 0,toggled:o.hideUnmatched&&o.showCollapsed,onPress:toggleFilterAuto,renderTip:renderFilterAutoTip}),h.def(UIAppButton,{_key:'showParents',look:o.hideUnmatched?'transparent':'filled',escToCloseTip:!0,iconName:'filter-parents',disabled:!o.hideUnmatched||void 0,toggled:o.hideUnmatched&&o.showParents,onPress:toggleFilterParents,renderTip:renderFilterParentsTip}),h.def(UIAppButton,{_key:'showChildren',look:o.hideUnmatched?'transparent':'filled',escToCloseTip:!0,iconName:'filter-children',disabled:!o.hideUnmatched||void 0,toggled:o.hideUnmatched&&o.showChildren,onPress:toggleFilterChildren,renderTip:renderFilterChildrenTip})):null,h.def(UIAppButton,{_key:'eye',look:'edge',escToCloseTip:!0,iconName:o.hideUnmatched?'show-matched':'show-all',onPress:toggleHideUnmatched,renderTip:renderHideUnmatchedTip}),h.def(UIAppButton,{_key:'ignoreFilter',look:'transparent',escToCloseTip:!0,iconName:'no-filter',toggled:o.ignoreFilter,onPress:toggleIgnoreFilter,renderTip:renderIgnoreFilterTip}),h.def(UIAppButton,{_key:'ignoreSelection',look:'transparent',escToCloseTip:!0,iconName:'no-selection',toggled:o.ignoreSelection,onPress:toggleIgnoreSelection,renderTip:renderIgnoreSelectionTip}),h.def(UIAppButton,{_key:'ignoreTip',look:'transparent',escToCloseTip:!0,iconName:'no-info',toggled:o.ignoreTip,onPress:toggleIgnoreTip,renderTip:renderIgnoreTipTip}),h.def('span',{_key:'mix-dom-debug'},h.def('b',null,'mix-dom-debug'),' ',h.def('span',{class:'style-text-small'},'(v',m,')')),h.def(UIAppButton,{_key:'theme',look:'transparent',escToCloseTip:!0,iconName:'theme',onPress:toggleTheme,renderTip:renderThemesTip}),h.def(UIAppButton,{_key:'console',look:'transparent',escToCloseTip:!0,iconName:'console',onPress:logHost,renderTip:renderConsoleTip}))}},P=function UIApp(e,t,o){return t.state={theme:'dark'},o.listenToData('settings.theme',(e=>t.setInState('theme',e)),[t.state.theme]),(e,t)=>h.def('div',{class:classNames('ui-app style-back-main style-front-main layout-fit-size flex-col','color-theme-'+t.theme,'layout-theme-default','transition-theme-default')},h.def(N,{refreshId:e.refreshId}),h.def('div',{class:'flex-row layout-fit-width flex-grow layout-overflow-hidden'},h.def(O,{refreshId:e.refreshId,listClassName:'layout-padding-m layout-border-box'})),h.def(C.WithContent,null,h.def('div',{class:'popup-tip-container layout-abs-fill layout-z-high layout-overflow-hidden layout-no-pointer'},C.Content)))};class MixDOMDebug{constructor(e){this.onUpdate=(e,t)=>{e||null===this.updateTimer&&(this.updateTimer=window.setTimeout((()=>{if(this.updateTimer=null,!this.ownHost.getContainerElement())return void(t&&this.clearHostListeners(t));const e=this.contexts.debug.data.live,o=e?e.iUpdate+1:1;this.contexts.debug.setInData('live.iUpdate',o)}),1))},this.updateTimer=null,this.refreshId={},this.contexts={debug:new Context(Object.assign(Object.assign({},this.getSettingsAndLive()),{host:null,focusedId:null})),settings:new Context({theme:'dark',filter:'',showCollapsed:!1,showParents:!1,showChildren:!1,hideUnmatched:!1,ignoreSelection:!1,ignoreFilter:!1,ignoreTip:!1,shouldSelect:!0,noneCollapsed:!0,hiddenTipSections:[]})},this.contexts.settings.listenTo('toggleTheme',(()=>this.contexts.settings.setData({theme:'dark'===this.contexts.settings.data.theme?'light':'dark'}))),this.ownHost=new Host(newDef(P,{refreshId:this.refreshId}),e||null,{onlyRunInContainer:!0,renderTimeout:null},this.contexts),this.initialize()}setHost(e,t){const{settings:o,live:n}=this.getSettingsAndLive(t),s=this.contexts.debug.data.host;s&&s===e||(s&&this.clearHostListeners(s),e.services.renderCycle.listenTo('onFinish',this.onUpdate,[e])),window.setTimeout((()=>this.contexts.debug.setData({host:e,settings:o,live:n})),0),consoleLog(o,'MixDOMDebug: '+(s?' Host re-added':' Host added'),e)}clearHost(){const e=this.contexts.debug.data.host;e&&(this.clearHostListeners(e),this.contexts.debug.setData(Object.assign({host:null,focusedId:null},this.getSettingsAndLive())))}refresh(e){var t;e&&(this.refreshId={}),null===(t=this.contexts.debug.data.host)||void 0===t||t.updateRoot(newDef(P,{refreshId:this.refreshId}))}getSettingsAndLive(e,t=0){const o={console:window.console},n={iUpdate:t};return{settings:e?Object.assign(Object.assign({},o),e):o,live:n}}initialize(){}clearHostListeners(e){e.services.renderCycle.unlistenTo('onFinish',this.onUpdate),consoleLog(this.contexts.debug.data.settings,'MixDOMDebug: Host removed',e)}}MixDOMDebug.mixDOMDebug=null,MixDOMDebug.stopDebug=()=>{if(MixDOMDebug.mixDOMDebug){const e=MixDOMDebug.mixDOMDebug.contexts.debug.data.host;e&&MixDOMDebug.mixDOMDebug.clearHostListeners(e),MixDOMDebug.mixDOMDebug=null}},MixDOMDebug.startDebug=(e,t)=>{const o=window,n=m;let s='http://localhost/www/projects/MixDOM/mix-dom-debug/dist/';s&&!s.endsWith('/')&&(s+='/');const i=s+'css/';o.document.documentElement.setAttribute('lang','en'),o.document.head.innerHTML=`<title>MixDOMDebug | Debugger for MixDOM library</title><meta name='description' content="MixDOMDebug provides a debugging view for MixDOM library hosts and contexts" /><meta name='keywords' content='mix-dom-debug, mixdomdebug, mixdomjs, mix-dom-js, mix, dom, debug, service' /><meta http-equiv='content-type' content='text/html' charset='utf-8' /><meta name='viewport' content='width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no' /><meta name="google-site-verification" content="vuXdGK5mafeCIvjzenv2uDtR4S-nxq8crCSAW_Vgyg0" /><link href='https://fonts.googleapis.com/css?family=Abel' rel='stylesheet' /><link href="${i}prettify.css?v=${n}" rel='stylesheet' type="text/css" /><link href="${i}common.css?v=${n}" rel='stylesheet' type="text/css" /><link href="${i}app.css?v=${n}" rel="stylesheet" type="text/css" />`,o.document.body.style.cssText='background: #222; margin: 0; padding: 0; width: 100%; height: 100%; font-family: \'Abel\', Arial, sans-serif; font-size: 16px;';const r=o.document.createElement('div');r.classList.add('ui'),r.id='app-root';const l=o.document.createElement('div');l.classList.add('ui'),l.id='app-hide',l.style.cssText='position: absolute; inset: 0; z-index: 1; background: #222; opacity: 1; transition: opacity 150ms ease-in-out; pointer-events: none;',o.document.body.appendChild(r),o.document.body.appendChild(l);let a=0;const ready=()=>{if(--a)return;const n=o.document.querySelector('#app-hide');n&&(o.document.body.style.removeProperty('background'),n.style.setProperty('opacity','0'),window.setTimeout((()=>{n.remove()}),150),e&&MixDOMDebug.mixDOMDebug&&MixDOMDebug.mixDOMDebug.setHost(e,t))};['https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/prettify.js','https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.15.1/beautify.min.js'].map((e=>{a++;const t=o.document.createElement('script');return t.setAttribute('type','text/javascript'),t.setAttribute('src',e),t.onload=ready,t})).forEach((e=>o.document.body.appendChild(e)));const d=o.document.querySelector('#app-root');return MixDOMDebug.mixDOMDebug=new MixDOMDebug(d),MixDOMDebug.mixDOMDebug},window.MixDOMDebug=MixDOMDebug,exports.MixDOMDebug=MixDOMDebug,exports.UIApp=P}();
